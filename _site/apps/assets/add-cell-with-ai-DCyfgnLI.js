var kn=Object.defineProperty;var Cn=(t,e,a)=>e in t?kn(t,e,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[e]=a;var W=(t,e,a)=>Cn(t,typeof e!="symbol"?e+"":e,a);import{s as tt,t as Tn}from"./chunk-DZLz74EQ.js";import{a as Cr,n as In,r as En}from"./react-7g8sREeT.js";import{t as Sn}from"./react-BcIddLXZ.js";import{$t as _a,Bt as An,E as On,Jn as Rn,Kr as Nn,Lr as Mn,Ot as Pn,Rr as jn,Rt as Zn,St as $n,Vt as ba,_t as Ln,a as Dn,cn as Tr,jr as Fn,kr as Ir,o as zn,pr as Un,tt as Vn,ut as Bn,vn as Wn,vt as qn,x as Kn,xr as Jn}from"./cells-B4cnsYe_.js";import{A as C,D as Yn,E as re,F as S,G as Er,H as te,I as de,L as xa,N as Ee,O as Gn,P as It,R as H,S as Hn,T as Sr,U as Qn,V as ue,Y as Ar,b as wa,j as gt,k as Xn,w as Be,x as Ut,z as h}from"./zod-BEi78Y5d.js";import{n as ka,t as ei}from"./jsx-runtime-DvsdsEjx.js";import{r as Or}from"./invariant-91cSKJcr.js";import{t as ce}from"./Logger-BkkOJyg0.js";import{o as ti}from"./hotkeys-CBY41Jr2.js";import{a as ai}from"./config-DiCy6eC0.js";import{t as Rr}from"./cn-Dr9kMPPj.js";import{t as at}from"./button-Bxk0BtBn.js";import{Ft as ri,Gt as si,Ht as Vt,It as ni,Q as Ca,Rt as ii,Ut as Bt,_t as Ta,et as Nr,gt as oi,it as Mr,rt as li}from"./dist-CoL9j4yJ.js";import{t as di}from"./createReducer-BaSP2BKE.js";import{a as ui,r as ci}from"./key-BuxNhFKW.js";import{h as pi,o as mi,r as hi}from"./dist-DIuPmJ5w.js";import{i as fi}from"./dist-C69eWtaQ.js";import{t as Pr}from"./use-toast-C07-frN_.js";import{r as gi}from"./useTheme-C5JyqXTm.js";import{t as jr}from"./createLucideIcon-Be9UM2Pe.js";import{l as yi,t as vi}from"./ai-model-dropdown-Dk9Kz_pz.js";import{h as _i}from"./select-CMG6DC3j.js";import{c as bi,n as xi,u as wi}from"./ansi_up-ZmFuCItK.js";import{a as Zr,c as ki,p as Ci,r as Ti,t as Ii}from"./dropdown-menu-Bp1vhqcS.js";import{n as Ei}from"./spinner-CxlO4-GJ.js";import{i as Si,t as Ai}from"./useDeleteCell-DVNOLjwN.js";import{r as Oi}from"./useNonce-Cw4ZAbgi.js";import{t as Ri}from"./shim-Bk8nzKPV.js";import{n as Ni}from"./useEvent-BIiDVnhT.js";import{n as Mi}from"./errors-qtuExmE-.js";import{n as $r}from"./renderShortcut-DMYtt-ju.js";import{t as Pi}from"./es-Hxx5X1vH.js";import{n as ji}from"./dom-4KyFHEbl.js";import{t as Zi}from"./blob-DFrnsWYL.js";import{r as $i,t as Li}from"./esm-BR7TuyMc.js";import{n as Di}from"./add-missing-import-Cwedhjm5.js";import{n as Fi}from"./icons-BUUt9FMo.js";var zi=jr("at-sign",[["circle",{cx:"12",cy:"12",r:"4",key:"4exip2"}],["path",{d:"M16 8v5a3 3 0 0 0 6 0v-1a10 10 0 1 0-4 8",key:"7n84p3"}]]),Ui=jr("send-horizontal",[["path",{d:"M3.714 3.048a.498.498 0 0 0-.683.627l2.843 7.627a2 2 0 0 1 0 1.396l-2.842 7.627a.498.498 0 0 0 .682.627l18-8.5a.5.5 0 0 0 0-.904z",key:"117uat"}],["path",{d:"M6 12h16",key:"s4cdu5"}]]),Lr="vercel.ai.error",Vi=Symbol.for(Lr),Dr,Bi=class fn extends Error{constructor({name:e,message:a,cause:r}){super(a),this[Dr]=!0,this.name=e,this.cause=r}static isInstance(e){return fn.hasMarker(e,Lr)}static hasMarker(e,a){let r=Symbol.for(a);return typeof e=="object"&&!!e&&r in e&&typeof e[r]=="boolean"&&e[r]===!0}};Dr=Vi;var rt=Bi;function Fr(t){return t==null?"unknown error":typeof t=="string"?t:t instanceof Error?t.message:JSON.stringify(t)}var zr="AI_InvalidArgumentError",Ur=`vercel.ai.error.${zr}`,Wi=Symbol.for(Ur),Vr,qi=class extends rt{constructor({message:t,cause:e,argument:a}){super({name:zr,message:t,cause:e}),this[Vr]=!0,this.argument=a}static isInstance(t){return rt.hasMarker(t,Ur)}};Vr=Wi;var Br="AI_JSONParseError",Wr=`vercel.ai.error.${Br}`,Ki=Symbol.for(Wr),qr,Kr=class extends rt{constructor({text:t,cause:e}){super({name:Br,message:`JSON parsing failed: Text: ${t}.
Error message: ${Fr(e)}`,cause:e}),this[qr]=!0,this.text=t}static isInstance(t){return rt.hasMarker(t,Wr)}};qr=Ki;var Jr="AI_TypeValidationError",Yr=`vercel.ai.error.${Jr}`,Ji=Symbol.for(Yr),Gr,Yi=class vr extends rt{constructor({value:e,cause:a}){super({name:Jr,message:`Type validation failed: Value: ${JSON.stringify(e)}.
Error message: ${Fr(a)}`,cause:a}),this[Gr]=!0,this.value=e}static isInstance(e){return rt.hasMarker(e,Yr)}static wrap({value:e,cause:a}){return vr.isInstance(a)&&a.value===e?a:new vr({value:e,cause:a})}};Gr=Ji;var Wt=Yi,Hr=class extends Error{constructor(t,e){super(t),this.name="ParseError",this.type=e.type,this.field=e.field,this.value=e.value,this.line=e.line}};function Ia(t){}function Gi(t){if(typeof t=="function")throw TypeError("`callbacks` must be an object, got a function instead. Did you mean `{onEvent: fn}`?");let{onEvent:e=Ia,onError:a=Ia,onRetry:r=Ia,onComment:s}=t,n="",i=!0,o,d="",l="";function u(f){let c=i?f.replace(/^\xEF\xBB\xBF/,""):f,[m,b]=Hi(`${n}${c}`);for(let T of m)p(T);n=b,i=!1}function p(f){if(f===""){v();return}if(f.startsWith(":")){s&&s(f.slice(f.startsWith(": ")?2:1));return}let c=f.indexOf(":");if(c!==-1){let m=f.slice(0,c),b=f[c+1]===" "?2:1,T=f.slice(c+b);_(m,T,f);return}_(f,"",f)}function _(f,c,m){switch(f){case"event":l=c;break;case"data":d=`${d}${c}
`;break;case"id":o=c.includes("\0")?void 0:c;break;case"retry":/^\d+$/.test(c)?r(parseInt(c,10)):a(new Hr(`Invalid \`retry\` value: "${c}"`,{type:"invalid-retry",value:c,line:m}));break;default:a(new Hr(`Unknown field "${f.length>20?`${f.slice(0,20)}\u2026`:f}"`,{type:"unknown-field",field:f,value:c,line:m}));break}}function v(){d.length>0&&e({id:o,event:l||void 0,data:d.endsWith(`
`)?d.slice(0,-1):d}),o=void 0,d="",l=""}function x(f={}){n&&f.consume&&p(n),i=!0,o=void 0,d="",l="",n=""}return{feed:u,reset:x}}function Hi(t){let e=[],a="",r=0;for(;r<t.length;){let s=t.indexOf("\r",r),n=t.indexOf(`
`,r),i=-1;if(s!==-1&&n!==-1?i=Math.min(s,n):s===-1?n!==-1&&(i=n):i=s===t.length-1?-1:s,i===-1){a=t.slice(r);break}else{let o=t.slice(r,i);e.push(o),r=i+1,t[r-1]==="\r"&&t[r]===`
`&&r++}}return[e,a]}var Qi=class extends TransformStream{constructor({onError:t,onRetry:e,onComment:a}={}){let r;super({start(s){r=Gi({onEvent:n=>{s.enqueue(n)},onError(n){t==="terminate"?s.error(n):typeof t=="function"&&t(n)},onRetry:e,onComment:a})},transform(s){r.feed(s)}})}},z;(function(t){t.assertEqual=s=>{};function e(s){}t.assertIs=e;function a(s){throw Error()}t.assertNever=a,t.arrayToEnum=s=>{let n={};for(let i of s)n[i]=i;return n},t.getValidEnumValues=s=>{let n=t.objectKeys(s).filter(o=>typeof s[s[o]]!="number"),i={};for(let o of n)i[o]=s[o];return t.objectValues(i)},t.objectValues=s=>t.objectKeys(s).map(function(n){return s[n]}),t.objectKeys=typeof Object.keys=="function"?s=>Object.keys(s):s=>{let n=[];for(let i in s)Object.prototype.hasOwnProperty.call(s,i)&&n.push(i);return n},t.find=(s,n)=>{for(let i of s)if(n(i))return i},t.isInteger=typeof Number.isInteger=="function"?s=>Number.isInteger(s):s=>typeof s=="number"&&Number.isFinite(s)&&Math.floor(s)===s;function r(s,n=" | "){return s.map(i=>typeof i=="string"?`'${i}'`:i).join(n)}t.joinValues=r,t.jsonStringifyReplacer=(s,n)=>typeof n=="bigint"?n.toString():n})(z||(z={}));var Xi;(function(t){t.mergeShapes=(e,a)=>({...e,...a})})(Xi||(Xi={}));const k=z.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),st=t=>{switch(typeof t){case"undefined":return k.undefined;case"string":return k.string;case"number":return Number.isNaN(t)?k.nan:k.number;case"boolean":return k.boolean;case"function":return k.function;case"bigint":return k.bigint;case"symbol":return k.symbol;case"object":return Array.isArray(t)?k.array:t===null?k.null:t.then&&typeof t.then=="function"&&t.catch&&typeof t.catch=="function"?k.promise:typeof Map<"u"&&t instanceof Map?k.map:typeof Set<"u"&&t instanceof Set?k.set:typeof Date<"u"&&t instanceof Date?k.date:k.object;default:return k.unknown}},g=z.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]);var $e=class gn extends Error{get errors(){return this.issues}constructor(e){super(),this.issues=[],this.addIssue=r=>{this.issues=[...this.issues,r]},this.addIssues=(r=[])=>{this.issues=[...this.issues,...r]};let a=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,a):this.__proto__=a,this.name="ZodError",this.issues=e}format(e){let a=e||function(n){return n.message},r={_errors:[]},s=n=>{for(let i of n.issues)if(i.code==="invalid_union")i.unionErrors.map(s);else if(i.code==="invalid_return_type")s(i.returnTypeError);else if(i.code==="invalid_arguments")s(i.argumentsError);else if(i.path.length===0)r._errors.push(a(i));else{let o=r,d=0;for(;d<i.path.length;){let l=i.path[d];d===i.path.length-1?(o[l]=o[l]||{_errors:[]},o[l]._errors.push(a(i))):o[l]=o[l]||{_errors:[]},o=o[l],d++}}};return s(this),r}static assert(e){if(!(e instanceof gn))throw Error(`Not a ZodError: ${e}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,z.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(e=a=>a.message){let a={},r=[];for(let s of this.issues)if(s.path.length>0){let n=s.path[0];a[n]=a[n]||[],a[n].push(e(s))}else r.push(e(s));return{formErrors:r,fieldErrors:a}}get formErrors(){return this.flatten()}};$e.create=t=>new $e(t);var Et=(t,e)=>{let a;switch(t.code){case g.invalid_type:a=t.received===k.undefined?"Required":`Expected ${t.expected}, received ${t.received}`;break;case g.invalid_literal:a=`Invalid literal value, expected ${JSON.stringify(t.expected,z.jsonStringifyReplacer)}`;break;case g.unrecognized_keys:a=`Unrecognized key(s) in object: ${z.joinValues(t.keys,", ")}`;break;case g.invalid_union:a="Invalid input";break;case g.invalid_union_discriminator:a=`Invalid discriminator value. Expected ${z.joinValues(t.options)}`;break;case g.invalid_enum_value:a=`Invalid enum value. Expected ${z.joinValues(t.options)}, received '${t.received}'`;break;case g.invalid_arguments:a="Invalid function arguments";break;case g.invalid_return_type:a="Invalid function return type";break;case g.invalid_date:a="Invalid date";break;case g.invalid_string:typeof t.validation=="object"?"includes"in t.validation?(a=`Invalid input: must include "${t.validation.includes}"`,typeof t.validation.position=="number"&&(a=`${a} at one or more positions greater than or equal to ${t.validation.position}`)):"startsWith"in t.validation?a=`Invalid input: must start with "${t.validation.startsWith}"`:"endsWith"in t.validation?a=`Invalid input: must end with "${t.validation.endsWith}"`:z.assertNever(t.validation):a=t.validation==="regex"?"Invalid":`Invalid ${t.validation}`;break;case g.too_small:a=t.type==="array"?`Array must contain ${t.exact?"exactly":t.inclusive?"at least":"more than"} ${t.minimum} element(s)`:t.type==="string"?`String must contain ${t.exact?"exactly":t.inclusive?"at least":"over"} ${t.minimum} character(s)`:t.type==="number"||t.type==="bigint"?`Number must be ${t.exact?"exactly equal to ":t.inclusive?"greater than or equal to ":"greater than "}${t.minimum}`:t.type==="date"?`Date must be ${t.exact?"exactly equal to ":t.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(t.minimum))}`:"Invalid input";break;case g.too_big:a=t.type==="array"?`Array must contain ${t.exact?"exactly":t.inclusive?"at most":"less than"} ${t.maximum} element(s)`:t.type==="string"?`String must contain ${t.exact?"exactly":t.inclusive?"at most":"under"} ${t.maximum} character(s)`:t.type==="number"?`Number must be ${t.exact?"exactly":t.inclusive?"less than or equal to":"less than"} ${t.maximum}`:t.type==="bigint"?`BigInt must be ${t.exact?"exactly":t.inclusive?"less than or equal to":"less than"} ${t.maximum}`:t.type==="date"?`Date must be ${t.exact?"exactly":t.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(t.maximum))}`:"Invalid input";break;case g.custom:a="Invalid input";break;case g.invalid_intersection_types:a="Intersection results could not be merged";break;case g.not_multiple_of:a=`Number must be a multiple of ${t.multipleOf}`;break;case g.not_finite:a="Number must be finite";break;default:a=e.defaultError,z.assertNever(t)}return{message:a}},eo=Et;function Ea(){return eo}const Sa=t=>{let{data:e,path:a,errorMaps:r,issueData:s}=t,n=[...a,...s.path||[]],i={...s,path:n};if(s.message!==void 0)return{...s,path:n,message:s.message};let o="",d=r.filter(l=>!!l).slice().reverse();for(let l of d)o=l(i,{data:e,defaultError:o}).message;return{...s,path:n,message:o}};function w(t,e){let a=Ea(),r=Sa({issueData:e,data:t.data,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,a,a===Et?void 0:Et].filter(s=>!!s)});t.common.issues.push(r)}var we=class yn{constructor(){this.value="valid"}dirty(){this.value==="valid"&&(this.value="dirty")}abort(){this.value!=="aborted"&&(this.value="aborted")}static mergeArray(e,a){let r=[];for(let s of a){if(s.status==="aborted")return O;s.status==="dirty"&&e.dirty(),r.push(s.value)}return{status:e.value,value:r}}static async mergeObjectAsync(e,a){let r=[];for(let s of a){let n=await s.key,i=await s.value;r.push({key:n,value:i})}return yn.mergeObjectSync(e,r)}static mergeObjectSync(e,a){let r={};for(let s of a){let{key:n,value:i}=s;if(n.status==="aborted"||i.status==="aborted")return O;n.status==="dirty"&&e.dirty(),i.status==="dirty"&&e.dirty(),n.value!=="__proto__"&&(i.value!==void 0||s.alwaysSet)&&(r[n.value]=i.value)}return{status:e.value,value:r}}};const O=Object.freeze({status:"aborted"}),Aa=t=>({status:"dirty",value:t}),ye=t=>({status:"valid",value:t}),Qr=t=>t.status==="aborted",Xr=t=>t.status==="dirty",yt=t=>t.status==="valid",qt=t=>typeof Promise<"u"&&t instanceof Promise;var I;(function(t){t.errToObj=e=>typeof e=="string"?{message:e}:e||{},t.toString=e=>typeof e=="string"?e:e==null?void 0:e.message})(I||(I={}));var Le=class{constructor(t,e,a,r){this._cachedPath=[],this.parent=t,this.data=e,this._path=a,this._key=r}get path(){return this._cachedPath.length||(Array.isArray(this._key)?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}},es=(t,e)=>{if(yt(e))return{success:!0,data:e.value};if(!t.common.issues.length)throw Error("Validation failed but no issues detected.");return{success:!1,get error(){return this._error||(this._error=new $e(t.common.issues)),this._error}}};function M(t){if(!t)return{};let{errorMap:e,invalid_type_error:a,required_error:r,description:s}=t;if(e&&(a||r))throw Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);return e?{errorMap:e,description:s}:{errorMap:(n,i)=>{let{message:o}=t;return n.code==="invalid_enum_value"?{message:o??i.defaultError}:i.data===void 0?{message:o??r??i.defaultError}:n.code==="invalid_type"?{message:o??a??i.defaultError}:{message:i.defaultError}},description:s}}var Z=class{get description(){return this._def.description}_getType(t){return st(t.data)}_getOrReturnCtx(t,e){return e||{common:t.parent.common,data:t.data,parsedType:st(t.data),schemaErrorMap:this._def.errorMap,path:t.path,parent:t.parent}}_processInputParams(t){return{status:new we,ctx:{common:t.parent.common,data:t.data,parsedType:st(t.data),schemaErrorMap:this._def.errorMap,path:t.path,parent:t.parent}}}_parseSync(t){let e=this._parse(t);if(qt(e))throw Error("Synchronous parse encountered promise.");return e}_parseAsync(t){let e=this._parse(t);return Promise.resolve(e)}parse(t,e){let a=this.safeParse(t,e);if(a.success)return a.data;throw a.error}safeParse(t,e){let a={common:{issues:[],async:(e==null?void 0:e.async)??!1,contextualErrorMap:e==null?void 0:e.errorMap},path:(e==null?void 0:e.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:t,parsedType:st(t)},r=this._parseSync({data:t,path:a.path,parent:a});return es(a,r)}"~validate"(t){var a,r;let e={common:{issues:[],async:!!this["~standard"].async},path:[],schemaErrorMap:this._def.errorMap,parent:null,data:t,parsedType:st(t)};if(!this["~standard"].async)try{let s=this._parseSync({data:t,path:[],parent:e});return yt(s)?{value:s.value}:{issues:e.common.issues}}catch(s){(r=(a=s==null?void 0:s.message)==null?void 0:a.toLowerCase())!=null&&r.includes("encountered")&&(this["~standard"].async=!0),e.common={issues:[],async:!0}}return this._parseAsync({data:t,path:[],parent:e}).then(s=>yt(s)?{value:s.value}:{issues:e.common.issues})}async parseAsync(t,e){let a=await this.safeParseAsync(t,e);if(a.success)return a.data;throw a.error}async safeParseAsync(t,e){let a={common:{issues:[],contextualErrorMap:e==null?void 0:e.errorMap,async:!0},path:(e==null?void 0:e.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:t,parsedType:st(t)},r=this._parse({data:t,path:a.path,parent:a}),s=await(qt(r)?r:Promise.resolve(r));return es(a,s)}refine(t,e){let a=r=>typeof e=="string"||e===void 0?{message:e}:typeof e=="function"?e(r):e;return this._refinement((r,s)=>{let n=t(r),i=()=>s.addIssue({code:g.custom,...a(r)});return typeof Promise<"u"&&n instanceof Promise?n.then(o=>o?!0:(i(),!1)):n?!0:(i(),!1)})}refinement(t,e){return this._refinement((a,r)=>t(a)?!0:(r.addIssue(typeof e=="function"?e(a,r):e),!1))}_refinement(t){return new We({schema:this,typeName:y.ZodEffects,effect:{type:"refinement",refinement:t}})}superRefine(t){return this._refinement(t)}constructor(t){this.spa=this.safeParseAsync,this._def=t,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this),this["~standard"]={version:1,vendor:"zod",validate:e=>this["~validate"](e)}}optional(){return qe.create(this,this._def)}nullable(){return pt.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return _t.create(this)}promise(){return St.create(this,this._def)}or(t){return Gt.create([this,t],this._def)}and(t){return Ht.create(this,t,this._def)}transform(t){return new We({...M(this._def),schema:this,typeName:y.ZodEffects,effect:{type:"transform",transform:t}})}default(t){let e=typeof t=="function"?t:()=>t;return new aa({...M(this._def),innerType:this,defaultValue:e,typeName:y.ZodDefault})}brand(){return new ns({typeName:y.ZodBranded,type:this,...M(this._def)})}catch(t){let e=typeof t=="function"?t:()=>t;return new ra({...M(this._def),innerType:this,catchValue:e,typeName:y.ZodCatch})}describe(t){let e=this.constructor;return new e({...this._def,description:t})}pipe(t){return is.create(this,t)}readonly(){return sa.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}},to=/^c[^\s-]{8,}$/i,ao=/^[0-9a-z]+$/,ro=/^[0-9A-HJKMNP-TV-Z]{26}$/i,so=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,no=/^[a-z0-9_-]{21}$/i,io=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/,oo=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,lo=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,uo="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$",ts,co=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,po=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,mo=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/,ho=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,fo=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,go=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,as="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",yo=RegExp(`^${as}$`);function rs(t){let e="[0-5]\\d";t.precision?e=`${e}\\.\\d{${t.precision}}`:t.precision??(e=`${e}(\\.\\d+)?`);let a=t.precision?"+":"?";return`([01]\\d|2[0-3]):[0-5]\\d(:${e})${a}`}function vo(t){return RegExp(`^${rs(t)}$`)}function _o(t){let e=`${as}T${rs(t)}`,a=[];return a.push(t.local?"Z?":"Z"),t.offset&&a.push("([+-]\\d{2}:?\\d{2})"),e=`${e}(${a.join("|")})`,RegExp(`^${e}$`)}function bo(t,e){return!!((e==="v4"||!e)&&co.test(t)||(e==="v6"||!e)&&mo.test(t))}function xo(t,e){if(!io.test(t))return!1;try{let[a]=t.split(".");if(!a)return!1;let r=a.replace(/-/g,"+").replace(/_/g,"/").padEnd(a.length+(4-a.length%4)%4,"="),s=JSON.parse(atob(r));return!(typeof s!="object"||!s||"typ"in s&&(s==null?void 0:s.typ)!=="JWT"||!s.alg||e&&s.alg!==e)}catch{return!1}}function wo(t,e){return!!((e==="v4"||!e)&&po.test(t)||(e==="v6"||!e)&&ho.test(t))}var Kt=class Ft extends Z{_parse(e){if(this._def.coerce&&(e.data=String(e.data)),this._getType(e)!==k.string){let s=this._getOrReturnCtx(e);return w(s,{code:g.invalid_type,expected:k.string,received:s.parsedType}),O}let a=new we,r;for(let s of this._def.checks)if(s.kind==="min")e.data.length<s.value&&(r=this._getOrReturnCtx(e,r),w(r,{code:g.too_small,minimum:s.value,type:"string",inclusive:!0,exact:!1,message:s.message}),a.dirty());else if(s.kind==="max")e.data.length>s.value&&(r=this._getOrReturnCtx(e,r),w(r,{code:g.too_big,maximum:s.value,type:"string",inclusive:!0,exact:!1,message:s.message}),a.dirty());else if(s.kind==="length"){let n=e.data.length>s.value,i=e.data.length<s.value;(n||i)&&(r=this._getOrReturnCtx(e,r),n?w(r,{code:g.too_big,maximum:s.value,type:"string",inclusive:!0,exact:!0,message:s.message}):i&&w(r,{code:g.too_small,minimum:s.value,type:"string",inclusive:!0,exact:!0,message:s.message}),a.dirty())}else if(s.kind==="email")lo.test(e.data)||(r=this._getOrReturnCtx(e,r),w(r,{validation:"email",code:g.invalid_string,message:s.message}),a.dirty());else if(s.kind==="emoji")ts||(ts=new RegExp(uo,"u")),ts.test(e.data)||(r=this._getOrReturnCtx(e,r),w(r,{validation:"emoji",code:g.invalid_string,message:s.message}),a.dirty());else if(s.kind==="uuid")so.test(e.data)||(r=this._getOrReturnCtx(e,r),w(r,{validation:"uuid",code:g.invalid_string,message:s.message}),a.dirty());else if(s.kind==="nanoid")no.test(e.data)||(r=this._getOrReturnCtx(e,r),w(r,{validation:"nanoid",code:g.invalid_string,message:s.message}),a.dirty());else if(s.kind==="cuid")to.test(e.data)||(r=this._getOrReturnCtx(e,r),w(r,{validation:"cuid",code:g.invalid_string,message:s.message}),a.dirty());else if(s.kind==="cuid2")ao.test(e.data)||(r=this._getOrReturnCtx(e,r),w(r,{validation:"cuid2",code:g.invalid_string,message:s.message}),a.dirty());else if(s.kind==="ulid")ro.test(e.data)||(r=this._getOrReturnCtx(e,r),w(r,{validation:"ulid",code:g.invalid_string,message:s.message}),a.dirty());else if(s.kind==="url")try{new URL(e.data)}catch{r=this._getOrReturnCtx(e,r),w(r,{validation:"url",code:g.invalid_string,message:s.message}),a.dirty()}else s.kind==="regex"?(s.regex.lastIndex=0,s.regex.test(e.data)||(r=this._getOrReturnCtx(e,r),w(r,{validation:"regex",code:g.invalid_string,message:s.message}),a.dirty())):s.kind==="trim"?e.data=e.data.trim():s.kind==="includes"?e.data.includes(s.value,s.position)||(r=this._getOrReturnCtx(e,r),w(r,{code:g.invalid_string,validation:{includes:s.value,position:s.position},message:s.message}),a.dirty()):s.kind==="toLowerCase"?e.data=e.data.toLowerCase():s.kind==="toUpperCase"?e.data=e.data.toUpperCase():s.kind==="startsWith"?e.data.startsWith(s.value)||(r=this._getOrReturnCtx(e,r),w(r,{code:g.invalid_string,validation:{startsWith:s.value},message:s.message}),a.dirty()):s.kind==="endsWith"?e.data.endsWith(s.value)||(r=this._getOrReturnCtx(e,r),w(r,{code:g.invalid_string,validation:{endsWith:s.value},message:s.message}),a.dirty()):s.kind==="datetime"?_o(s).test(e.data)||(r=this._getOrReturnCtx(e,r),w(r,{code:g.invalid_string,validation:"datetime",message:s.message}),a.dirty()):s.kind==="date"?yo.test(e.data)||(r=this._getOrReturnCtx(e,r),w(r,{code:g.invalid_string,validation:"date",message:s.message}),a.dirty()):s.kind==="time"?vo(s).test(e.data)||(r=this._getOrReturnCtx(e,r),w(r,{code:g.invalid_string,validation:"time",message:s.message}),a.dirty()):s.kind==="duration"?oo.test(e.data)||(r=this._getOrReturnCtx(e,r),w(r,{validation:"duration",code:g.invalid_string,message:s.message}),a.dirty()):s.kind==="ip"?bo(e.data,s.version)||(r=this._getOrReturnCtx(e,r),w(r,{validation:"ip",code:g.invalid_string,message:s.message}),a.dirty()):s.kind==="jwt"?xo(e.data,s.alg)||(r=this._getOrReturnCtx(e,r),w(r,{validation:"jwt",code:g.invalid_string,message:s.message}),a.dirty()):s.kind==="cidr"?wo(e.data,s.version)||(r=this._getOrReturnCtx(e,r),w(r,{validation:"cidr",code:g.invalid_string,message:s.message}),a.dirty()):s.kind==="base64"?fo.test(e.data)||(r=this._getOrReturnCtx(e,r),w(r,{validation:"base64",code:g.invalid_string,message:s.message}),a.dirty()):s.kind==="base64url"?go.test(e.data)||(r=this._getOrReturnCtx(e,r),w(r,{validation:"base64url",code:g.invalid_string,message:s.message}),a.dirty()):z.assertNever(s);return{status:a.value,value:e.data}}_regex(e,a,r){return this.refinement(s=>e.test(s),{validation:a,code:g.invalid_string,...I.errToObj(r)})}_addCheck(e){return new Ft({...this._def,checks:[...this._def.checks,e]})}email(e){return this._addCheck({kind:"email",...I.errToObj(e)})}url(e){return this._addCheck({kind:"url",...I.errToObj(e)})}emoji(e){return this._addCheck({kind:"emoji",...I.errToObj(e)})}uuid(e){return this._addCheck({kind:"uuid",...I.errToObj(e)})}nanoid(e){return this._addCheck({kind:"nanoid",...I.errToObj(e)})}cuid(e){return this._addCheck({kind:"cuid",...I.errToObj(e)})}cuid2(e){return this._addCheck({kind:"cuid2",...I.errToObj(e)})}ulid(e){return this._addCheck({kind:"ulid",...I.errToObj(e)})}base64(e){return this._addCheck({kind:"base64",...I.errToObj(e)})}base64url(e){return this._addCheck({kind:"base64url",...I.errToObj(e)})}jwt(e){return this._addCheck({kind:"jwt",...I.errToObj(e)})}ip(e){return this._addCheck({kind:"ip",...I.errToObj(e)})}cidr(e){return this._addCheck({kind:"cidr",...I.errToObj(e)})}datetime(e){return typeof e=="string"?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:e}):this._addCheck({kind:"datetime",precision:(e==null?void 0:e.precision)===void 0?null:e==null?void 0:e.precision,offset:(e==null?void 0:e.offset)??!1,local:(e==null?void 0:e.local)??!1,...I.errToObj(e==null?void 0:e.message)})}date(e){return this._addCheck({kind:"date",message:e})}time(e){return typeof e=="string"?this._addCheck({kind:"time",precision:null,message:e}):this._addCheck({kind:"time",precision:(e==null?void 0:e.precision)===void 0?null:e==null?void 0:e.precision,...I.errToObj(e==null?void 0:e.message)})}duration(e){return this._addCheck({kind:"duration",...I.errToObj(e)})}regex(e,a){return this._addCheck({kind:"regex",regex:e,...I.errToObj(a)})}includes(e,a){return this._addCheck({kind:"includes",value:e,position:a==null?void 0:a.position,...I.errToObj(a==null?void 0:a.message)})}startsWith(e,a){return this._addCheck({kind:"startsWith",value:e,...I.errToObj(a)})}endsWith(e,a){return this._addCheck({kind:"endsWith",value:e,...I.errToObj(a)})}min(e,a){return this._addCheck({kind:"min",value:e,...I.errToObj(a)})}max(e,a){return this._addCheck({kind:"max",value:e,...I.errToObj(a)})}length(e,a){return this._addCheck({kind:"length",value:e,...I.errToObj(a)})}nonempty(e){return this.min(1,I.errToObj(e))}trim(){return new Ft({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new Ft({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new Ft({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(e=>e.kind==="datetime")}get isDate(){return!!this._def.checks.find(e=>e.kind==="date")}get isTime(){return!!this._def.checks.find(e=>e.kind==="time")}get isDuration(){return!!this._def.checks.find(e=>e.kind==="duration")}get isEmail(){return!!this._def.checks.find(e=>e.kind==="email")}get isURL(){return!!this._def.checks.find(e=>e.kind==="url")}get isEmoji(){return!!this._def.checks.find(e=>e.kind==="emoji")}get isUUID(){return!!this._def.checks.find(e=>e.kind==="uuid")}get isNANOID(){return!!this._def.checks.find(e=>e.kind==="nanoid")}get isCUID(){return!!this._def.checks.find(e=>e.kind==="cuid")}get isCUID2(){return!!this._def.checks.find(e=>e.kind==="cuid2")}get isULID(){return!!this._def.checks.find(e=>e.kind==="ulid")}get isIP(){return!!this._def.checks.find(e=>e.kind==="ip")}get isCIDR(){return!!this._def.checks.find(e=>e.kind==="cidr")}get isBase64(){return!!this._def.checks.find(e=>e.kind==="base64")}get isBase64url(){return!!this._def.checks.find(e=>e.kind==="base64url")}get minLength(){let e=null;for(let a of this._def.checks)a.kind==="min"&&(e===null||a.value>e)&&(e=a.value);return e}get maxLength(){let e=null;for(let a of this._def.checks)a.kind==="max"&&(e===null||a.value<e)&&(e=a.value);return e}};Kt.create=t=>new Kt({checks:[],typeName:y.ZodString,coerce:(t==null?void 0:t.coerce)??!1,...M(t)});function ko(t,e){let a=(t.toString().split(".")[1]||"").length,r=(e.toString().split(".")[1]||"").length,s=a>r?a:r,n=Number.parseInt(t.toFixed(s).replace(".","")),i=Number.parseInt(e.toFixed(s).replace(".",""));return n%i/10**s}var Oa=class _r extends Z{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(e){if(this._def.coerce&&(e.data=Number(e.data)),this._getType(e)!==k.number){let s=this._getOrReturnCtx(e);return w(s,{code:g.invalid_type,expected:k.number,received:s.parsedType}),O}let a,r=new we;for(let s of this._def.checks)s.kind==="int"?z.isInteger(e.data)||(a=this._getOrReturnCtx(e,a),w(a,{code:g.invalid_type,expected:"integer",received:"float",message:s.message}),r.dirty()):s.kind==="min"?(s.inclusive?e.data<s.value:e.data<=s.value)&&(a=this._getOrReturnCtx(e,a),w(a,{code:g.too_small,minimum:s.value,type:"number",inclusive:s.inclusive,exact:!1,message:s.message}),r.dirty()):s.kind==="max"?(s.inclusive?e.data>s.value:e.data>=s.value)&&(a=this._getOrReturnCtx(e,a),w(a,{code:g.too_big,maximum:s.value,type:"number",inclusive:s.inclusive,exact:!1,message:s.message}),r.dirty()):s.kind==="multipleOf"?ko(e.data,s.value)!==0&&(a=this._getOrReturnCtx(e,a),w(a,{code:g.not_multiple_of,multipleOf:s.value,message:s.message}),r.dirty()):s.kind==="finite"?Number.isFinite(e.data)||(a=this._getOrReturnCtx(e,a),w(a,{code:g.not_finite,message:s.message}),r.dirty()):z.assertNever(s);return{status:r.value,value:e.data}}gte(e,a){return this.setLimit("min",e,!0,I.toString(a))}gt(e,a){return this.setLimit("min",e,!1,I.toString(a))}lte(e,a){return this.setLimit("max",e,!0,I.toString(a))}lt(e,a){return this.setLimit("max",e,!1,I.toString(a))}setLimit(e,a,r,s){return new _r({...this._def,checks:[...this._def.checks,{kind:e,value:a,inclusive:r,message:I.toString(s)}]})}_addCheck(e){return new _r({...this._def,checks:[...this._def.checks,e]})}int(e){return this._addCheck({kind:"int",message:I.toString(e)})}positive(e){return this._addCheck({kind:"min",value:0,inclusive:!1,message:I.toString(e)})}negative(e){return this._addCheck({kind:"max",value:0,inclusive:!1,message:I.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:0,inclusive:!0,message:I.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:0,inclusive:!0,message:I.toString(e)})}multipleOf(e,a){return this._addCheck({kind:"multipleOf",value:e,message:I.toString(a)})}finite(e){return this._addCheck({kind:"finite",message:I.toString(e)})}safe(e){return this._addCheck({kind:"min",inclusive:!0,value:-(2**53-1),message:I.toString(e)})._addCheck({kind:"max",inclusive:!0,value:2**53-1,message:I.toString(e)})}get minValue(){let e=null;for(let a of this._def.checks)a.kind==="min"&&(e===null||a.value>e)&&(e=a.value);return e}get maxValue(){let e=null;for(let a of this._def.checks)a.kind==="max"&&(e===null||a.value<e)&&(e=a.value);return e}get isInt(){return!!this._def.checks.find(e=>e.kind==="int"||e.kind==="multipleOf"&&z.isInteger(e.value))}get isFinite(){let e=null,a=null;for(let r of this._def.checks){if(r.kind==="finite"||r.kind==="int"||r.kind==="multipleOf")return!0;r.kind==="min"?(a===null||r.value>a)&&(a=r.value):r.kind==="max"&&(e===null||r.value<e)&&(e=r.value)}return Number.isFinite(a)&&Number.isFinite(e)}};Oa.create=t=>new Oa({checks:[],typeName:y.ZodNumber,coerce:(t==null?void 0:t.coerce)||!1,...M(t)});var Ra=class br extends Z{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(e){if(this._def.coerce)try{e.data=BigInt(e.data)}catch{return this._getInvalidInput(e)}if(this._getType(e)!==k.bigint)return this._getInvalidInput(e);let a,r=new we;for(let s of this._def.checks)s.kind==="min"?(s.inclusive?e.data<s.value:e.data<=s.value)&&(a=this._getOrReturnCtx(e,a),w(a,{code:g.too_small,type:"bigint",minimum:s.value,inclusive:s.inclusive,message:s.message}),r.dirty()):s.kind==="max"?(s.inclusive?e.data>s.value:e.data>=s.value)&&(a=this._getOrReturnCtx(e,a),w(a,{code:g.too_big,type:"bigint",maximum:s.value,inclusive:s.inclusive,message:s.message}),r.dirty()):s.kind==="multipleOf"?e.data%s.value!==BigInt(0)&&(a=this._getOrReturnCtx(e,a),w(a,{code:g.not_multiple_of,multipleOf:s.value,message:s.message}),r.dirty()):z.assertNever(s);return{status:r.value,value:e.data}}_getInvalidInput(e){let a=this._getOrReturnCtx(e);return w(a,{code:g.invalid_type,expected:k.bigint,received:a.parsedType}),O}gte(e,a){return this.setLimit("min",e,!0,I.toString(a))}gt(e,a){return this.setLimit("min",e,!1,I.toString(a))}lte(e,a){return this.setLimit("max",e,!0,I.toString(a))}lt(e,a){return this.setLimit("max",e,!1,I.toString(a))}setLimit(e,a,r,s){return new br({...this._def,checks:[...this._def.checks,{kind:e,value:a,inclusive:r,message:I.toString(s)}]})}_addCheck(e){return new br({...this._def,checks:[...this._def.checks,e]})}positive(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:I.toString(e)})}negative(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:I.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:I.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:I.toString(e)})}multipleOf(e,a){return this._addCheck({kind:"multipleOf",value:e,message:I.toString(a)})}get minValue(){let e=null;for(let a of this._def.checks)a.kind==="min"&&(e===null||a.value>e)&&(e=a.value);return e}get maxValue(){let e=null;for(let a of this._def.checks)a.kind==="max"&&(e===null||a.value<e)&&(e=a.value);return e}};Ra.create=t=>new Ra({checks:[],typeName:y.ZodBigInt,coerce:(t==null?void 0:t.coerce)??!1,...M(t)});var Na=class extends Z{_parse(t){if(this._def.coerce&&(t.data=!!t.data),this._getType(t)!==k.boolean){let e=this._getOrReturnCtx(t);return w(e,{code:g.invalid_type,expected:k.boolean,received:e.parsedType}),O}return ye(t.data)}};Na.create=t=>new Na({typeName:y.ZodBoolean,coerce:(t==null?void 0:t.coerce)||!1,...M(t)});var Ma=class vn extends Z{_parse(e){if(this._def.coerce&&(e.data=new Date(e.data)),this._getType(e)!==k.date){let s=this._getOrReturnCtx(e);return w(s,{code:g.invalid_type,expected:k.date,received:s.parsedType}),O}if(Number.isNaN(e.data.getTime())){let s=this._getOrReturnCtx(e);return w(s,{code:g.invalid_date}),O}let a=new we,r;for(let s of this._def.checks)s.kind==="min"?e.data.getTime()<s.value&&(r=this._getOrReturnCtx(e,r),w(r,{code:g.too_small,message:s.message,inclusive:!0,exact:!1,minimum:s.value,type:"date"}),a.dirty()):s.kind==="max"?e.data.getTime()>s.value&&(r=this._getOrReturnCtx(e,r),w(r,{code:g.too_big,message:s.message,inclusive:!0,exact:!1,maximum:s.value,type:"date"}),a.dirty()):z.assertNever(s);return{status:a.value,value:new Date(e.data.getTime())}}_addCheck(e){return new vn({...this._def,checks:[...this._def.checks,e]})}min(e,a){return this._addCheck({kind:"min",value:e.getTime(),message:I.toString(a)})}max(e,a){return this._addCheck({kind:"max",value:e.getTime(),message:I.toString(a)})}get minDate(){let e=null;for(let a of this._def.checks)a.kind==="min"&&(e===null||a.value>e)&&(e=a.value);return e==null?null:new Date(e)}get maxDate(){let e=null;for(let a of this._def.checks)a.kind==="max"&&(e===null||a.value<e)&&(e=a.value);return e==null?null:new Date(e)}};Ma.create=t=>new Ma({checks:[],coerce:(t==null?void 0:t.coerce)||!1,typeName:y.ZodDate,...M(t)});var Pa=class extends Z{_parse(t){if(this._getType(t)!==k.symbol){let e=this._getOrReturnCtx(t);return w(e,{code:g.invalid_type,expected:k.symbol,received:e.parsedType}),O}return ye(t.data)}};Pa.create=t=>new Pa({typeName:y.ZodSymbol,...M(t)});var Jt=class extends Z{_parse(t){if(this._getType(t)!==k.undefined){let e=this._getOrReturnCtx(t);return w(e,{code:g.invalid_type,expected:k.undefined,received:e.parsedType}),O}return ye(t.data)}};Jt.create=t=>new Jt({typeName:y.ZodUndefined,...M(t)});var Yt=class extends Z{_parse(t){if(this._getType(t)!==k.null){let e=this._getOrReturnCtx(t);return w(e,{code:g.invalid_type,expected:k.null,received:e.parsedType}),O}return ye(t.data)}};Yt.create=t=>new Yt({typeName:y.ZodNull,...M(t)});var ja=class extends Z{constructor(){super(...arguments),this._any=!0}_parse(t){return ye(t.data)}};ja.create=t=>new ja({typeName:y.ZodAny,...M(t)});var vt=class extends Z{constructor(){super(...arguments),this._unknown=!0}_parse(t){return ye(t.data)}};vt.create=t=>new vt({typeName:y.ZodUnknown,...M(t)});var nt=class extends Z{_parse(t){let e=this._getOrReturnCtx(t);return w(e,{code:g.invalid_type,expected:k.never,received:e.parsedType}),O}};nt.create=t=>new nt({typeName:y.ZodNever,...M(t)});var Za=class extends Z{_parse(t){if(this._getType(t)!==k.undefined){let e=this._getOrReturnCtx(t);return w(e,{code:g.invalid_type,expected:k.void,received:e.parsedType}),O}return ye(t.data)}};Za.create=t=>new Za({typeName:y.ZodVoid,...M(t)});var _t=class ya extends Z{_parse(e){let{ctx:a,status:r}=this._processInputParams(e),s=this._def;if(a.parsedType!==k.array)return w(a,{code:g.invalid_type,expected:k.array,received:a.parsedType}),O;if(s.exactLength!==null){let i=a.data.length>s.exactLength.value,o=a.data.length<s.exactLength.value;(i||o)&&(w(a,{code:i?g.too_big:g.too_small,minimum:o?s.exactLength.value:void 0,maximum:i?s.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:s.exactLength.message}),r.dirty())}if(s.minLength!==null&&a.data.length<s.minLength.value&&(w(a,{code:g.too_small,minimum:s.minLength.value,type:"array",inclusive:!0,exact:!1,message:s.minLength.message}),r.dirty()),s.maxLength!==null&&a.data.length>s.maxLength.value&&(w(a,{code:g.too_big,maximum:s.maxLength.value,type:"array",inclusive:!0,exact:!1,message:s.maxLength.message}),r.dirty()),a.common.async)return Promise.all([...a.data].map((i,o)=>s.type._parseAsync(new Le(a,i,a.path,o)))).then(i=>we.mergeArray(r,i));let n=[...a.data].map((i,o)=>s.type._parseSync(new Le(a,i,a.path,o)));return we.mergeArray(r,n)}get element(){return this._def.type}min(e,a){return new ya({...this._def,minLength:{value:e,message:I.toString(a)}})}max(e,a){return new ya({...this._def,maxLength:{value:e,message:I.toString(a)}})}length(e,a){return new ya({...this._def,exactLength:{value:e,message:I.toString(a)}})}nonempty(e){return this.min(1,e)}};_t.create=(t,e)=>new _t({type:t,minLength:null,maxLength:null,exactLength:null,typeName:y.ZodArray,...M(e)});function bt(t){if(t instanceof Re){let e={};for(let a in t.shape){let r=t.shape[a];e[a]=qe.create(bt(r))}return new Re({...t._def,shape:()=>e})}else return t instanceof _t?new _t({...t._def,type:bt(t.element)}):t instanceof qe?qe.create(bt(t.unwrap())):t instanceof pt?pt.create(bt(t.unwrap())):t instanceof ct?ct.create(t.items.map(e=>bt(e))):t}var Re=class je extends Z{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(this._cached!==null)return this._cached;let e=this._def.shape(),a=z.objectKeys(e);return this._cached={shape:e,keys:a},this._cached}_parse(e){if(this._getType(e)!==k.object){let d=this._getOrReturnCtx(e);return w(d,{code:g.invalid_type,expected:k.object,received:d.parsedType}),O}let{status:a,ctx:r}=this._processInputParams(e),{shape:s,keys:n}=this._getCached(),i=[];if(!(this._def.catchall instanceof nt&&this._def.unknownKeys==="strip"))for(let d in r.data)n.includes(d)||i.push(d);let o=[];for(let d of n){let l=s[d],u=r.data[d];o.push({key:{status:"valid",value:d},value:l._parse(new Le(r,u,r.path,d)),alwaysSet:d in r.data})}if(this._def.catchall instanceof nt){let d=this._def.unknownKeys;if(d==="passthrough")for(let l of i)o.push({key:{status:"valid",value:l},value:{status:"valid",value:r.data[l]}});else if(d==="strict")i.length>0&&(w(r,{code:g.unrecognized_keys,keys:i}),a.dirty());else if(d!=="strip")throw Error("Internal ZodObject error: invalid unknownKeys value.")}else{let d=this._def.catchall;for(let l of i){let u=r.data[l];o.push({key:{status:"valid",value:l},value:d._parse(new Le(r,u,r.path,l)),alwaysSet:l in r.data})}}return r.common.async?Promise.resolve().then(async()=>{let d=[];for(let l of o){let u=await l.key,p=await l.value;d.push({key:u,value:p,alwaysSet:l.alwaysSet})}return d}).then(d=>we.mergeObjectSync(a,d)):we.mergeObjectSync(a,o)}get shape(){return this._def.shape()}strict(e){return I.errToObj,new je({...this._def,unknownKeys:"strict",...e===void 0?{}:{errorMap:(a,r)=>{var n,i;let s=((i=(n=this._def).errorMap)==null?void 0:i.call(n,a,r).message)??r.defaultError;return a.code==="unrecognized_keys"?{message:I.errToObj(e).message??s}:{message:s}}}})}strip(){return new je({...this._def,unknownKeys:"strip"})}passthrough(){return new je({...this._def,unknownKeys:"passthrough"})}extend(e){return new je({...this._def,shape:()=>({...this._def.shape(),...e})})}merge(e){return new je({unknownKeys:e._def.unknownKeys,catchall:e._def.catchall,shape:()=>({...this._def.shape(),...e._def.shape()}),typeName:y.ZodObject})}setKey(e,a){return this.augment({[e]:a})}catchall(e){return new je({...this._def,catchall:e})}pick(e){let a={};for(let r of z.objectKeys(e))e[r]&&this.shape[r]&&(a[r]=this.shape[r]);return new je({...this._def,shape:()=>a})}omit(e){let a={};for(let r of z.objectKeys(this.shape))e[r]||(a[r]=this.shape[r]);return new je({...this._def,shape:()=>a})}deepPartial(){return bt(this)}partial(e){let a={};for(let r of z.objectKeys(this.shape)){let s=this.shape[r];e&&!e[r]?a[r]=s:a[r]=s.optional()}return new je({...this._def,shape:()=>a})}required(e){let a={};for(let r of z.objectKeys(this.shape))if(e&&!e[r])a[r]=this.shape[r];else{let s=this.shape[r];for(;s instanceof qe;)s=s._def.innerType;a[r]=s}return new je({...this._def,shape:()=>a})}keyof(){return ss(z.objectKeys(this.shape))}};Re.create=(t,e)=>new Re({shape:()=>t,unknownKeys:"strip",catchall:nt.create(),typeName:y.ZodObject,...M(e)}),Re.strictCreate=(t,e)=>new Re({shape:()=>t,unknownKeys:"strict",catchall:nt.create(),typeName:y.ZodObject,...M(e)}),Re.lazycreate=(t,e)=>new Re({shape:t,unknownKeys:"strip",catchall:nt.create(),typeName:y.ZodObject,...M(e)});var Gt=class extends Z{_parse(t){let{ctx:e}=this._processInputParams(t),a=this._def.options;function r(s){for(let i of s)if(i.result.status==="valid")return i.result;for(let i of s)if(i.result.status==="dirty")return e.common.issues.push(...i.ctx.common.issues),i.result;let n=s.map(i=>new $e(i.ctx.common.issues));return w(e,{code:g.invalid_union,unionErrors:n}),O}if(e.common.async)return Promise.all(a.map(async s=>{let n={...e,common:{...e.common,issues:[]},parent:null};return{result:await s._parseAsync({data:e.data,path:e.path,parent:n}),ctx:n}})).then(r);{let s,n=[];for(let o of a){let d={...e,common:{...e.common,issues:[]},parent:null},l=o._parseSync({data:e.data,path:e.path,parent:d});if(l.status==="valid")return l;l.status==="dirty"&&!s&&(s={result:l,ctx:d}),d.common.issues.length&&n.push(d.common.issues)}if(s)return e.common.issues.push(...s.ctx.common.issues),s.result;let i=n.map(o=>new $e(o));return w(e,{code:g.invalid_union,unionErrors:i}),O}}get options(){return this._def.options}};Gt.create=(t,e)=>new Gt({options:t,typeName:y.ZodUnion,...M(e)});var it=t=>t instanceof Qt?it(t.schema):t instanceof We?it(t.innerType()):t instanceof Xt?[t.value]:t instanceof ea?t.options:t instanceof ta?z.objectValues(t.enum):t instanceof aa?it(t._def.innerType):t instanceof Jt?[void 0]:t instanceof Yt?[null]:t instanceof qe?[void 0,...it(t.unwrap())]:t instanceof pt?[null,...it(t.unwrap())]:t instanceof ns||t instanceof sa?it(t.unwrap()):t instanceof ra?it(t._def.innerType):[],Co=class _n extends Z{_parse(e){let{ctx:a}=this._processInputParams(e);if(a.parsedType!==k.object)return w(a,{code:g.invalid_type,expected:k.object,received:a.parsedType}),O;let r=this.discriminator,s=a.data[r],n=this.optionsMap.get(s);return n?a.common.async?n._parseAsync({data:a.data,path:a.path,parent:a}):n._parseSync({data:a.data,path:a.path,parent:a}):(w(a,{code:g.invalid_union_discriminator,options:Array.from(this.optionsMap.keys()),path:[r]}),O)}get discriminator(){return this._def.discriminator}get options(){return this._def.options}get optionsMap(){return this._def.optionsMap}static create(e,a,r){let s=new Map;for(let n of a){let i=it(n.shape[e]);if(!i.length)throw Error(`A discriminator value for key \`${e}\` could not be extracted from all schema options`);for(let o of i){if(s.has(o))throw Error(`Discriminator property ${String(e)} has duplicate value ${String(o)}`);s.set(o,n)}}return new _n({typeName:y.ZodDiscriminatedUnion,discriminator:e,options:a,optionsMap:s,...M(r)})}};function $a(t,e){let a=st(t),r=st(e);if(t===e)return{valid:!0,data:t};if(a===k.object&&r===k.object){let s=z.objectKeys(e),n=z.objectKeys(t).filter(o=>s.indexOf(o)!==-1),i={...t,...e};for(let o of n){let d=$a(t[o],e[o]);if(!d.valid)return{valid:!1};i[o]=d.data}return{valid:!0,data:i}}else if(a===k.array&&r===k.array){if(t.length!==e.length)return{valid:!1};let s=[];for(let n=0;n<t.length;n++){let i=t[n],o=e[n],d=$a(i,o);if(!d.valid)return{valid:!1};s.push(d.data)}return{valid:!0,data:s}}else return a===k.date&&r===k.date&&+t==+e?{valid:!0,data:t}:{valid:!1}}var Ht=class extends Z{_parse(t){let{status:e,ctx:a}=this._processInputParams(t),r=(s,n)=>{if(Qr(s)||Qr(n))return O;let i=$a(s.value,n.value);return i.valid?((Xr(s)||Xr(n))&&e.dirty(),{status:e.value,value:i.data}):(w(a,{code:g.invalid_intersection_types}),O)};return a.common.async?Promise.all([this._def.left._parseAsync({data:a.data,path:a.path,parent:a}),this._def.right._parseAsync({data:a.data,path:a.path,parent:a})]).then(([s,n])=>r(s,n)):r(this._def.left._parseSync({data:a.data,path:a.path,parent:a}),this._def.right._parseSync({data:a.data,path:a.path,parent:a}))}};Ht.create=(t,e,a)=>new Ht({left:t,right:e,typeName:y.ZodIntersection,...M(a)});var ct=class bn extends Z{_parse(e){let{status:a,ctx:r}=this._processInputParams(e);if(r.parsedType!==k.array)return w(r,{code:g.invalid_type,expected:k.array,received:r.parsedType}),O;if(r.data.length<this._def.items.length)return w(r,{code:g.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),O;!this._def.rest&&r.data.length>this._def.items.length&&(w(r,{code:g.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),a.dirty());let s=[...r.data].map((n,i)=>{let o=this._def.items[i]||this._def.rest;return o?o._parse(new Le(r,n,r.path,i)):null}).filter(n=>!!n);return r.common.async?Promise.all(s).then(n=>we.mergeArray(a,n)):we.mergeArray(a,s)}get items(){return this._def.items}rest(e){return new bn({...this._def,rest:e})}};ct.create=(t,e)=>{if(!Array.isArray(t))throw Error("You must pass an array of schemas to z.tuple([ ... ])");return new ct({items:t,typeName:y.ZodTuple,rest:null,...M(e)})};var To=class xr extends Z{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){let{status:a,ctx:r}=this._processInputParams(e);if(r.parsedType!==k.object)return w(r,{code:g.invalid_type,expected:k.object,received:r.parsedType}),O;let s=[],n=this._def.keyType,i=this._def.valueType;for(let o in r.data)s.push({key:n._parse(new Le(r,o,r.path,o)),value:i._parse(new Le(r,r.data[o],r.path,o)),alwaysSet:o in r.data});return r.common.async?we.mergeObjectAsync(a,s):we.mergeObjectSync(a,s)}get element(){return this._def.valueType}static create(e,a,r){return a instanceof Z?new xr({keyType:e,valueType:a,typeName:y.ZodRecord,...M(r)}):new xr({keyType:Kt.create(),valueType:e,typeName:y.ZodRecord,...M(a)})}},La=class extends Z{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(t){let{status:e,ctx:a}=this._processInputParams(t);if(a.parsedType!==k.map)return w(a,{code:g.invalid_type,expected:k.map,received:a.parsedType}),O;let r=this._def.keyType,s=this._def.valueType,n=[...a.data.entries()].map(([i,o],d)=>({key:r._parse(new Le(a,i,a.path,[d,"key"])),value:s._parse(new Le(a,o,a.path,[d,"value"]))}));if(a.common.async){let i=new Map;return Promise.resolve().then(async()=>{for(let o of n){let d=await o.key,l=await o.value;if(d.status==="aborted"||l.status==="aborted")return O;(d.status==="dirty"||l.status==="dirty")&&e.dirty(),i.set(d.value,l.value)}return{status:e.value,value:i}})}else{let i=new Map;for(let o of n){let d=o.key,l=o.value;if(d.status==="aborted"||l.status==="aborted")return O;(d.status==="dirty"||l.status==="dirty")&&e.dirty(),i.set(d.value,l.value)}return{status:e.value,value:i}}}};La.create=(t,e,a)=>new La({valueType:e,keyType:t,typeName:y.ZodMap,...M(a)});var Da=class wr extends Z{_parse(e){let{status:a,ctx:r}=this._processInputParams(e);if(r.parsedType!==k.set)return w(r,{code:g.invalid_type,expected:k.set,received:r.parsedType}),O;let s=this._def;s.minSize!==null&&r.data.size<s.minSize.value&&(w(r,{code:g.too_small,minimum:s.minSize.value,type:"set",inclusive:!0,exact:!1,message:s.minSize.message}),a.dirty()),s.maxSize!==null&&r.data.size>s.maxSize.value&&(w(r,{code:g.too_big,maximum:s.maxSize.value,type:"set",inclusive:!0,exact:!1,message:s.maxSize.message}),a.dirty());let n=this._def.valueType;function i(d){let l=new Set;for(let u of d){if(u.status==="aborted")return O;u.status==="dirty"&&a.dirty(),l.add(u.value)}return{status:a.value,value:l}}let o=[...r.data.values()].map((d,l)=>n._parse(new Le(r,d,r.path,l)));return r.common.async?Promise.all(o).then(d=>i(d)):i(o)}min(e,a){return new wr({...this._def,minSize:{value:e,message:I.toString(a)}})}max(e,a){return new wr({...this._def,maxSize:{value:e,message:I.toString(a)}})}size(e,a){return this.min(e,a).max(e,a)}nonempty(e){return this.min(1,e)}};Da.create=(t,e)=>new Da({valueType:t,minSize:null,maxSize:null,typeName:y.ZodSet,...M(e)});var Io=class va extends Z{constructor(){super(...arguments),this.validate=this.implement}_parse(e){let{ctx:a}=this._processInputParams(e);if(a.parsedType!==k.function)return w(a,{code:g.invalid_type,expected:k.function,received:a.parsedType}),O;function r(o,d){return Sa({data:o,path:a.path,errorMaps:[a.common.contextualErrorMap,a.schemaErrorMap,Ea(),Et].filter(l=>!!l),issueData:{code:g.invalid_arguments,argumentsError:d}})}function s(o,d){return Sa({data:o,path:a.path,errorMaps:[a.common.contextualErrorMap,a.schemaErrorMap,Ea(),Et].filter(l=>!!l),issueData:{code:g.invalid_return_type,returnTypeError:d}})}let n={errorMap:a.common.contextualErrorMap},i=a.data;if(this._def.returns instanceof St){let o=this;return ye(async function(...d){let l=new $e([]),u=await o._def.args.parseAsync(d,n).catch(_=>{throw l.addIssue(r(d,_)),l}),p=await Reflect.apply(i,this,u);return await o._def.returns._def.type.parseAsync(p,n).catch(_=>{throw l.addIssue(s(p,_)),l})})}else{let o=this;return ye(function(...d){let l=o._def.args.safeParse(d,n);if(!l.success)throw new $e([r(d,l.error)]);let u=Reflect.apply(i,this,l.data),p=o._def.returns.safeParse(u,n);if(!p.success)throw new $e([s(u,p.error)]);return p.data})}}parameters(){return this._def.args}returnType(){return this._def.returns}args(...e){return new va({...this._def,args:ct.create(e).rest(vt.create())})}returns(e){return new va({...this._def,returns:e})}implement(e){return this.parse(e)}strictImplement(e){return this.parse(e)}static create(e,a,r){return new va({args:e||ct.create([]).rest(vt.create()),returns:a||vt.create(),typeName:y.ZodFunction,...M(r)})}},Qt=class extends Z{get schema(){return this._def.getter()}_parse(t){let{ctx:e}=this._processInputParams(t);return this._def.getter()._parse({data:e.data,path:e.path,parent:e})}};Qt.create=(t,e)=>new Qt({getter:t,typeName:y.ZodLazy,...M(e)});var Xt=class extends Z{_parse(t){if(t.data!==this._def.value){let e=this._getOrReturnCtx(t);return w(e,{received:e.data,code:g.invalid_literal,expected:this._def.value}),O}return{status:"valid",value:t.data}}get value(){return this._def.value}};Xt.create=(t,e)=>new Xt({value:t,typeName:y.ZodLiteral,...M(e)});function ss(t,e){return new ea({values:t,typeName:y.ZodEnum,...M(e)})}var ea=class kr extends Z{_parse(e){if(typeof e.data!="string"){let a=this._getOrReturnCtx(e),r=this._def.values;return w(a,{expected:z.joinValues(r),received:a.parsedType,code:g.invalid_type}),O}if(this._cache||(this._cache=new Set(this._def.values)),!this._cache.has(e.data)){let a=this._getOrReturnCtx(e),r=this._def.values;return w(a,{received:a.data,code:g.invalid_enum_value,options:r}),O}return ye(e.data)}get options(){return this._def.values}get enum(){let e={};for(let a of this._def.values)e[a]=a;return e}get Values(){let e={};for(let a of this._def.values)e[a]=a;return e}get Enum(){let e={};for(let a of this._def.values)e[a]=a;return e}extract(e,a=this._def){return kr.create(e,{...this._def,...a})}exclude(e,a=this._def){return kr.create(this.options.filter(r=>!e.includes(r)),{...this._def,...a})}};ea.create=ss;var ta=class extends Z{_parse(t){let e=z.getValidEnumValues(this._def.values),a=this._getOrReturnCtx(t);if(a.parsedType!==k.string&&a.parsedType!==k.number){let r=z.objectValues(e);return w(a,{expected:z.joinValues(r),received:a.parsedType,code:g.invalid_type}),O}if(this._cache||(this._cache=new Set(z.getValidEnumValues(this._def.values))),!this._cache.has(t.data)){let r=z.objectValues(e);return w(a,{received:a.data,code:g.invalid_enum_value,options:r}),O}return ye(t.data)}get enum(){return this._def.values}};ta.create=(t,e)=>new ta({values:t,typeName:y.ZodNativeEnum,...M(e)});var St=class extends Z{unwrap(){return this._def.type}_parse(t){let{ctx:e}=this._processInputParams(t);if(e.parsedType!==k.promise&&e.common.async===!1)return w(e,{code:g.invalid_type,expected:k.promise,received:e.parsedType}),O;let a=e.parsedType===k.promise?e.data:Promise.resolve(e.data);return ye(a.then(r=>this._def.type.parseAsync(r,{path:e.path,errorMap:e.common.contextualErrorMap})))}};St.create=(t,e)=>new St({type:t,typeName:y.ZodPromise,...M(e)});var We=class extends Z{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===y.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(t){let{status:e,ctx:a}=this._processInputParams(t),r=this._def.effect||null,s={addIssue:n=>{w(a,n),n.fatal?e.abort():e.dirty()},get path(){return a.path}};if(s.addIssue=s.addIssue.bind(s),r.type==="preprocess"){let n=r.transform(a.data,s);if(a.common.async)return Promise.resolve(n).then(async i=>{if(e.value==="aborted")return O;let o=await this._def.schema._parseAsync({data:i,path:a.path,parent:a});return o.status==="aborted"?O:o.status==="dirty"||e.value==="dirty"?Aa(o.value):o});{if(e.value==="aborted")return O;let i=this._def.schema._parseSync({data:n,path:a.path,parent:a});return i.status==="aborted"?O:i.status==="dirty"||e.value==="dirty"?Aa(i.value):i}}if(r.type==="refinement"){let n=i=>{let o=r.refinement(i,s);if(a.common.async)return Promise.resolve(o);if(o instanceof Promise)throw Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return i};if(a.common.async===!1){let i=this._def.schema._parseSync({data:a.data,path:a.path,parent:a});return i.status==="aborted"?O:(i.status==="dirty"&&e.dirty(),n(i.value),{status:e.value,value:i.value})}else return this._def.schema._parseAsync({data:a.data,path:a.path,parent:a}).then(i=>i.status==="aborted"?O:(i.status==="dirty"&&e.dirty(),n(i.value).then(()=>({status:e.value,value:i.value}))))}if(r.type==="transform")if(a.common.async===!1){let n=this._def.schema._parseSync({data:a.data,path:a.path,parent:a});if(!yt(n))return O;let i=r.transform(n.value,s);if(i instanceof Promise)throw Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:e.value,value:i}}else return this._def.schema._parseAsync({data:a.data,path:a.path,parent:a}).then(n=>yt(n)?Promise.resolve(r.transform(n.value,s)).then(i=>({status:e.value,value:i})):O);z.assertNever(r)}};We.create=(t,e,a)=>new We({schema:t,typeName:y.ZodEffects,effect:e,...M(a)}),We.createWithPreprocess=(t,e,a)=>new We({schema:e,effect:{type:"preprocess",transform:t},typeName:y.ZodEffects,...M(a)});var qe=class extends Z{_parse(t){return this._getType(t)===k.undefined?ye(void 0):this._def.innerType._parse(t)}unwrap(){return this._def.innerType}};qe.create=(t,e)=>new qe({innerType:t,typeName:y.ZodOptional,...M(e)});var pt=class extends Z{_parse(t){return this._getType(t)===k.null?ye(null):this._def.innerType._parse(t)}unwrap(){return this._def.innerType}};pt.create=(t,e)=>new pt({innerType:t,typeName:y.ZodNullable,...M(e)});var aa=class extends Z{_parse(t){let{ctx:e}=this._processInputParams(t),a=e.data;return e.parsedType===k.undefined&&(a=this._def.defaultValue()),this._def.innerType._parse({data:a,path:e.path,parent:e})}removeDefault(){return this._def.innerType}};aa.create=(t,e)=>new aa({innerType:t,typeName:y.ZodDefault,defaultValue:typeof e.default=="function"?e.default:()=>e.default,...M(e)});var ra=class extends Z{_parse(t){let{ctx:e}=this._processInputParams(t),a={...e,common:{...e.common,issues:[]}},r=this._def.innerType._parse({data:a.data,path:a.path,parent:{...a}});return qt(r)?r.then(s=>({status:"valid",value:s.status==="valid"?s.value:this._def.catchValue({get error(){return new $e(a.common.issues)},input:a.data})})):{status:"valid",value:r.status==="valid"?r.value:this._def.catchValue({get error(){return new $e(a.common.issues)},input:a.data})}}removeCatch(){return this._def.innerType}};ra.create=(t,e)=>new ra({innerType:t,typeName:y.ZodCatch,catchValue:typeof e.catch=="function"?e.catch:()=>e.catch,...M(e)});var Fa=class extends Z{_parse(t){if(this._getType(t)!==k.nan){let e=this._getOrReturnCtx(t);return w(e,{code:g.invalid_type,expected:k.nan,received:e.parsedType}),O}return{status:"valid",value:t.data}}};Fa.create=t=>new Fa({typeName:y.ZodNaN,...M(t)});var ns=class extends Z{_parse(t){let{ctx:e}=this._processInputParams(t),a=e.data;return this._def.type._parse({data:a,path:e.path,parent:e})}unwrap(){return this._def.type}},is=class xn extends Z{_parse(e){let{status:a,ctx:r}=this._processInputParams(e);if(r.common.async)return(async()=>{let s=await this._def.in._parseAsync({data:r.data,path:r.path,parent:r});return s.status==="aborted"?O:s.status==="dirty"?(a.dirty(),Aa(s.value)):this._def.out._parseAsync({data:s.value,path:r.path,parent:r})})();{let s=this._def.in._parseSync({data:r.data,path:r.path,parent:r});return s.status==="aborted"?O:s.status==="dirty"?(a.dirty(),{status:"dirty",value:s.value}):this._def.out._parseSync({data:s.value,path:r.path,parent:r})}}static create(e,a){return new xn({in:e,out:a,typeName:y.ZodPipeline})}},sa=class extends Z{_parse(t){let e=this._def.innerType._parse(t),a=r=>(yt(r)&&(r.value=Object.freeze(r.value)),r);return qt(e)?e.then(r=>a(r)):a(e)}unwrap(){return this._def.innerType}};sa.create=(t,e)=>new sa({innerType:t,typeName:y.ZodReadonly,...M(e)}),Re.lazycreate;var y;(function(t){t.ZodString="ZodString",t.ZodNumber="ZodNumber",t.ZodNaN="ZodNaN",t.ZodBigInt="ZodBigInt",t.ZodBoolean="ZodBoolean",t.ZodDate="ZodDate",t.ZodSymbol="ZodSymbol",t.ZodUndefined="ZodUndefined",t.ZodNull="ZodNull",t.ZodAny="ZodAny",t.ZodUnknown="ZodUnknown",t.ZodNever="ZodNever",t.ZodVoid="ZodVoid",t.ZodArray="ZodArray",t.ZodObject="ZodObject",t.ZodUnion="ZodUnion",t.ZodDiscriminatedUnion="ZodDiscriminatedUnion",t.ZodIntersection="ZodIntersection",t.ZodTuple="ZodTuple",t.ZodRecord="ZodRecord",t.ZodMap="ZodMap",t.ZodSet="ZodSet",t.ZodFunction="ZodFunction",t.ZodLazy="ZodLazy",t.ZodLiteral="ZodLiteral",t.ZodEnum="ZodEnum",t.ZodEffects="ZodEffects",t.ZodNativeEnum="ZodNativeEnum",t.ZodOptional="ZodOptional",t.ZodNullable="ZodNullable",t.ZodDefault="ZodDefault",t.ZodCatch="ZodCatch",t.ZodPromise="ZodPromise",t.ZodBranded="ZodBranded",t.ZodPipeline="ZodPipeline",t.ZodReadonly="ZodReadonly"})(y||(y={})),Kt.create,Oa.create,Fa.create,Ra.create,Na.create,Ma.create,Pa.create,Jt.create,Yt.create,ja.create,vt.create,nt.create,Za.create,_t.create,Re.create,Re.strictCreate,Gt.create,Co.create,Ht.create,ct.create,To.create,La.create,Da.create,Io.create,Qt.create,Xt.create,ea.create,ta.create,St.create,We.create,qe.create,pt.create,We.createWithPreprocess,is.create;var At=({prefix:t,size:e=16,alphabet:a="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",separator:r="-"}={})=>{let s=()=>{let n=a.length,i=Array(e);for(let o=0;o<e;o++)i[o]=a[Math.random()*n|0];return i.join("")};if(t==null)return s;if(a.includes(r))throw new qi({argument:"separator",message:`The separator "${r}" must not be part of the alphabet "${a}".`});return()=>`${t}${r}${s()}`},Eo=At(),So=/"__proto__"\s*:/,Ao=/"constructor"\s*:/;function Oo(t){let e=JSON.parse(t);return typeof e!="object"||!e||So.test(t)===!1&&Ao.test(t)===!1?e:Ro(e)}function Ro(t){let e=[t];for(;e.length;){let a=e;e=[];for(let r of a){if(Object.prototype.hasOwnProperty.call(r,"__proto__")||Object.prototype.hasOwnProperty.call(r,"constructor")&&Object.prototype.hasOwnProperty.call(r.constructor,"prototype"))throw SyntaxError("Object contains forbidden prototype property");for(let s in r){let n=r[s];n&&typeof n=="object"&&e.push(n)}}}return t}function No(t){let{stackTraceLimit:e}=Error;Error.stackTraceLimit=0;try{return Oo(t)}finally{Error.stackTraceLimit=e}}var na=Symbol.for("vercel.ai.validator");function Mo(t){return{[na]:!0,validate:t}}function Po(t){return typeof t=="object"&&!!t&&na in t&&t[na]===!0&&"validate"in t}function jo(t){return Po(t)?t:Zo(t)}function Zo(t){return Mo(async e=>{let a=await t["~standard"].validate(e);return a.issues==null?{success:!0,value:a.value}:{success:!1,error:new Wt({value:e,cause:a.issues})}})}async function os({value:t,schema:e}){let a=await za({value:t,schema:e});if(!a.success)throw Wt.wrap({value:t,cause:a.error});return a.value}async function za({value:t,schema:e}){let a=jo(e);try{if(a.validate==null)return{success:!0,value:t,rawValue:t};let r=await a.validate(t);return r.success?{success:!0,value:r.value,rawValue:t}:{success:!1,error:Wt.wrap({value:t,cause:r.error}),rawValue:t}}catch(r){return{success:!1,error:Wt.wrap({value:t,cause:r}),rawValue:t}}}async function ia({text:t,schema:e}){try{let a=No(t);return e==null?{success:!0,value:a,rawValue:a}:await za({value:a,schema:e})}catch(a){return{success:!1,error:Kr.isInstance(a)?a:new Kr({text:t,cause:a}),rawValue:void 0}}}function ls({stream:t,schema:e}){return t.pipeThrough(new TextDecoderStream).pipeThrough(new Qi).pipeThrough(new TransformStream({async transform({data:a},r){a!=="[DONE]"&&r.enqueue(await ia({text:a,schema:e}))}}))}async function xt(t){return typeof t=="function"&&(t=t()),Promise.resolve(t)}var $o=(t,e)=>{let a=0;for(;a<t.length&&a<e.length&&t[a]===e[a];a++);return[(t.length-a).toString(),...e.slice(a)].join("/")},Lo=Symbol("Let zodToJsonSchema decide on which parser to use"),ds={name:void 0,$refStrategy:"root",basePath:["#"],effectStrategy:"input",pipeStrategy:"all",dateStrategy:"format:date-time",mapStrategy:"entries",removeAdditionalStrategy:"passthrough",allowedAdditionalProperties:!0,rejectedAdditionalProperties:!1,definitionPath:"definitions",strictUnions:!1,definitions:{},errorMessages:!1,patternStrategy:"escape",applyRegexFlags:!1,emailStrategy:"format:email",base64Strategy:"contentEncoding:base64",nameStrategy:"ref"},Do=t=>typeof t=="string"?{...ds,name:t}:{...ds,...t};function ke(){return{}}function Fo(t,e){var r,s,n;let a={type:"array"};return(r=t.type)!=null&&r._def&&((n=(s=t.type)==null?void 0:s._def)==null?void 0:n.typeName)!==y.ZodAny&&(a.items=K(t.type._def,{...e,currentPath:[...e.currentPath,"items"]})),t.minLength&&(a.minItems=t.minLength.value),t.maxLength&&(a.maxItems=t.maxLength.value),t.exactLength&&(a.minItems=t.exactLength.value,a.maxItems=t.exactLength.value),a}function zo(t){let e={type:"integer",format:"int64"};if(!t.checks)return e;for(let a of t.checks)switch(a.kind){case"min":a.inclusive?e.minimum=a.value:e.exclusiveMinimum=a.value;break;case"max":a.inclusive?e.maximum=a.value:e.exclusiveMaximum=a.value;break;case"multipleOf":e.multipleOf=a.value;break}return e}function Uo(){return{type:"boolean"}}function us(t,e){return K(t.type._def,e)}var Vo=(t,e)=>K(t.innerType._def,e);function cs(t,e,a){let r=a??e.dateStrategy;if(Array.isArray(r))return{anyOf:r.map((s,n)=>cs(t,e,s))};switch(r){case"string":case"format:date-time":return{type:"string",format:"date-time"};case"format:date":return{type:"string",format:"date"};case"integer":return Bo(t)}}var Bo=t=>{let e={type:"integer",format:"unix-time"};for(let a of t.checks)switch(a.kind){case"min":e.minimum=a.value;break;case"max":e.maximum=a.value;break}return e};function Wo(t,e){return{...K(t.innerType._def,e),default:t.defaultValue()}}function qo(t,e){return e.effectStrategy==="input"?K(t.schema._def,e):ke()}function Ko(t){return{type:"string",enum:Array.from(t.values)}}var Jo=t=>"type"in t&&t.type==="string"?!1:"allOf"in t;function Yo(t,e){let a=[K(t.left._def,{...e,currentPath:[...e.currentPath,"allOf","0"]}),K(t.right._def,{...e,currentPath:[...e.currentPath,"allOf","1"]})].filter(s=>!!s),r=[];return a.forEach(s=>{if(Jo(s))r.push(...s.allOf);else{let n=s;if("additionalProperties"in s&&s.additionalProperties===!1){let{additionalProperties:i,...o}=s;n=o}r.push(n)}}),r.length?{allOf:r}:void 0}function Go(t){let e=typeof t.value;return e!=="bigint"&&e!=="number"&&e!=="boolean"&&e!=="string"?{type:Array.isArray(t.value)?"array":"object"}:{type:e==="bigint"?"integer":e,const:t.value}}var Ua=void 0,Ne={cuid:/^[cC][^\s-]{8,}$/,cuid2:/^[0-9a-z]+$/,ulid:/^[0-9A-HJKMNP-TV-Z]{26}$/,email:/^(?!\.)(?!.*\.\.)([a-zA-Z0-9_'+\-\.]*)[a-zA-Z0-9_+-]@([a-zA-Z0-9][a-zA-Z0-9\-]*\.)+[a-zA-Z]{2,}$/,emoji:()=>(Ua===void 0&&(Ua=RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")),Ua),uuid:/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/,ipv4:/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,ipv4Cidr:/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,ipv6:/^(([a-f0-9]{1,4}:){7}|::([a-f0-9]{1,4}:){0,6}|([a-f0-9]{1,4}:){1}:([a-f0-9]{1,4}:){0,5}|([a-f0-9]{1,4}:){2}:([a-f0-9]{1,4}:){0,4}|([a-f0-9]{1,4}:){3}:([a-f0-9]{1,4}:){0,3}|([a-f0-9]{1,4}:){4}:([a-f0-9]{1,4}:){0,2}|([a-f0-9]{1,4}:){5}:([a-f0-9]{1,4}:){0,1})([a-f0-9]{1,4}|(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2})))$/,ipv6Cidr:/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,base64:/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,base64url:/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,nanoid:/^[a-zA-Z0-9_-]{21}$/,jwt:/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/};function ps(t,e){let a={type:"string"};if(t.checks)for(let r of t.checks)switch(r.kind){case"min":a.minLength=typeof a.minLength=="number"?Math.max(a.minLength,r.value):r.value;break;case"max":a.maxLength=typeof a.maxLength=="number"?Math.min(a.maxLength,r.value):r.value;break;case"email":switch(e.emailStrategy){case"format:email":Me(a,"email",r.message,e);break;case"format:idn-email":Me(a,"idn-email",r.message,e);break;case"pattern:zod":fe(a,Ne.email,r.message,e);break}break;case"url":Me(a,"uri",r.message,e);break;case"uuid":Me(a,"uuid",r.message,e);break;case"regex":fe(a,r.regex,r.message,e);break;case"cuid":fe(a,Ne.cuid,r.message,e);break;case"cuid2":fe(a,Ne.cuid2,r.message,e);break;case"startsWith":fe(a,RegExp(`^${Va(r.value,e)}`),r.message,e);break;case"endsWith":fe(a,RegExp(`${Va(r.value,e)}$`),r.message,e);break;case"datetime":Me(a,"date-time",r.message,e);break;case"date":Me(a,"date",r.message,e);break;case"time":Me(a,"time",r.message,e);break;case"duration":Me(a,"duration",r.message,e);break;case"length":a.minLength=typeof a.minLength=="number"?Math.max(a.minLength,r.value):r.value,a.maxLength=typeof a.maxLength=="number"?Math.min(a.maxLength,r.value):r.value;break;case"includes":fe(a,RegExp(Va(r.value,e)),r.message,e);break;case"ip":r.version!=="v6"&&Me(a,"ipv4",r.message,e),r.version!=="v4"&&Me(a,"ipv6",r.message,e);break;case"base64url":fe(a,Ne.base64url,r.message,e);break;case"jwt":fe(a,Ne.jwt,r.message,e);break;case"cidr":r.version!=="v6"&&fe(a,Ne.ipv4Cidr,r.message,e),r.version!=="v4"&&fe(a,Ne.ipv6Cidr,r.message,e);break;case"emoji":fe(a,Ne.emoji(),r.message,e);break;case"ulid":fe(a,Ne.ulid,r.message,e);break;case"base64":switch(e.base64Strategy){case"format:binary":Me(a,"binary",r.message,e);break;case"contentEncoding:base64":a.contentEncoding="base64";break;case"pattern:zod":fe(a,Ne.base64,r.message,e);break}break;case"nanoid":fe(a,Ne.nanoid,r.message,e);case"toLowerCase":case"toUpperCase":case"trim":break;default:}return a}function Va(t,e){return e.patternStrategy==="escape"?Qo(t):t}var Ho=new Set("ABCDEFGHIJKLMNOPQRSTUVXYZabcdefghijklmnopqrstuvxyz0123456789");function Qo(t){let e="";for(let a=0;a<t.length;a++)Ho.has(t[a])||(e+="\\"),e+=t[a];return e}function Me(t,e,a,r){var s;t.format||(s=t.anyOf)!=null&&s.some(n=>n.format)?(t.anyOf||(t.anyOf=[]),t.format&&(t.anyOf.push({format:t.format}),delete t.format),t.anyOf.push({format:e,...a&&r.errorMessages&&{errorMessage:{format:a}}})):t.format=e}function fe(t,e,a,r){var s;t.pattern||(s=t.allOf)!=null&&s.some(n=>n.pattern)?(t.allOf||(t.allOf=[]),t.pattern&&(t.allOf.push({pattern:t.pattern}),delete t.pattern),t.allOf.push({pattern:ms(e,r),...a&&r.errorMessages&&{errorMessage:{pattern:a}}})):t.pattern=ms(e,r)}function ms(t,e){var d;if(!e.applyRegexFlags||!t.flags)return t.source;let a={i:t.flags.includes("i"),m:t.flags.includes("m"),s:t.flags.includes("s")},r=a.i?t.source.toLowerCase():t.source,s="",n=!1,i=!1,o=!1;for(let l=0;l<r.length;l++){if(n){s+=r[l],n=!1;continue}if(a.i){if(i){if(r[l].match(/[a-z]/)){o?(s+=r[l],s+=`${r[l-2]}-${r[l]}`.toUpperCase(),o=!1):r[l+1]==="-"&&((d=r[l+2])!=null&&d.match(/[a-z]/))?(s+=r[l],o=!0):s+=`${r[l]}${r[l].toUpperCase()}`;continue}}else if(r[l].match(/[a-z]/)){s+=`[${r[l]}${r[l].toUpperCase()}]`;continue}}if(a.m){if(r[l]==="^"){s+=`(^|(?<=[\r
]))`;continue}else if(r[l]==="$"){s+=`($|(?=[\r
]))`;continue}}if(a.s&&r[l]==="."){s+=i?`${r[l]}\r
`:`[${r[l]}\r
]`;continue}s+=r[l],r[l]==="\\"?n=!0:i&&r[l]==="]"?i=!1:!i&&r[l]==="["&&(i=!0)}try{new RegExp(s)}catch{return console.warn(`Could not convert regex pattern at ${e.currentPath.join("/")} to a flag-independent form! Falling back to the flag-ignorant source`),t.source}return s}function hs(t,e){var r,s,n,i,o;let a={type:"object",additionalProperties:K(t.valueType._def,{...e,currentPath:[...e.currentPath,"additionalProperties"]})??e.allowedAdditionalProperties};if(((r=t.keyType)==null?void 0:r._def.typeName)===y.ZodString&&((s=t.keyType._def.checks)!=null&&s.length)){let{type:d,...l}=ps(t.keyType._def,e);return{...a,propertyNames:l}}else{if(((n=t.keyType)==null?void 0:n._def.typeName)===y.ZodEnum)return{...a,propertyNames:{enum:t.keyType._def.values}};if(((i=t.keyType)==null?void 0:i._def.typeName)===y.ZodBranded&&t.keyType._def.type._def.typeName===y.ZodString&&((o=t.keyType._def.type._def.checks)!=null&&o.length)){let{type:d,...l}=us(t.keyType._def,e);return{...a,propertyNames:l}}}return a}function Xo(t,e){if(e.mapStrategy==="record")return hs(t,e);let a=K(t.keyType._def,{...e,currentPath:[...e.currentPath,"items","items","0"]})||ke(),r=K(t.valueType._def,{...e,currentPath:[...e.currentPath,"items","items","1"]})||ke();return{type:"array",maxItems:125,items:{type:"array",items:[a,r],minItems:2,maxItems:2}}}function el(t){let e=t.values,a=Object.keys(t.values).filter(s=>typeof e[e[s]]!="number").map(s=>e[s]),r=Array.from(new Set(a.map(s=>typeof s)));return{type:r.length===1?r[0]==="string"?"string":"number":["string","number"],enum:a}}function tl(){return{not:ke()}}function al(){return{type:"null"}}var Ba={ZodString:"string",ZodNumber:"number",ZodBigInt:"integer",ZodBoolean:"boolean",ZodNull:"null"};function rl(t,e){let a=t.options instanceof Map?Array.from(t.options.values()):t.options;if(a.every(r=>r._def.typeName in Ba&&(!r._def.checks||!r._def.checks.length))){let r=a.reduce((s,n)=>{let i=Ba[n._def.typeName];return i&&!s.includes(i)?[...s,i]:s},[]);return{type:r.length>1?r:r[0]}}else if(a.every(r=>r._def.typeName==="ZodLiteral"&&!r.description)){let r=a.reduce((s,n)=>{let i=typeof n._def.value;switch(i){case"string":case"number":case"boolean":return[...s,i];case"bigint":return[...s,"integer"];case"object":if(n._def.value===null)return[...s,"null"];case"symbol":case"undefined":case"function":default:return s}},[]);if(r.length===a.length){let s=r.filter((n,i,o)=>o.indexOf(n)===i);return{type:s.length>1?s:s[0],enum:a.reduce((n,i)=>n.includes(i._def.value)?n:[...n,i._def.value],[])}}}else if(a.every(r=>r._def.typeName==="ZodEnum"))return{type:"string",enum:a.reduce((r,s)=>[...r,...s._def.values.filter(n=>!r.includes(n))],[])};return sl(t,e)}var sl=(t,e)=>{let a=(t.options instanceof Map?Array.from(t.options.values()):t.options).map((r,s)=>K(r._def,{...e,currentPath:[...e.currentPath,"anyOf",`${s}`]})).filter(r=>!!r&&(!e.strictUnions||typeof r=="object"&&Object.keys(r).length>0));return a.length?{anyOf:a}:void 0};function nl(t,e){if(["ZodString","ZodNumber","ZodBigInt","ZodBoolean","ZodNull"].includes(t.innerType._def.typeName)&&(!t.innerType._def.checks||!t.innerType._def.checks.length))return{type:[Ba[t.innerType._def.typeName],"null"]};let a=K(t.innerType._def,{...e,currentPath:[...e.currentPath,"anyOf","0"]});return a&&{anyOf:[a,{type:"null"}]}}function il(t){let e={type:"number"};if(!t.checks)return e;for(let a of t.checks)switch(a.kind){case"int":e.type="integer";break;case"min":a.inclusive?e.minimum=a.value:e.exclusiveMinimum=a.value;break;case"max":a.inclusive?e.maximum=a.value:e.exclusiveMaximum=a.value;break;case"multipleOf":e.multipleOf=a.value;break}return e}function ol(t,e){let a={type:"object",properties:{}},r=[],s=t.shape();for(let i in s){let o=s[i];if(o===void 0||o._def===void 0)continue;let d=dl(o),l=K(o._def,{...e,currentPath:[...e.currentPath,"properties",i],propertyPath:[...e.currentPath,"properties",i]});l!==void 0&&(a.properties[i]=l,d||r.push(i))}r.length&&(a.required=r);let n=ll(t,e);return n!==void 0&&(a.additionalProperties=n),a}function ll(t,e){if(t.catchall._def.typeName!=="ZodNever")return K(t.catchall._def,{...e,currentPath:[...e.currentPath,"additionalProperties"]});switch(t.unknownKeys){case"passthrough":return e.allowedAdditionalProperties;case"strict":return e.rejectedAdditionalProperties;case"strip":return e.removeAdditionalStrategy==="strict"?e.allowedAdditionalProperties:e.rejectedAdditionalProperties}}function dl(t){try{return t.isOptional()}catch{return!0}}var ul=(t,e)=>{var r;if(e.currentPath.toString()===((r=e.propertyPath)==null?void 0:r.toString()))return K(t.innerType._def,e);let a=K(t.innerType._def,{...e,currentPath:[...e.currentPath,"anyOf","1"]});return a?{anyOf:[{not:ke()},a]}:ke()},cl=(t,e)=>{if(e.pipeStrategy==="input")return K(t.in._def,e);if(e.pipeStrategy==="output")return K(t.out._def,e);let a=K(t.in._def,{...e,currentPath:[...e.currentPath,"allOf","0"]}),r=K(t.out._def,{...e,currentPath:[...e.currentPath,"allOf",a?"1":"0"]});return{allOf:[a,r].filter(s=>s!==void 0)}};function pl(t,e){return K(t.type._def,e)}function ml(t,e){let a={type:"array",uniqueItems:!0,items:K(t.valueType._def,{...e,currentPath:[...e.currentPath,"items"]})};return t.minSize&&(a.minItems=t.minSize.value),t.maxSize&&(a.maxItems=t.maxSize.value),a}function hl(t,e){return t.rest?{type:"array",minItems:t.items.length,items:t.items.map((a,r)=>K(a._def,{...e,currentPath:[...e.currentPath,"items",`${r}`]})).reduce((a,r)=>r===void 0?a:[...a,r],[]),additionalItems:K(t.rest._def,{...e,currentPath:[...e.currentPath,"additionalItems"]})}:{type:"array",minItems:t.items.length,maxItems:t.items.length,items:t.items.map((a,r)=>K(a._def,{...e,currentPath:[...e.currentPath,"items",`${r}`]})).reduce((a,r)=>r===void 0?a:[...a,r],[])}}function fl(){return{not:ke()}}function gl(){return ke()}var yl=(t,e)=>K(t.innerType._def,e),vl=(t,e,a)=>{switch(e){case y.ZodString:return ps(t,a);case y.ZodNumber:return il(t);case y.ZodObject:return ol(t,a);case y.ZodBigInt:return zo(t);case y.ZodBoolean:return Uo();case y.ZodDate:return cs(t,a);case y.ZodUndefined:return fl();case y.ZodNull:return al();case y.ZodArray:return Fo(t,a);case y.ZodUnion:case y.ZodDiscriminatedUnion:return rl(t,a);case y.ZodIntersection:return Yo(t,a);case y.ZodTuple:return hl(t,a);case y.ZodRecord:return hs(t,a);case y.ZodLiteral:return Go(t);case y.ZodEnum:return Ko(t);case y.ZodNativeEnum:return el(t);case y.ZodNullable:return nl(t,a);case y.ZodOptional:return ul(t,a);case y.ZodMap:return Xo(t,a);case y.ZodSet:return ml(t,a);case y.ZodLazy:return()=>t.getter()._def;case y.ZodPromise:return pl(t,a);case y.ZodNaN:case y.ZodNever:return tl();case y.ZodEffects:return qo(t,a);case y.ZodAny:return ke();case y.ZodUnknown:return gl();case y.ZodDefault:return Wo(t,a);case y.ZodBranded:return us(t,a);case y.ZodReadonly:return yl(t,a);case y.ZodCatch:return Vo(t,a);case y.ZodPipeline:return cl(t,a);case y.ZodFunction:case y.ZodVoid:case y.ZodSymbol:return;default:return(r=>{})(e)}};function K(t,e,a=!1){var o;let r=e.seen.get(t);if(e.override){let d=(o=e.override)==null?void 0:o.call(e,t,e,r,a);if(d!==Lo)return d}if(r&&!a){let d=_l(r,e);if(d!==void 0)return d}let s={def:t,path:e.currentPath,jsonSchema:void 0};e.seen.set(t,s);let n=vl(t,t.typeName,e),i=typeof n=="function"?K(n(),e):n;if(i&&bl(t,e,i),e.postProcess){let d=e.postProcess(i,t,e);return s.jsonSchema=i,d}return s.jsonSchema=i,i}var _l=(t,e)=>{switch(e.$refStrategy){case"root":return{$ref:t.path.join("/")};case"relative":return{$ref:$o(e.currentPath,t.path)};case"none":case"seen":return t.path.length<e.currentPath.length&&t.path.every((a,r)=>e.currentPath[r]===a)?(console.warn(`Recursive reference detected at ${e.currentPath.join("/")}! Defaulting to any`),ke()):e.$refStrategy==="seen"?ke():void 0}},bl=(t,e,a)=>(t.description&&(a.description=t.description),a),xl=t=>{let e=Do(t),a=e.name===void 0?e.basePath:[...e.basePath,e.definitionPath,e.name];return{...e,currentPath:a,propertyPath:void 0,seen:new Map(Object.entries(e.definitions).map(([r,s])=>[s._def,{def:s._def,path:[...e.basePath,e.definitionPath,r],jsonSchema:void 0}]))}},wl=(t,e)=>{let a=xl(e),r=typeof e=="object"&&e.definitions?Object.entries(e.definitions).reduce((d,[l,u])=>({...d,[l]:K(u._def,{...a,currentPath:[...a.basePath,a.definitionPath,l]},!0)??ke()}),{}):void 0,s=typeof e=="string"?e:(e==null?void 0:e.nameStrategy)==="title"||e==null?void 0:e.name,n=K(t._def,s===void 0?a:{...a,currentPath:[...a.basePath,a.definitionPath,s]},!1)??ke(),i=typeof e=="object"&&e.name!==void 0&&e.nameStrategy==="title"?e.name:void 0;i!==void 0&&(n.title=i);let o=s===void 0?r?{...n,[a.definitionPath]:r}:n:{$ref:[...a.$refStrategy==="relative"?[]:a.basePath,a.definitionPath,s].join("/"),[a.definitionPath]:{...r,[s]:n}};return o.$schema="http://json-schema.org/draft-07/schema#",o};function kl(t,e){let a=(e==null?void 0:e.useReferences)??!1;return qa(wl(t,{$refStrategy:a?"root":"none"}),{validate:async r=>{let s=await t.safeParseAsync(r);return s.success?{success:!0,value:s.data}:{success:!1,error:s.error}}})}function Cl(t,e){let a=(e==null?void 0:e.useReferences)??!1,r=Er(t,{target:"draft-7",io:"output",reused:a?"ref":"inline"});return qa(r,{validate:async s=>{let n=await Qn(t,s);return n.success?{success:!0,value:n.data}:{success:!1,error:n.error}}})}function Tl(t){return"_zod"in t}function Il(t,e){return Tl(t)?Cl(t,e):kl(t,e)}var Wa=Symbol.for("vercel.ai.schema");function qa(t,{validate:e}={}){return{[Wa]:!0,_type:void 0,[na]:!0,jsonSchema:t,validate:e}}function El(t){return typeof t=="object"&&!!t&&Wa in t&&t[Wa]===!0&&"jsonSchema"in t&&"validate"in t}function Sl(t){return t==null?qa({properties:{},additionalProperties:!1}):El(t)?t:Il(t)}var{btoa:Uc,atob:Vc}=globalThis,Al=Object.defineProperty,Ol=(t,e)=>{for(var a in e)Al(t,a,{get:e[a],enumerable:!0})},fs="AI_NoObjectGeneratedError",gs=`vercel.ai.error.${fs}`,Rl=Symbol.for(gs),ys,vs=class extends rt{constructor({message:t="No object generated.",cause:e,text:a,response:r,usage:s,finishReason:n}){super({name:fs,message:t,cause:e}),this[ys]=!0,this.text=a,this.response=r,this.usage=s,this.finishReason=n}static isInstance(t){return rt.hasMarker(t,gs)}};ys=Rl;var _s=ue([h(),Ut(Uint8Array),Ut(ArrayBuffer),Yn(t=>{var e;return((e=globalThis.Buffer)==null?void 0:e.isBuffer(t))??!1},{message:"Must be a Buffer"})]),Ot=Xn(()=>ue([Hn(),h(),It(),re(),xa(h(),Ot),Be(Ot)])),D=xa(h(),xa(h(),Ot)),bs=S({type:C("text"),text:h(),providerOptions:D.optional()}),Nl=S({type:C("image"),image:ue([_s,Ut(URL)]),mediaType:h().optional(),providerOptions:D.optional()}),xs=S({type:C("file"),data:ue([_s,Ut(URL)]),filename:h().optional(),mediaType:h(),providerOptions:D.optional()}),Ml=S({type:C("reasoning"),text:h(),providerOptions:D.optional()}),Pl=S({type:C("tool-call"),toolCallId:h(),toolName:h(),input:te(),providerOptions:D.optional(),providerExecuted:re().optional()}),jl=Gn("type",[S({type:C("text"),value:h()}),S({type:C("json"),value:Ot}),S({type:C("error-text"),value:h()}),S({type:C("error-json"),value:Ot}),S({type:C("content"),value:Be(ue([S({type:C("text"),text:h()}),S({type:C("media"),data:h(),mediaType:h()})]))})]),ws=S({type:C("tool-result"),toolCallId:h(),toolName:h(),output:jl,providerOptions:D.optional()}),Zl=S({role:C("system"),content:h(),providerOptions:D.optional()}),$l=S({role:C("user"),content:ue([h(),Be(ue([bs,Nl,xs]))]),providerOptions:D.optional()}),Ll=S({role:C("assistant"),content:ue([h(),Be(ue([bs,xs,Ml,Pl,ws]))]),providerOptions:D.optional()}),Dl=S({role:C("tool"),content:Be(ws),providerOptions:D.optional()});ue([Zl,$l,Ll,Dl]),At({prefix:"aitxt",size:24});var ks=ue([H({type:C("text-start"),id:h(),providerMetadata:D.optional()}),H({type:C("text-delta"),id:h(),delta:h(),providerMetadata:D.optional()}),H({type:C("text-end"),id:h(),providerMetadata:D.optional()}),H({type:C("error"),errorText:h()}),H({type:C("tool-input-start"),toolCallId:h(),toolName:h(),providerExecuted:re().optional(),dynamic:re().optional()}),H({type:C("tool-input-delta"),toolCallId:h(),inputTextDelta:h()}),H({type:C("tool-input-available"),toolCallId:h(),toolName:h(),input:te(),providerExecuted:re().optional(),providerMetadata:D.optional(),dynamic:re().optional()}),H({type:C("tool-input-error"),toolCallId:h(),toolName:h(),input:te(),providerExecuted:re().optional(),providerMetadata:D.optional(),dynamic:re().optional(),errorText:h()}),H({type:C("tool-output-available"),toolCallId:h(),output:te(),providerExecuted:re().optional(),dynamic:re().optional(),preliminary:re().optional()}),H({type:C("tool-output-error"),toolCallId:h(),errorText:h(),providerExecuted:re().optional(),dynamic:re().optional()}),H({type:C("reasoning"),text:h(),providerMetadata:D.optional()}),H({type:C("reasoning-start"),id:h(),providerMetadata:D.optional()}),H({type:C("reasoning-delta"),id:h(),delta:h(),providerMetadata:D.optional()}),H({type:C("reasoning-end"),id:h(),providerMetadata:D.optional()}),H({type:C("reasoning-part-finish")}),H({type:C("source-url"),sourceId:h(),url:h(),title:h().optional(),providerMetadata:D.optional()}),H({type:C("source-document"),sourceId:h(),mediaType:h(),title:h(),filename:h().optional(),providerMetadata:D.optional()}),H({type:C("file"),url:h(),mediaType:h(),providerMetadata:D.optional()}),H({type:h().startsWith("data-"),id:h().optional(),data:te(),transient:re().optional()}),H({type:C("start-step")}),H({type:C("finish-step")}),H({type:C("start"),messageId:h().optional(),messageMetadata:te().optional()}),H({type:C("finish"),messageMetadata:te().optional()}),H({type:C("abort")}),H({type:C("message-metadata"),messageMetadata:te()})]);function Fl(t){return t.type.startsWith("data-")}function Cs(t,e){if(t===void 0&&e===void 0)return;if(t===void 0)return e;if(e===void 0)return t;let a={...t};for(let r in e)if(Object.prototype.hasOwnProperty.call(e,r)){let s=e[r];if(s===void 0)continue;let n=r in t?t[r]:void 0,i=typeof s=="object"&&!!s&&!Array.isArray(s)&&!(s instanceof Date)&&!(s instanceof RegExp),o=typeof n=="object"&&!!n&&!Array.isArray(n)&&!(n instanceof Date)&&!(n instanceof RegExp);i&&o?a[r]=Cs(n,s):a[r]=s}return a}function zl(t){let e=["ROOT"],a=-1,r=null;function s(d,l,u){switch(d){case'"':a=l,e.pop(),e.push(u),e.push("INSIDE_STRING");break;case"f":case"t":case"n":a=l,r=l,e.pop(),e.push(u),e.push("INSIDE_LITERAL");break;case"-":e.pop(),e.push(u),e.push("INSIDE_NUMBER");break;case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":a=l,e.pop(),e.push(u),e.push("INSIDE_NUMBER");break;case"{":a=l,e.pop(),e.push(u),e.push("INSIDE_OBJECT_START");break;case"[":a=l,e.pop(),e.push(u),e.push("INSIDE_ARRAY_START");break}}function n(d,l){switch(d){case",":e.pop(),e.push("INSIDE_OBJECT_AFTER_COMMA");break;case"}":a=l,e.pop();break}}function i(d,l){switch(d){case",":e.pop(),e.push("INSIDE_ARRAY_AFTER_COMMA");break;case"]":a=l,e.pop();break}}for(let d=0;d<t.length;d++){let l=t[d];switch(e[e.length-1]){case"ROOT":s(l,d,"FINISH");break;case"INSIDE_OBJECT_START":switch(l){case'"':e.pop(),e.push("INSIDE_OBJECT_KEY");break;case"}":a=d,e.pop();break}break;case"INSIDE_OBJECT_AFTER_COMMA":switch(l){case'"':e.pop(),e.push("INSIDE_OBJECT_KEY");break}break;case"INSIDE_OBJECT_KEY":switch(l){case'"':e.pop(),e.push("INSIDE_OBJECT_AFTER_KEY");break}break;case"INSIDE_OBJECT_AFTER_KEY":switch(l){case":":e.pop(),e.push("INSIDE_OBJECT_BEFORE_VALUE");break}break;case"INSIDE_OBJECT_BEFORE_VALUE":s(l,d,"INSIDE_OBJECT_AFTER_VALUE");break;case"INSIDE_OBJECT_AFTER_VALUE":n(l,d);break;case"INSIDE_STRING":switch(l){case'"':e.pop(),a=d;break;case"\\":e.push("INSIDE_STRING_ESCAPE");break;default:a=d}break;case"INSIDE_ARRAY_START":switch(l){case"]":a=d,e.pop();break;default:a=d,s(l,d,"INSIDE_ARRAY_AFTER_VALUE");break}break;case"INSIDE_ARRAY_AFTER_VALUE":switch(l){case",":e.pop(),e.push("INSIDE_ARRAY_AFTER_COMMA");break;case"]":a=d,e.pop();break;default:a=d;break}break;case"INSIDE_ARRAY_AFTER_COMMA":s(l,d,"INSIDE_ARRAY_AFTER_VALUE");break;case"INSIDE_STRING_ESCAPE":e.pop(),a=d;break;case"INSIDE_NUMBER":switch(l){case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":a=d;break;case"e":case"E":case"-":case".":break;case",":e.pop(),e[e.length-1]==="INSIDE_ARRAY_AFTER_VALUE"&&i(l,d),e[e.length-1]==="INSIDE_OBJECT_AFTER_VALUE"&&n(l,d);break;case"}":e.pop(),e[e.length-1]==="INSIDE_OBJECT_AFTER_VALUE"&&n(l,d);break;case"]":e.pop(),e[e.length-1]==="INSIDE_ARRAY_AFTER_VALUE"&&i(l,d);break;default:e.pop();break}break;case"INSIDE_LITERAL":{let u=t.substring(r,d+1);!"false".startsWith(u)&&!"true".startsWith(u)&&!"null".startsWith(u)?(e.pop(),e[e.length-1]==="INSIDE_OBJECT_AFTER_VALUE"?n(l,d):e[e.length-1]==="INSIDE_ARRAY_AFTER_VALUE"&&i(l,d)):a=d;break}}}let o=t.slice(0,a+1);for(let d=e.length-1;d>=0;d--)switch(e[d]){case"INSIDE_STRING":o+='"';break;case"INSIDE_OBJECT_KEY":case"INSIDE_OBJECT_AFTER_KEY":case"INSIDE_OBJECT_AFTER_COMMA":case"INSIDE_OBJECT_START":case"INSIDE_OBJECT_BEFORE_VALUE":case"INSIDE_OBJECT_AFTER_VALUE":o+="}";break;case"INSIDE_ARRAY_START":case"INSIDE_ARRAY_AFTER_COMMA":case"INSIDE_ARRAY_AFTER_VALUE":o+="]";break;case"INSIDE_LITERAL":{let l=t.substring(r,t.length);"true".startsWith(l)?o+="true".slice(l.length):"false".startsWith(l)?o+="false".slice(l.length):"null".startsWith(l)&&(o+="null".slice(l.length))}}return o}async function Ts(t){if(t===void 0)return{value:void 0,state:"undefined-input"};let e=await ia({text:t});return e.success?{value:e.value,state:"successful-parse"}:(e=await ia({text:zl(t)}),e.success?{value:e.value,state:"repaired-parse"}:{value:void 0,state:"failed-parse"})}function oa(t){return t.type.startsWith("tool-")}function Ul(t){return t.type==="dynamic-tool"}function Is(t){return oa(t)||Ul(t)}function Es(t){return t.type.split("-").slice(1).join("-")}function Vl({lastMessage:t,messageId:e}){return{message:(t==null?void 0:t.role)==="assistant"?t:{id:e,metadata:void 0,role:"assistant",parts:[]},activeTextParts:{},activeReasoningParts:{},partialToolCalls:{}}}function Bl({stream:t,messageMetadataSchema:e,dataPartSchemas:a,runUpdateMessageJob:r,onError:s,onToolCall:n,onData:i}){return t.pipeThrough(new TransformStream({async transform(o,d){await r(async({state:l,write:u})=>{function p(c){let m=l.message.parts.filter(oa).find(b=>b.toolCallId===c);if(m==null)throw Error("tool-output-error must be preceded by a tool-input-available");return m}function _(c){let m=l.message.parts.filter(b=>b.type==="dynamic-tool").find(b=>b.toolCallId===c);if(m==null)throw Error("tool-output-error must be preceded by a tool-input-available");return m}function v(c){let m=l.message.parts.find(A=>oa(A)&&A.toolCallId===c.toolCallId),b=c,T=m;m==null?l.message.parts.push({type:`tool-${c.toolName}`,toolCallId:c.toolCallId,state:c.state,input:b.input,output:b.output,rawInput:b.rawInput,errorText:b.errorText,providerExecuted:b.providerExecuted,preliminary:b.preliminary,...b.providerMetadata==null?{}:{callProviderMetadata:b.providerMetadata}}):(m.state=c.state,T.input=b.input,T.output=b.output,T.errorText=b.errorText,T.rawInput=b.rawInput,T.preliminary=b.preliminary,T.providerExecuted=b.providerExecuted??m.providerExecuted,b.providerMetadata!=null&&m.state==="input-available"&&(m.callProviderMetadata=b.providerMetadata))}function x(c){let m=l.message.parts.find(A=>A.type==="dynamic-tool"&&A.toolCallId===c.toolCallId),b=c,T=m;m==null?l.message.parts.push({type:"dynamic-tool",toolName:c.toolName,toolCallId:c.toolCallId,state:c.state,input:b.input,output:b.output,errorText:b.errorText,preliminary:b.preliminary,...b.providerMetadata==null?{}:{callProviderMetadata:b.providerMetadata}}):(m.state=c.state,T.toolName=c.toolName,T.input=b.input,T.output=b.output,T.errorText=b.errorText,T.rawInput=b.rawInput??T.rawInput,T.preliminary=b.preliminary,b.providerMetadata!=null&&m.state==="input-available"&&(m.callProviderMetadata=b.providerMetadata))}async function f(c){if(c!=null){let m=l.message.metadata==null?c:Cs(l.message.metadata,c);e!=null&&await os({value:m,schema:e}),l.message.metadata=m}}switch(o.type){case"text-start":{let c={type:"text",text:"",providerMetadata:o.providerMetadata,state:"streaming"};l.activeTextParts[o.id]=c,l.message.parts.push(c),u();break}case"text-delta":{let c=l.activeTextParts[o.id];c.text+=o.delta,c.providerMetadata=o.providerMetadata??c.providerMetadata,u();break}case"text-end":{let c=l.activeTextParts[o.id];c.state="done",c.providerMetadata=o.providerMetadata??c.providerMetadata,delete l.activeTextParts[o.id],u();break}case"reasoning-start":{let c={type:"reasoning",text:"",providerMetadata:o.providerMetadata,state:"streaming"};l.activeReasoningParts[o.id]=c,l.message.parts.push(c),u();break}case"reasoning-delta":{let c=l.activeReasoningParts[o.id];c.text+=o.delta,c.providerMetadata=o.providerMetadata??c.providerMetadata,u();break}case"reasoning-end":{let c=l.activeReasoningParts[o.id];c.providerMetadata=o.providerMetadata??c.providerMetadata,c.state="done",delete l.activeReasoningParts[o.id],u();break}case"file":l.message.parts.push({type:"file",mediaType:o.mediaType,url:o.url}),u();break;case"source-url":l.message.parts.push({type:"source-url",sourceId:o.sourceId,url:o.url,title:o.title,providerMetadata:o.providerMetadata}),u();break;case"source-document":l.message.parts.push({type:"source-document",sourceId:o.sourceId,mediaType:o.mediaType,title:o.title,filename:o.filename,providerMetadata:o.providerMetadata}),u();break;case"tool-input-start":{let c=l.message.parts.filter(oa);l.partialToolCalls[o.toolCallId]={text:"",toolName:o.toolName,index:c.length,dynamic:o.dynamic},o.dynamic?x({toolCallId:o.toolCallId,toolName:o.toolName,state:"input-streaming",input:void 0}):v({toolCallId:o.toolCallId,toolName:o.toolName,state:"input-streaming",input:void 0,providerExecuted:o.providerExecuted}),u();break}case"tool-input-delta":{let c=l.partialToolCalls[o.toolCallId];c.text+=o.inputTextDelta;let{value:m}=await Ts(c.text);c.dynamic?x({toolCallId:o.toolCallId,toolName:c.toolName,state:"input-streaming",input:m}):v({toolCallId:o.toolCallId,toolName:c.toolName,state:"input-streaming",input:m}),u();break}case"tool-input-available":o.dynamic?x({toolCallId:o.toolCallId,toolName:o.toolName,state:"input-available",input:o.input,providerMetadata:o.providerMetadata}):v({toolCallId:o.toolCallId,toolName:o.toolName,state:"input-available",input:o.input,providerExecuted:o.providerExecuted,providerMetadata:o.providerMetadata}),u(),n&&!o.providerExecuted&&await n({toolCall:o});break;case"tool-input-error":o.dynamic?x({toolCallId:o.toolCallId,toolName:o.toolName,state:"output-error",input:o.input,errorText:o.errorText,providerMetadata:o.providerMetadata}):v({toolCallId:o.toolCallId,toolName:o.toolName,state:"output-error",input:void 0,rawInput:o.input,errorText:o.errorText,providerExecuted:o.providerExecuted,providerMetadata:o.providerMetadata}),u();break;case"tool-output-available":if(o.dynamic){let c=_(o.toolCallId);x({toolCallId:o.toolCallId,toolName:c.toolName,state:"output-available",input:c.input,output:o.output,preliminary:o.preliminary})}else{let c=p(o.toolCallId);v({toolCallId:o.toolCallId,toolName:Es(c),state:"output-available",input:c.input,output:o.output,providerExecuted:o.providerExecuted,preliminary:o.preliminary})}u();break;case"tool-output-error":if(o.dynamic){let c=_(o.toolCallId);x({toolCallId:o.toolCallId,toolName:c.toolName,state:"output-error",input:c.input,errorText:o.errorText})}else{let c=p(o.toolCallId);v({toolCallId:o.toolCallId,toolName:Es(c),state:"output-error",input:c.input,rawInput:c.rawInput,errorText:o.errorText})}u();break;case"start-step":l.message.parts.push({type:"step-start"});break;case"finish-step":l.activeTextParts={},l.activeReasoningParts={};break;case"start":o.messageId!=null&&(l.message.id=o.messageId),await f(o.messageMetadata),(o.messageId!=null||o.messageMetadata!=null)&&u();break;case"finish":await f(o.messageMetadata),o.messageMetadata!=null&&u();break;case"message-metadata":await f(o.messageMetadata),o.messageMetadata!=null&&u();break;case"error":s==null||s(Error(o.errorText));break;default:if(Fl(o)){(a==null?void 0:a[o.type])!=null&&await os({value:o.data,schema:a[o.type]});let c=o;if(c.transient){i==null||i(c);break}let m=c.id==null?void 0:l.message.parts.find(b=>c.type===b.type&&c.id===b.id);m==null?l.message.parts.push(c):m.data=c.data,i==null||i(c),u()}}d.enqueue(o)})}}))}async function Ss({stream:t,onError:e}){let a=t.getReader();try{for(;;){let{done:r}=await a.read();if(r)break}}catch(r){e==null||e(r)}finally{a.releaseLock()}}At({prefix:"aitxt",size:24}),At({prefix:"aiobj",size:24});var Wl=class{constructor(){this.queue=[],this.isProcessing=!1}async processQueue(){if(!this.isProcessing){for(this.isProcessing=!0;this.queue.length>0;)await this.queue[0](),this.queue.shift();this.isProcessing=!1}}async run(t){return new Promise((e,a)=>{this.queue.push(async()=>{try{await t(),e()}catch(r){a(r)}}),this.processQueue()})}};At({prefix:"aiobj",size:24}),Ol({},{object:()=>Kl,text:()=>ql});var ql=()=>({type:"text",responseFormat:{type:"text"},async parsePartial({text:t}){return{partial:t}},async parseOutput({text:t}){return t}}),Kl=({schema:t})=>{let e=Sl(t);return{type:"object",responseFormat:{type:"json",schema:e.jsonSchema},async parsePartial({text:a}){let r=await Ts(a);switch(r.state){case"failed-parse":case"undefined-input":return;case"repaired-parse":case"successful-parse":return{partial:r.value};default:{let s=r.state;throw Error(`Unsupported parse state: ${s}`)}}},async parseOutput({text:a},r){let s=await ia({text:a});if(!s.success)throw new vs({message:"No object generated: could not parse the response.",cause:s.error,text:a,response:r.response,usage:r.usage,finishReason:r.finishReason});let n=await za({value:s.value,schema:e});if(!n.success)throw new vs({message:"No object generated: response did not match schema.",cause:n.error,text:a,response:r.response,usage:r.usage,finishReason:r.finishReason});return n.value}}},Jl=gt({name:h(),version:h()}),Ka=gt({_meta:de(S({}).loose())}),Rt=Ka,Yl=S({method:h(),params:de(Ka)}),Gl=gt({experimental:de(S({}).loose()),logging:de(S({}).loose()),prompts:de(gt({listChanged:de(re())})),resources:de(gt({subscribe:de(re()),listChanged:de(re())})),tools:de(gt({listChanged:de(re())}))});Rt.extend({protocolVersion:h(),capabilities:Gl,serverInfo:Jl,instructions:de(h())});var Hl=Rt.extend({nextCursor:de(h())}),Ql=S({name:h(),description:de(h()),inputSchema:S({type:C("object"),properties:de(S({}).loose())}).loose()}).loose();Hl.extend({tools:Be(Ql)});var Xl=S({type:C("text"),text:h()}).loose(),ed=S({type:C("image"),data:Sr(),mimeType:h()}).loose(),As=S({uri:h(),mimeType:de(h())}).loose(),td=As.extend({text:h()}),ad=As.extend({blob:Sr()}),rd=S({type:C("resource"),resource:ue([td,ad])}).loose();Rt.extend({content:Be(ue([Xl,ed,rd])),isError:re().default(!1).optional()}).or(Rt.extend({toolResult:te()}));var la="2.0",sd=S({jsonrpc:C(la),id:ue([h(),It().int()])}).merge(Yl).strict(),nd=S({jsonrpc:C(la),id:ue([h(),It().int()]),result:Rt}).strict(),id=S({jsonrpc:C(la),id:ue([h(),It().int()]),error:S({code:It().int(),message:h(),data:de(te())})}).strict(),od=S({jsonrpc:C(la)}).merge(S({method:h(),params:de(Ka)})).strict();ue([sd,od,nd,id]);async function ld({stream:t,onTextPart:e}){let a=t.pipeThrough(new TextDecoderStream).getReader();for(;;){let{done:r,value:s}=await a.read();if(r)break;await e(s)}}var dd=()=>fetch;async function ud({api:t,prompt:e,credentials:a,headers:r,body:s,streamProtocol:n="data",setCompletion:i,setLoading:o,setError:d,setAbortController:l,onFinish:u,onError:p,fetch:_=dd()}){try{o(!0),d(void 0);let v=new AbortController;l(v),i("");let x=await _(t,{method:"POST",body:JSON.stringify({prompt:e,...s}),credentials:a,headers:{"Content-Type":"application/json",...r},signal:v.signal}).catch(c=>{throw c});if(!x.ok)throw Error(await x.text()??"Failed to fetch the chat response.");if(!x.body)throw Error("The response body is empty.");let f="";switch(n){case"text":await ld({stream:x.body,onTextPart:c=>{f+=c,i(f)}});break;case"data":await Ss({stream:ls({stream:x.body,schema:ks}).pipeThrough(new TransformStream({async transform(c){if(!c.success)throw c.error;let m=c.value;if(m.type==="text-delta")f+=m.delta,i(f);else if(m.type==="error")throw Error(m.errorText)}})),onError:c=>{throw c}});break;default:throw Error(`Unknown stream protocol: ${n}`)}return u&&u(e,f),l(null),f}catch(v){if(v.name==="AbortError")return l(null),null;v instanceof Error&&p&&p(v),d(v)}finally{o(!1)}}async function cd(t){if(t==null)return[];if(!globalThis.FileList||!(t instanceof globalThis.FileList))throw Error("FileList is not supported in the current environment");return Promise.all(Array.from(t).map(async e=>{let{name:a,type:r}=e,s=await new Promise((n,i)=>{let o=new FileReader;o.onload=d=>{var l;n((l=d.target)==null?void 0:l.result)},o.onerror=d=>i(d),o.readAsDataURL(e)});return{type:"file",mediaType:r,filename:a,url:s}}))}var pd=class{constructor({api:t="/api/chat",credentials:e,headers:a,body:r,fetch:s,prepareSendMessagesRequest:n,prepareReconnectToStreamRequest:i}){this.api=t,this.credentials=e,this.headers=a,this.body=r,this.fetch=s,this.prepareSendMessagesRequest=n,this.prepareReconnectToStreamRequest=i}async sendMessages({abortSignal:t,...e}){var p;let a=await xt(this.body),r=await xt(this.headers),s=await xt(this.credentials),n=await((p=this.prepareSendMessagesRequest)==null?void 0:p.call(this,{api:this.api,id:e.chatId,messages:e.messages,body:{...a,...e.body},headers:{...r,...e.headers},credentials:s,requestMetadata:e.metadata,trigger:e.trigger,messageId:e.messageId})),i=(n==null?void 0:n.api)??this.api,o=(n==null?void 0:n.headers)===void 0?{...r,...e.headers}:n.headers,d=(n==null?void 0:n.body)===void 0?{...a,...e.body,id:e.chatId,messages:e.messages,trigger:e.trigger,messageId:e.messageId}:n.body,l=(n==null?void 0:n.credentials)??s,u=await(this.fetch??globalThis.fetch)(i,{method:"POST",headers:{"Content-Type":"application/json",...o},body:JSON.stringify(d),credentials:l,signal:t});if(!u.ok)throw Error(await u.text()??"Failed to fetch the chat response.");if(!u.body)throw Error("The response body is empty.");return this.processResponseStream(u.body)}async reconnectToStream(t){var l;let e=await xt(this.body),a=await xt(this.headers),r=await xt(this.credentials),s=await((l=this.prepareReconnectToStreamRequest)==null?void 0:l.call(this,{api:this.api,id:t.chatId,body:{...e,...t.body},headers:{...a,...t.headers},credentials:r,requestMetadata:t.metadata})),n=(s==null?void 0:s.api)??`${this.api}/${t.chatId}/stream`,i=(s==null?void 0:s.headers)===void 0?{...a,...t.headers}:s.headers,o=(s==null?void 0:s.credentials)??r,d=await(this.fetch??globalThis.fetch)(n,{method:"GET",headers:i,credentials:o});if(d.status===204)return null;if(!d.ok)throw Error(await d.text()??"Failed to fetch the chat response.");if(!d.body)throw Error("The response body is empty.");return this.processResponseStream(d.body)}},Ja=class extends pd{constructor(t={}){super(t)}processResponseStream(t){return ls({stream:t,schema:ks}).pipeThrough(new TransformStream({async transform(e,a){if(!e.success)throw e.error;a.enqueue(e.value)}}))}},md=class{constructor({generateId:t=Eo,id:e=t(),transport:a=new Ja,messageMetadataSchema:r,dataPartSchemas:s,state:n,onError:i,onToolCall:o,onFinish:d,onData:l,sendAutomaticallyWhen:u}){this.activeResponse=void 0,this.jobExecutor=new Wl,this.sendMessage=async(p,_)=>{var x;if(p==null){await this.makeRequest({trigger:"submit-message",messageId:(x=this.lastMessage)==null?void 0:x.id,..._});return}let v;if(v="text"in p||"files"in p?{parts:[...Array.isArray(p.files)?p.files:await cd(p.files),..."text"in p&&p.text!=null?[{type:"text",text:p.text}]:[]]}:p,p.messageId!=null){let f=this.state.messages.findIndex(c=>c.id===p.messageId);if(f===-1)throw Error(`message with id ${p.messageId} not found`);if(this.state.messages[f].role!=="user")throw Error(`message with id ${p.messageId} is not a user message`);this.state.messages=this.state.messages.slice(0,f+1),this.state.replaceMessage(f,{...v,id:p.messageId,role:v.role??"user",metadata:p.metadata})}else this.state.pushMessage({...v,id:v.id??this.generateId(),role:v.role??"user",metadata:p.metadata});await this.makeRequest({trigger:"submit-message",messageId:p.messageId,..._})},this.regenerate=async({messageId:p,..._}={})=>{let v=p==null?this.state.messages.length-1:this.state.messages.findIndex(x=>x.id===p);if(v===-1)throw Error(`message ${p} not found`);this.state.messages=this.state.messages.slice(0,this.messages[v].role==="assistant"?v:v+1),await this.makeRequest({trigger:"regenerate-message",messageId:p,..._})},this.resumeStream=async(p={})=>{await this.makeRequest({trigger:"resume-stream",...p})},this.clearError=()=>{this.status==="error"&&(this.state.error=void 0,this.setStatus({status:"ready"}))},this.addToolResult=async({tool:p,toolCallId:_,output:v})=>this.jobExecutor.run(async()=>{var c,m;let x=this.state.messages,f=x[x.length-1];this.state.replaceMessage(x.length-1,{...f,parts:f.parts.map(b=>Is(b)&&b.toolCallId===_?{...b,state:"output-available",output:v}:b)}),this.activeResponse&&(this.activeResponse.state.message.parts=this.activeResponse.state.message.parts.map(b=>Is(b)&&b.toolCallId===_?{...b,state:"output-available",output:v,errorText:void 0}:b)),this.status!=="streaming"&&this.status!=="submitted"&&((c=this.sendAutomaticallyWhen)!=null&&c.call(this,{messages:this.state.messages}))&&this.makeRequest({trigger:"submit-message",messageId:(m=this.lastMessage)==null?void 0:m.id})}),this.stop=async()=>{var p;this.status!=="streaming"&&this.status!=="submitted"||(p=this.activeResponse)!=null&&p.abortController&&this.activeResponse.abortController.abort()},this.id=e,this.transport=a,this.generateId=t,this.messageMetadataSchema=r,this.dataPartSchemas=s,this.state=n,this.onError=i,this.onToolCall=o,this.onFinish=d,this.onData=l,this.sendAutomaticallyWhen=u}get status(){return this.state.status}setStatus({status:t,error:e}){this.status!==t&&(this.state.status=t,this.state.error=e)}get error(){return this.state.error}get messages(){return this.state.messages}get lastMessage(){return this.state.messages[this.state.messages.length-1]}set messages(t){this.state.messages=t}async makeRequest({trigger:t,metadata:e,headers:a,body:r,messageId:s}){var u,p;var n;this.setStatus({status:"submitted",error:void 0});let i=this.lastMessage,o=!1,d=!1,l=!1;try{let _={state:Vl({lastMessage:this.state.snapshot(i),messageId:this.generateId()}),abortController:new AbortController};_.abortController.signal.addEventListener("abort",()=>{o=!0}),this.activeResponse=_;let v;if(t==="resume-stream"){let x=await this.transport.reconnectToStream({chatId:this.id,metadata:e,headers:a,body:r});if(x==null){this.setStatus({status:"ready"});return}v=x}else v=await this.transport.sendMessages({chatId:this.id,messages:this.state.messages,abortSignal:_.abortController.signal,metadata:e,headers:a,body:r,trigger:t,messageId:s});await Ss({stream:Bl({stream:v,onToolCall:this.onToolCall,onData:this.onData,messageMetadataSchema:this.messageMetadataSchema,dataPartSchemas:this.dataPartSchemas,runUpdateMessageJob:x=>this.jobExecutor.run(()=>x({state:_.state,write:()=>{var f;this.setStatus({status:"streaming"}),_.state.message.id===((f=this.lastMessage)==null?void 0:f.id)?this.state.replaceMessage(this.state.messages.length-1,_.state.message):this.state.pushMessage(_.state.message)}})),onError:x=>{throw x}}),onError:x=>{throw x}}),this.setStatus({status:"ready"})}catch(_){if(o||_.name==="AbortError")return o=!0,this.setStatus({status:"ready"}),null;l=!0,_ instanceof TypeError&&(_.message.toLowerCase().includes("fetch")||_.message.toLowerCase().includes("network"))&&(d=!0),this.onError&&_ instanceof Error&&this.onError(_),this.setStatus({status:"error",error:_})}finally{try{(n=this.onFinish)==null||n.call(this,{message:this.activeResponse.state.message,messages:this.state.messages,isAbort:o,isDisconnect:d,isError:l})}catch(_){console.error(_)}this.activeResponse=void 0}(u=this.sendAutomaticallyWhen)!=null&&u.call(this,{messages:this.state.messages})&&await this.makeRequest({trigger:"submit-message",messageId:(p=this.lastMessage)==null?void 0:p.id,metadata:e,headers:a,body:r})}},hd=S({type:C("text"),text:h(),state:wa(["streaming","done"]).optional(),providerMetadata:D.optional()}),fd=S({type:C("reasoning"),text:h(),state:wa(["streaming","done"]).optional(),providerMetadata:D.optional()}),gd=S({type:C("source-url"),sourceId:h(),url:h(),title:h().optional(),providerMetadata:D.optional()}),yd=S({type:C("source-document"),sourceId:h(),mediaType:h(),title:h(),filename:h().optional(),providerMetadata:D.optional()}),vd=S({type:C("file"),mediaType:h(),filename:h().optional(),url:h(),providerMetadata:D.optional()}),_d=S({type:C("step-start")}),bd=S({type:h().startsWith("data-"),id:h().optional(),data:te()}),xd=[S({type:C("dynamic-tool"),toolName:h(),toolCallId:h(),state:C("input-streaming"),input:te().optional(),output:Ee().optional(),errorText:Ee().optional()}),S({type:C("dynamic-tool"),toolName:h(),toolCallId:h(),state:C("input-available"),input:te(),output:Ee().optional(),errorText:Ee().optional(),callProviderMetadata:D.optional()}),S({type:C("dynamic-tool"),toolName:h(),toolCallId:h(),state:C("output-available"),input:te(),output:te(),errorText:Ee().optional(),callProviderMetadata:D.optional(),preliminary:re().optional()}),S({type:C("dynamic-tool"),toolName:h(),toolCallId:h(),state:C("output-error"),input:te(),output:Ee().optional(),errorText:h(),callProviderMetadata:D.optional()})],wd=[S({type:h().startsWith("tool-"),toolCallId:h(),state:C("input-streaming"),input:te().optional(),output:Ee().optional(),errorText:Ee().optional()}),S({type:h().startsWith("tool-"),toolCallId:h(),state:C("input-available"),input:te(),output:Ee().optional(),errorText:Ee().optional(),callProviderMetadata:D.optional()}),S({type:h().startsWith("tool-"),toolCallId:h(),state:C("output-available"),input:te(),output:te(),errorText:Ee().optional(),callProviderMetadata:D.optional(),preliminary:re().optional()}),S({type:h().startsWith("tool-"),toolCallId:h(),state:C("output-error"),input:te(),output:Ee().optional(),errorText:h(),callProviderMetadata:D.optional()})];S({id:h(),role:wa(["system","user","assistant"]),metadata:te().optional(),parts:Be(ue([hd,fd,gd,yd,vd,_d,bd,...xd,...wd]))});var kd=Tn(((t,e)=>{function a(r,s){if(typeof r!="function")throw TypeError(`Expected the first argument to be a \`function\`, got \`${typeof r}\`.`);let n,i=0;return function(...o){clearTimeout(n);let d=Date.now(),l=d-i,u=s-l;u<=0?(i=d,r.apply(this,o)):n=setTimeout(()=>{i=Date.now(),r.apply(this,o)},u)}}e.exports=a})),Os=Object.prototype.hasOwnProperty;function Ya(t,e){var a,r;if(t===e)return!0;if(t&&e&&(a=t.constructor)===e.constructor){if(a===Date)return t.getTime()===e.getTime();if(a===RegExp)return t.toString()===e.toString();if(a===Array){if((r=t.length)===e.length)for(;r--&&Ya(t[r],e[r]););return r===-1}if(!a||typeof t=="object"){for(a in r=0,t)if(Os.call(t,a)&&++r&&!Os.call(e,a)||!(a in e)||!Ya(t[a],e[a]))return!1;return Object.keys(e).length===r}}return t!==t&&e!==e}var N=tt(Sn(),1),Ke=new WeakMap,mt=()=>{},me=void 0,da=Object,F=t=>t===me,Pe=t=>typeof t=="function",Je=(t,e)=>({...t,...e}),Rs=t=>Pe(t.then),Ga={},ua={},Ha="undefined",Nt=typeof window!=Ha,Qa=typeof document!=Ha,Cd=Nt&&"Deno"in window,Td=()=>Nt&&typeof window.requestAnimationFrame!=Ha,Ns=(t,e)=>{let a=Ke.get(t);return[()=>!F(e)&&t.get(e)||Ga,r=>{if(!F(e)){let s=t.get(e);e in ua||(ua[e]=s),a[5](e,Je(s,r),s||Ga)}},a[6],()=>!F(e)&&e in ua?ua[e]:!F(e)&&t.get(e)||Ga]},Xa=!0,Id=()=>Xa,[er,tr]=Nt&&window.addEventListener?[window.addEventListener.bind(window),window.removeEventListener.bind(window)]:[mt,mt],Ed=()=>{let t=Qa&&document.visibilityState;return F(t)||t!=="hidden"},Sd=t=>(Qa&&document.addEventListener("visibilitychange",t),er("focus",t),()=>{Qa&&document.removeEventListener("visibilitychange",t),tr("focus",t)}),Ad=t=>{let e=()=>{Xa=!0,t()},a=()=>{Xa=!1};return er("online",e),er("offline",a),()=>{tr("online",e),tr("offline",a)}},Od={isOnline:Id,isVisible:Ed},Rd={initFocus:Sd,initReconnect:Ad},Ms=!N.useId,Mt=!Nt||Cd,Nd=t=>Td()?window.requestAnimationFrame(t):setTimeout(t,1),ca=Mt?N.useEffect:N.useLayoutEffect,ar=typeof navigator<"u"&&navigator.connection,Ps=!Mt&&ar&&(["slow-2g","2g"].includes(ar.effectiveType)||ar.saveData),pa=new WeakMap,Md=t=>da.prototype.toString.call(t),rr=(t,e)=>t===`[object ${e}]`,Pd=0,sr=t=>{let e=typeof t,a=Md(t),r=rr(a,"Date"),s=rr(a,"RegExp"),n=rr(a,"Object"),i,o;if(da(t)===t&&!r&&!s){if(i=pa.get(t),i)return i;if(i=++Pd+"~",pa.set(t,i),Array.isArray(t)){for(i="@",o=0;o<t.length;o++)i+=sr(t[o])+",";pa.set(t,i)}if(n){i="#";let d=da.keys(t).sort();for(;!F(o=d.pop());)F(t[o])||(i+=o+":"+sr(t[o])+",");pa.set(t,i)}}else i=r?t.toJSON():e=="symbol"?t.toString():e=="string"?JSON.stringify(t):""+t;return i},nr=t=>{if(Pe(t))try{t=t()}catch{t=""}let e=t;return t=typeof t=="string"?t:(Array.isArray(t)?t.length:t)?sr(t):"",[t,e]},jd=0,ir=()=>++jd;async function js(...t){let[e,a,r,s]=t,n=Je({populateCache:!0,throwOnError:!0},typeof s=="boolean"?{revalidate:s}:s||{}),i=n.populateCache,o=n.rollbackOnError,d=n.optimisticData,l=_=>typeof o=="function"?o(_):o!==!1,u=n.throwOnError;if(Pe(a)){let _=a,v=[],x=e.keys();for(let f of x)!/^\$(inf|sub)\$/.test(f)&&_(e.get(f)._k)&&v.push(f);return Promise.all(v.map(p))}return p(a);async function p(_){let[v]=nr(_);if(!v)return;let[x,f]=Ns(e,v),[c,m,b,T]=Ke.get(e),A=()=>{let Y=c[v];return(Pe(n.revalidate)?n.revalidate(x().data,_):n.revalidate!==!1)&&(delete b[v],delete T[v],Y&&Y[0])?Y[0](2).then(()=>x().data):x().data};if(t.length<3)return A();let E=r,j,U=!1,P=ir();m[v]=[P,0];let X=!F(d),$=x(),oe=$.data,le=$._c,ae=F(le)?oe:le;if(X&&(d=Pe(d)?d(ae,oe):d,f({data:d,_c:ae})),Pe(E))try{E=E(ae)}catch(Y){j=Y,U=!0}if(E&&Rs(E))if(E=await E.catch(Y=>{j=Y,U=!0}),P!==m[v][0]){if(U)throw j;return E}else U&&X&&l(j)&&(i=!0,f({data:ae,_c:me}));if(i&&!U)if(Pe(i)){let Y=i(E,ae);f({data:Y,error:me,_c:me})}else f({data:E,error:me,_c:me});if(m[v][1]=ir(),Promise.resolve(A()).then(()=>{f({_c:me})}),U){if(u)throw j;return}return E}}var Zs=(t,e)=>{for(let a in t)t[a][0]&&t[a][0](e)},$s=(t,e)=>{if(!Ke.has(t)){let a=Je(Rd,e),r=Object.create(null),s=js.bind(me,t),n=mt,i=Object.create(null),o=(u,p)=>{let _=i[u]||[];return i[u]=_,_.push(p),()=>_.splice(_.indexOf(p),1)},d=(u,p,_)=>{t.set(u,p);let v=i[u];if(v)for(let x of v)x(p,_)},l=()=>{if(!Ke.has(t)&&(Ke.set(t,[r,Object.create(null),Object.create(null),Object.create(null),s,d,o]),!Mt)){let u=a.initFocus(setTimeout.bind(me,Zs.bind(me,r,0))),p=a.initReconnect(setTimeout.bind(me,Zs.bind(me,r,1)));n=()=>{u&&u(),p&&p(),Ke.delete(t)}}};return l(),[t,s,l,n]}return[t,Ke.get(t)[4]]},Zd=(t,e,a,r,s)=>{let n=a.errorRetryCount,i=s.retryCount,o=~~((Math.random()+.5)*(1<<(i<8?i:8)))*a.errorRetryInterval;!F(n)&&i>n||setTimeout(r,o,s)},$d=Ya,[or,Ld]=$s(new Map),Ls=Je({onLoadingSlow:mt,onSuccess:mt,onError:mt,onErrorRetry:Zd,onDiscarded:mt,revalidateOnFocus:!0,revalidateOnReconnect:!0,revalidateIfStale:!0,shouldRetryOnError:!0,errorRetryInterval:Ps?1e4:5e3,focusThrottleInterval:5*1e3,dedupingInterval:2*1e3,loadingTimeout:Ps?5e3:3e3,compare:$d,isPaused:()=>!1,cache:or,mutate:Ld,fallback:{}},Od),Ds=(t,e)=>{let a=Je(t,e);if(e){let{use:r,fallback:s}=t,{use:n,fallback:i}=e;r&&n&&(a.use=r.concat(n)),s&&i&&(a.fallback=Je(s,i))}return a},lr=(0,N.createContext)({}),Dd=t=>{let{value:e}=t,a=(0,N.useContext)(lr),r=Pe(e),s=(0,N.useMemo)(()=>r?e(a):e,[r,a,e]),n=(0,N.useMemo)(()=>r?s:Ds(a,s),[r,a,s]),i=s&&s.provider,o=(0,N.useRef)(me);i&&!o.current&&(o.current=$s(i(n.cache||or),s));let d=o.current;return d&&(n.cache=d[0],n.mutate=d[1]),ca(()=>{if(d)return d[2]&&d[2](),d[3]},[]),(0,N.createElement)(lr.Provider,Je(t,{value:n}))},Fs=Nt&&window.__SWR_DEVTOOLS_USE__,Fd=Fs?window.__SWR_DEVTOOLS_USE__:[],zd=()=>{Fs&&(window.__SWR_DEVTOOLS_REACT__=N.default)},Ud=t=>Pe(t[1])?[t[0],t[1],t[2]||{}]:[t[0],null,(t[1]===null?t[2]:t[1])||{}],Vd=()=>Je(Ls,(0,N.useContext)(lr)),Bd=Fd.concat(t=>(e,a,r)=>t(e,a&&((...s)=>{let[n]=nr(e),[,,,i]=Ke.get(or);if(n.startsWith("$inf$"))return a(...s);let o=i[n];return F(o)?a(...s):(delete i[n],o)}),r)),Wd=t=>function(...e){let a=Vd(),[r,s,n]=Ud(e),i=Ds(a,n),o=t,{use:d}=i,l=(d||[]).concat(Bd);for(let u=l.length;u--;)o=l[u](o);return o(r,s||i.fetcher||null,i)},qd=(t,e,a)=>{let r=e[t]||(e[t]=[]);return r.push(a),()=>{let s=r.indexOf(a);s>=0&&(r[s]=r[r.length-1],r.pop())}};zd();var Kd=tt(Ri(),1),dr=N.use||(t=>{switch(t.status){case"pending":throw t;case"fulfilled":return t.value;case"rejected":throw t.reason;default:throw t.status="pending",t.then(e=>{t.status="fulfilled",t.value=e},e=>{t.status="rejected",t.reason=e}),t}}),ur={dedupe:!0},Jd=(t,e,a)=>{let{cache:r,compare:s,suspense:n,fallbackData:i,revalidateOnMount:o,revalidateIfStale:d,refreshInterval:l,refreshWhenHidden:u,refreshWhenOffline:p,keepPreviousData:_}=a,[v,x,f,c]=Ke.get(r),[m,b]=nr(t),T=(0,N.useRef)(!1),A=(0,N.useRef)(!1),E=(0,N.useRef)(m),j=(0,N.useRef)(e),U=(0,N.useRef)(a),P=()=>U.current,X=()=>P().isVisible()&&P().isOnline(),[$,oe,le,ae]=Ns(r,m),Y=(0,N.useRef)({}).current,he=F(i)?F(a.fallback)?me:a.fallback[m]:i,J=(V,L)=>{for(let ee in Y){let B=ee;if(B==="data"){if(!s(V[B],L[B])&&(!F(V[B])||!s(Oe,L[B])))return!1}else if(L[B]!==V[B])return!1}return!0},q=(0,N.useMemo)(()=>{let V=!m||!e?!1:F(o)?P().isPaused()||n?!1:d!==!1:o,L=ne=>{let be=Je(ne);return delete be._k,V?{isValidating:!0,isLoading:!0,...be}:be},ee=$(),B=ae(),Te=L(ee),ge=ee===B?Te:L(B),se=Te;return[()=>{let ne=L($());return J(ne,se)?(se.data=ne.data,se.isLoading=ne.isLoading,se.isValidating=ne.isValidating,se.error=ne.error,se):(se=ne,ne)},()=>ge]},[r,m]),G=(0,Kd.useSyncExternalStore)((0,N.useCallback)(V=>le(m,(L,ee)=>{J(ee,L)||V()}),[r,m]),q[0],q[1]),Ae=!T.current,ve=v[m]&&v[m].length>0,_e=G.data,Ce=F(_e)?he&&Rs(he)?dr(he):he:_e,He=G.error,Qe=(0,N.useRef)(Ce),Oe=_?F(_e)?F(Qe.current)?Ce:Qe.current:_e:Ce,dt=ve&&!F(He)?!1:Ae&&!F(o)?o:P().isPaused()?!1:n?F(Ce)?!1:d:F(Ce)||d,Fe=!!(m&&e&&Ae&&dt),ft=F(G.isValidating)?Fe:G.isValidating,Xe=F(G.isLoading)?Fe:G.isLoading,Ze=(0,N.useCallback)(async V=>{let L=j.current;if(!m||!L||A.current||P().isPaused())return!1;let ee,B,Te=!0,ge=V||{},se=!f[m]||!ge.dedupe,ne=()=>Ms?!A.current&&m===E.current&&T.current:m===E.current,be={isValidating:!1,isLoading:!1},Ue=()=>{oe(be)},Ve=()=>{let ie=f[m];ie&&ie[1]===B&&delete f[m]},ut={isValidating:!0};F($().data)&&(ut.isLoading=!0);try{if(se&&(oe(ut),a.loadingTimeout&&F($().data)&&setTimeout(()=>{Te&&ne()&&P().onLoadingSlow(m,a)},a.loadingTimeout),f[m]=[L(b),ir()]),[ee,B]=f[m],ee=await ee,se&&setTimeout(Ve,a.dedupingInterval),!f[m]||f[m][1]!==B)return se&&ne()&&P().onDiscarded(m),!1;be.error=me;let ie=x[m];if(!F(ie)&&(B<=ie[0]||B<=ie[1]||ie[1]===0))return Ue(),se&&ne()&&P().onDiscarded(m),!1;let pe=$().data;be.data=s(pe,ee)?pe:ee,se&&ne()&&P().onSuccess(ee,m,a)}catch(ie){Ve();let pe=P(),{shouldRetryOnError:et}=pe;pe.isPaused()||(be.error=ie,se&&ne()&&(pe.onError(ie,m,pe),(et===!0||Pe(et)&&et(ie))&&(!P().revalidateOnFocus||!P().revalidateOnReconnect||X())&&pe.onErrorRetry(ie,m,pe,xe=>{let Ie=v[m];Ie&&Ie[0]&&Ie[0](3,xe)},{retryCount:(ge.retryCount||0)+1,dedupe:!0})))}return Te=!1,Ue(),!0},[m,r]),ze=(0,N.useCallback)((...V)=>js(r,E.current,...V),[]);if(ca(()=>{j.current=e,U.current=a,F(_e)||(Qe.current=_e)}),ca(()=>{if(!m)return;let V=Ze.bind(me,ur),L=0;P().revalidateOnFocus&&(L=Date.now()+P().focusThrottleInterval);let ee=qd(m,v,(B,Te={})=>{if(B==0){let ge=Date.now();P().revalidateOnFocus&&ge>L&&X()&&(L=ge+P().focusThrottleInterval,V())}else if(B==1)P().revalidateOnReconnect&&X()&&V();else{if(B==2)return Ze();if(B==3)return Ze(Te)}});return A.current=!1,E.current=m,T.current=!0,oe({_k:b}),dt&&(f[m]||(F(Ce)||Mt?V():Nd(V))),()=>{A.current=!0,ee()}},[m]),ca(()=>{let V;function L(){let B=Pe(l)?l($().data):l;B&&V!==-1&&(V=setTimeout(ee,B))}function ee(){!$().error&&(u||P().isVisible())&&(p||P().isOnline())?Ze(ur).then(L):L()}return L(),()=>{V&&(V=(clearTimeout(V),-1))}},[l,u,p,m]),(0,N.useDebugValue)(Oe),n&&F(Ce)&&m){if(!Ms&&Mt)throw Error("Fallback data is required when using Suspense in SSR.");j.current=e,U.current=a,A.current=!1;let V=c[m];if(!F(V)){let L=ze(V);dr(L)}if(F(He)){let L=Ze(ur);F(Oe)||(L.status="fulfilled",L.value=!0),dr(L)}else throw He}return{mutate:ze,get data(){return Y.data=!0,Oe},get error(){return Y.error=!0,He},get isValidating(){return Y.isValidating=!0,ft},get isLoading(){return Y.isLoading=!0,Xe}}};da.defineProperty(Dd,"defaultValue",{value:Ls});var zs=Wd(Jd),Yd=tt(kd(),1),Us=(t,e,a)=>{if(!e.has(t))throw TypeError("Cannot "+a)},Q=(t,e,a)=>(Us(t,e,"read from private field"),a?a.call(t):e.get(t)),De=(t,e,a)=>{if(e.has(t))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(t):e.set(t,a)},ot=(t,e,a,r)=>(Us(t,e,"write to private field"),r?r.call(t,a):e.set(t,a),a);function Vs(t,e){return e==null?t:(0,Yd.default)(t,e)}var Se,ma,ha,Pt,jt,Zt,wt,cr,pr,Gd=class{constructor(t=[]){De(this,Se,void 0),De(this,ma,"ready"),De(this,ha,void 0),De(this,Pt,new Set),De(this,jt,new Set),De(this,Zt,new Set),this.pushMessage=e=>{ot(this,Se,Q(this,Se).concat(e)),Q(this,wt).call(this)},this.popMessage=()=>{ot(this,Se,Q(this,Se).slice(0,-1)),Q(this,wt).call(this)},this.replaceMessage=(e,a)=>{ot(this,Se,[...Q(this,Se).slice(0,e),this.snapshot(a),...Q(this,Se).slice(e+1)]),Q(this,wt).call(this)},this.snapshot=e=>structuredClone(e),this["~registerMessagesCallback"]=(e,a)=>{let r=a?Vs(e,a):e;return Q(this,Pt).add(r),()=>{Q(this,Pt).delete(r)}},this["~registerStatusCallback"]=e=>(Q(this,jt).add(e),()=>{Q(this,jt).delete(e)}),this["~registerErrorCallback"]=e=>(Q(this,Zt).add(e),()=>{Q(this,Zt).delete(e)}),De(this,wt,()=>{Q(this,Pt).forEach(e=>e())}),De(this,cr,()=>{Q(this,jt).forEach(e=>e())}),De(this,pr,()=>{Q(this,Zt).forEach(e=>e())}),ot(this,Se,t)}get status(){return Q(this,ma)}set status(t){ot(this,ma,t),Q(this,cr).call(this)}get error(){return Q(this,ha)}set error(t){ot(this,ha,t),Q(this,pr).call(this)}get messages(){return Q(this,Se)}set messages(t){ot(this,Se,[...t]),Q(this,wt).call(this)}};Se=new WeakMap,ma=new WeakMap,ha=new WeakMap,Pt=new WeakMap,jt=new WeakMap,Zt=new WeakMap,wt=new WeakMap,cr=new WeakMap,pr=new WeakMap;var kt,Bs=class extends md{constructor({messages:t,...e}){let a=new Gd(t);super({...e,state:a}),De(this,kt,void 0),this["~registerMessagesCallback"]=(r,s)=>Q(this,kt)["~registerMessagesCallback"](r,s),this["~registerStatusCallback"]=r=>Q(this,kt)["~registerStatusCallback"](r),this["~registerErrorCallback"]=r=>Q(this,kt)["~registerErrorCallback"](r),ot(this,kt,a)}};kt=new WeakMap;function Ws({experimental_throttle:t,resume:e=!1,...a}={}){let r=(0,N.useRef)("chat"in a?a.chat:new Bs(a));("chat"in a&&a.chat!==r.current||"id"in a&&r.current.id!==a.id)&&(r.current="chat"in a?a.chat:new Bs(a));let s="id"in a?a.id:null,n=(0,N.useCallback)(u=>r.current["~registerMessagesCallback"](u,t),[t,s]),i=(0,N.useSyncExternalStore)(n,()=>r.current.messages,()=>r.current.messages),o=(0,N.useSyncExternalStore)(r.current["~registerStatusCallback"],()=>r.current.status,()=>r.current.status),d=(0,N.useSyncExternalStore)(r.current["~registerErrorCallback"],()=>r.current.error,()=>r.current.error),l=(0,N.useCallback)(u=>{typeof u=="function"&&(u=u(r.current.messages)),r.current.messages=u},[r]);return(0,N.useEffect)(()=>{e&&r.current.resumeStream()},[e,r]),{id:r.current.id,messages:i,setMessages:l,sendMessage:r.current.sendMessage,regenerate:r.current.regenerate,clearError:r.current.clearError,stop:r.current.stop,error:d,resumeStream:r.current.resumeStream,status:o,addToolResult:r.current.addToolResult}}function Hd({api:t="/api/completion",id:e,initialCompletion:a="",initialInput:r="",credentials:s,headers:n,body:i,streamProtocol:o="data",fetch:d,onFinish:l,onError:u,experimental_throttle:p}={}){let _=(0,N.useId)(),v=e||_,{data:x,mutate:f}=zs([t,v],null,{fallbackData:a}),{data:c=!1,mutate:m}=zs([v,"loading"],null),[b,T]=(0,N.useState)(void 0),A=x,[E,j]=(0,N.useState)(null),U=(0,N.useRef)({credentials:s,headers:n,body:i});(0,N.useEffect)(()=>{U.current={credentials:s,headers:n,body:i}},[s,n,i]);let P=(0,N.useCallback)(async(J,q)=>ud({api:t,prompt:J,credentials:U.current.credentials,headers:{...U.current.headers,...q==null?void 0:q.headers},body:{...U.current.body,...q==null?void 0:q.body},streamProtocol:o,fetch:d,setCompletion:Vs(G=>f(G,!1),p),setLoading:m,setError:T,setAbortController:j,onFinish:l,onError:u}),[f,m,t,U,j,l,u,T,o,d,p]),X=(0,N.useCallback)(()=>{E&&(E.abort(),j(null))},[E]),$=(0,N.useCallback)(J=>{f(J,!1)},[f]),oe=(0,N.useCallback)(async(J,q)=>P(J,q),[P]),[le,ae]=(0,N.useState)(r),Y=(0,N.useCallback)(J=>{var q;return(q=J==null?void 0:J.preventDefault)==null||q.call(J),le?oe(le):void 0},[le,oe]),he=(0,N.useCallback)(J=>{ae(J.target.value)},[ae]);return{completion:A,complete:oe,error:b,setCompletion:$,stop:X,input:le,setInput:ae,handleInputChange:he,handleSubmit:Y,isLoading:c}}var qs,$t;function Qd(t,e,a,r,s){var n={};return Object.keys(r).forEach(function(i){n[i]=r[i]}),n.enumerable=!!n.enumerable,n.configurable=!!n.configurable,("value"in n||n.initializer)&&(n.writable=!0),n=a.slice().reverse().reduce(function(i,o){return o(t,e,i)||i},n),s&&n.initializer!==void 0&&(n.value=n.initializer?n.initializer.call(s):void 0,n.initializer=void 0),n.initializer===void 0?(Object.defineProperty(t,e,n),null):n}const mr=new(qs=Ir(),$t=class{constructor(t=[]){W(this,"tools",new Map);this.tools=new Map(t.map(e=>[e.name,e]))}has(t){return this.tools.has(t)}getToolOrThrow(t){let e=this.tools.get(t);if(!e)throw Error(`Tool ${t} not found`);return e}async invoke(t,e){let a=this.getToolOrThrow(t),r=a.handler,s=a.schema,n=a.outputSchema;try{let i=await s.safeParseAsync(e);if(i.error){let u=Ar(i.error);throw Error(`Tool ${t} returned invalid input: ${u}`)}let o=i.data,d=await r(o),l=await n.safeParseAsync(d);if(l.error){let u=Ar(l.error);throw Error(`Tool ${t} returned invalid output: ${u}`)}return l.data}catch(i){return{status:"error",code:"TOOL_ERROR",message:i instanceof Error?i.message:String(i),suggestedFix:"Try again with valid arguments.",meta:{args:e}}}}getToolSchemas(){return[...this.tools.values()].map(t=>({name:t.name,description:t.description,parameters:Er(t.schema),source:"frontend",mode:t.mode}))}},Qd($t.prototype,"getToolSchemas",[qs],Object.getOwnPropertyDescriptor($t.prototype,"getToolSchemas"),$t.prototype),$t)([]);function hr(t,e){return new Promise(a=>{let r=new FileReader;r.readAsDataURL(t),r.onload=s=>{var n;if((n=s.target)!=null&&n.result){let i=s.target.result;if(e==="base64"){let o=i.slice(i.indexOf(",")+1);a(o)}else a(i)}}})}function Xd(t){return Promise.all(t.map(e=>hr(e,"base64").then(a=>[e.name,a])))}var Ks,Lt;function eu(t,e,a,r,s){var n={};return Object.keys(r).forEach(function(i){n[i]=r[i]}),n.enumerable=!!n.enumerable,n.configurable=!!n.configurable,("value"in n||n.initializer)&&(n.writable=!0),n=a.slice().reverse().reduce(function(i,o){return o(t,e,i)||i},n),s&&n.initializer!==void 0&&(n.value=n.initializer?n.initializer.call(s):void 0,n.initializer=void 0),n.initializer===void 0?(Object.defineProperty(t,e,n),null):n}var Ct=class{async getAttachments(t){return[]}asURI(t){return`${this.contextType}://${t}`}parseContextIds(t){let e=RegExp(`${this.mentionPrefix}([\\w-]+):\\/\\/([\\w./-]+)`,"g"),a=[...t.matchAll(e)],r=n=>n.slice(1),s=a.filter(([,n])=>n===this.contextType).map(([n])=>r(n));return[...new Set(s)]}createBasicCompletion(t,e){return{label:`${this.mentionPrefix}${t.uri.split("://")[1]}`,displayLabel:t.name,detail:(e==null?void 0:e.detail)||t.description,boost:(e==null?void 0:e.boost)||1,type:(e==null?void 0:e.type)||this.contextType,apply:`${this.mentionPrefix}${t.uri}`,section:(e==null?void 0:e.section)||this.title}}};let tu=(Ks=Ir(),Lt=class{constructor(){W(this,"providers",new Set)}register(t){return this.providers.add(t),this}getProviders(){return this.providers}getProvider(t){return[...this.providers].find(e=>e.contextType===t)}getAllItems(){return[...this.providers].flatMap(t=>t.getItems())}parseAllContextIds(t){return[...this.providers].flatMap(e=>e.parseContextIds(t))}getContextInfo(t){let e=[],a=new Map(this.getAllItems().map(r=>[r.uri,r]));for(let r of t){let s=a.get(r);s&&e.push(s)}return e}formatContextForAI(t){let e=new Map(this.getAllItems().map(r=>[r.uri,r])),a=[];for(let r of t){let s=e.get(r);s&&a.push(s)}return a.length===0?"":a.map(r=>{var s;return((s=this.getProvider(r.type))==null?void 0:s.formatContext(r))||""}).join(`

`)}async getAttachmentsForContext(t){let e=new Map(this.getAllItems().map(n=>[n.uri,n])),a=[];for(let n of t){let i=e.get(n);i&&a.push(i)}if(a.length===0)return[];let r=new yi;for(let n of a){let i=n.type;r.add(i,n)}let s=[...r.entries()].map(async([n,i])=>{let o=this.getProvider(n);if(!o)return[];try{return await o.getAttachments(i)}catch(d){return ce.error("Error getting attachments from provider",d),[]}});return(await Promise.all(s)).flat()}},eu(Lt.prototype,"getAllItems",[Ks],Object.getOwnPropertyDescriptor(Lt.prototype,"getAllItems"),Lt.prototype),Lt);function Js(t){return t.replaceAll("<","&lt;").replaceAll(">","&gt;")}function Tt(t){let{type:e,data:a,details:r}=t,s=`<${e}`;for(let[n,i]of Object.entries(a))if(i!==void 0){let o=typeof i=="object"&&i?JSON.stringify(i):String(i),d=Js(o);s+=` ${n}="${d}"`}return s+=">",r&&(s+=Js(r)),s+=`</${e}>`,s}const Ye={LOCAL_TABLE:5,REMOTE_TABLE:4,HIGH:4,VARIABLE:3,MEDIUM:3,CELL_OUTPUT:2,LOW:2,ERROR:1};function au(t,e){return t?!!(["image/","video/","audio/","application/pdf"].some(a=>t.startsWith(a))||["svg","vega"].some(a=>t.includes(a))||t==="text/html"&&["<img","<video","<audio","<iframe","<canvas","<svg","<marimo-ui-element"].some(a=>e.includes(a))):!1}var ru=class extends Ct{constructor(e){super();W(this,"title","Cell Outputs");W(this,"mentionPrefix","@");W(this,"contextType","cell-output");this.store=e}getItems(){let e=this.store.get(Kn),a=[];for(let[r,s]of e.cellIds.inOrderIds.entries()){let n=e.cellRuntime[s];if(!(n!=null&&n.output)||bi(n.output))continue;let i=e.cellData[s],o=n.output,d=o.mimetype,l=au(d,String(o.data))?"media":"text",u=Bn(i.name,r),p,_,v=!1;l==="text"&&typeof o.data=="string"&&(p=d==="text/html"?ji(o.data):o.data),l==="media"&&(typeof o.data=="string"&&o.data.startsWith("data:")||typeof o.data=="string"&&o.data.startsWith("http")?_=o.data:v=!0),a.push({uri:this.asURI(s),name:u,type:this.contextType,description:`Cell output (${d||"unknown"})`,data:{cellId:s,cellName:u,cellCode:(i==null?void 0:i.code)||"",output:o,outputType:l,processedContent:p,imageUrl:_,shouldDownloadImage:v}})}return a}formatCompletion(e){let{data:a}=e;return{label:`@${a.cellName}`,displayLabel:a.cellName,detail:`${a.outputType} output`,boost:Ye.CELL_OUTPUT,type:this.contextType,section:"Cell Output",apply:`@${a.cellName}`,info:()=>{let r=document.createElement("div");r.classList.add("mo-cm-tooltip","docs-documentation","min-w-[300px]","max-w-[500px]","flex","flex-col","gap-2");let s=document.createElement("div");s.classList.add("flex","flex-col","gap-1");let n=document.createElement("div");n.classList.add("font-bold","text-base"),n.textContent=a.cellName,s.append(n);let i=document.createElement("div");if(i.classList.add("text-sm","text-muted-foreground"),s.append(i),r.append(s),a.cellCode){let o=document.createElement("div");o.classList.add("text-xs","font-medium","text-muted-foreground"),o.textContent="Code:",r.append(o);let d=document.createElement("div");d.classList.add("text-xs","font-mono","bg-muted","p-2","rounded","max-h-20","overflow-y-auto"),d.textContent=a.cellCode.slice(0,200)+(a.cellCode.length>200?"...":""),r.append(d)}if(a.processedContent){let o=document.createElement("div");o.classList.add("text-xs","font-medium","text-muted-foreground","mt-2"),o.textContent="Output Preview:",r.append(o);let d=document.createElement("div");d.classList.add("text-xs","bg-muted","p-2","rounded","max-h-24","overflow-y-auto","mb-2"),d.textContent=a.processedContent.slice(0,300)+(a.processedContent.length>300?"...":""),r.append(d)}if(a.outputType==="media"){let o=document.createElement("div");o.classList.add("text-xs","text-muted-foreground","italic","mb-2"),o.textContent="Contains media content (image, SVG, or canvas)",r.append(o)}return r}}}formatContext(e){let{data:a}=e,r={name:a.cellName,cellId:a.cellId,outputType:a.outputType,mimetype:a.output.mimetype},s=`Cell Code:
${a.cellCode}

`;return a.outputType==="text"&&a.processedContent?s+=`Output:
${a.processedContent}`:a.outputType==="media"&&(s+=`Media Output: Contains ${a.output.mimetype} content`,a.imageUrl&&(s+=`
Image URL: ${a.imageUrl}`)),Tt({type:this.contextType,data:r,details:s})}async getAttachments(e){let a=e.filter(s=>s.data.shouldDownloadImage&&s.data.outputType==="media");if(a.length===0)return[];let r=a.flatMap(s=>{let n=document.getElementById(jn.create(s.data.cellId));return n?{cellId:s.data.cellId,cellName:s.data.cellName,mimetype:s.data.output.mimetype,element:n}:(ce.warn(`Output element not found for cell ${s.data.cellId}`),[])});try{return await Promise.all(r.map(async s=>({type:"file",filename:`${s.cellName}-output-screenshot`,mediaType:"image/png",url:await Pi(s.element)})))}catch(s){return ce.error("Error downloading cell output images:",s),[]}}},su=tt(Nn()),nu=class extends Ct{constructor(e,a){super();W(this,"title","Datasource");W(this,"mentionPrefix","@");W(this,"contextType","datasource");this.connectionsMap=e,this.dataframes=[...a.values()].filter(r=>ba(r)==="dataframe")}getItems(){return[...this.connectionsMap.values()].map(e=>{let a="Database schema.",r={connection:e};return _a.has(e.name)&&(r.tables=this.dataframes,a="Database schema and the dataframes that can be queried"),{uri:this.asURI(e.name),name:e.name,description:a,type:this.contextType,data:r}})}formatContext(e){let a=e.data,{name:r,display_name:s,source:n,...i}=a.connection,o=i;return _a.has(r)||(o={...i,engine_name:r}),Tt({type:this.contextType,data:{connection:o,tables:a.tables}})}formatCompletion(e){let a=e.data,r=a.connection,s=a.tables,n=r.name;return _a.has(r.name)&&(n="In-Memory"),{label:`@${n}`,displayLabel:n,detail:$n(r.dialect),boost:Ye.MEDIUM,type:this.contextType,section:"Data Sources",info:()=>{let i=document.createElement("div");return i.classList.add("mo-cm-tooltip","docs-documentation"),(0,su.createRoot)(i).render(Ln(r,s)),i}}}};function iu(t){return t.type==="setup-refs"?"The setup cell cannot have references":t.type==="cycle"?"This cell is in a cycle":t.type==="multiple-defs"?`The variable '${t.name}' was defined by another cell`:t.type==="import-star"||t.type==="ancestor-stopped"||t.type==="ancestor-prevented"||t.type==="exception"||t.type==="strict-exception"?t.msg:t.type==="interruption"?"This cell was interrupted and needs to be re-run":t.type==="syntax"||t.type==="unknown"||t.type==="sql-error"?t.msg:t.type==="internal"?t.msg||"An internal error occurred":(Oi(t),"Unknown error")}var Ys=new qn("error","errors"),ou=class extends Ct{constructor(e){super();W(this,"title","Errors");W(this,"mentionPrefix","@");W(this,"contextType","error");this.store=e}getItems(){let e=this.store.get(Dn);return e.length===0?[]:[{uri:this.asURI("all"),name:"Errors",type:this.contextType,data:{type:"all-errors",errors:e.map(a=>({cellId:a.cellId,cellName:a.cellName,errorData:a.output.data}))},description:"All errors in the notebook"}]}formatCompletion(e){return e.data.type==="all-errors"?{label:"@Errors",displayLabel:"Errors",detail:`${e.data.errors.length} ${Ys.pluralize(e.data.errors.length)}`,boost:Ye.ERROR,type:"error",apply:"@Errors",section:"Errors",info:()=>{let a=document.createElement("div");a.classList.add("mo-cm-tooltip","docs-documentation","min-w-[200px]","flex","flex-col","gap-1","p-2");let r=document.createElement("div");r.classList.add("flex","flex-col","gap-1");let s=document.createElement("div");s.classList.add("font-bold","text-base"),s.textContent="Errors",r.append(s);let n=document.createElement("div");return n.classList.add("text-sm","text-muted-foreground"),n.textContent=`${e.data.errors.length} ${Ys.pluralize(e.data.errors.length)}`,r.append(n),a.append(r),a}}:{label:"Error",displayLabel:"Error",boost:Ye.ERROR}}formatContext(e){let{data:a}=e;return a.errors.map(r=>Tt({type:this.contextType,data:{name:r.cellName||`Cell ${r.cellId}`,description:r.errorData.map(s=>iu(s)).join(`
`)}})).join(`

`)}};const Gs=Un();var lu={maxDepth:3,maxResults:20,defaultResultsLimit:5,includeDirectories:!1},du=class extends Ct{constructor(e,a=lu){super();W(this,"title","Files");W(this,"mentionPrefix","#");W(this,"contextType","file");W(this,"searchFiles",async(e,a={})=>{let{maxDepth:r,maxResults:s,includeDirectories:n}={...this.config,...a};return(await this.apiRequests.sendSearchFiles({query:e,includeFiles:!0,includeDirectories:n,depth:r,limit:s})).files});this.apiRequests=e,this.config=a}createCompletionSource(){return async e=>{let a=e.matchBefore(/#[^\s#]*/);if(!a)return null;let r=a.text;if(!r.startsWith("#"))return null;let s=r.slice(1);if(s.length===0)return this.getDefaultCompletions(a);try{let n=(await this.searchFiles(s)||[]).map(i=>{let o={uri:this.asURI(i.path),name:i.name,type:this.contextType,description:i.isDirectory?"Directory":"File",data:{path:i.path,isDirectory:i.isDirectory}};return this.formatCompletion(o)});return{from:a.from,options:n}}catch(n){return ce.error("Failed to search files:",n),null}}}async getDefaultCompletions(e){try{for(let a of["py","md","csv"])try{let r=await this.searchFiles(a,{maxDepth:1,maxResults:5});if(r&&r.length>0){let s=r.map(n=>{let i={uri:this.asURI(n.path),name:n.name,type:this.contextType,description:n.isDirectory?"Directory":"File",data:{path:n.path,isDirectory:n.isDirectory}};return this.formatCompletion(i)});return{from:e.from,options:s}}}catch(r){ce.error("Failed to get default file completions:",r)}return{from:e.from,options:[]}}catch(a){return ce.error("Failed to get default file completions:",a),null}}getItems(){return[]}formatCompletion(e){let{data:a,name:r}=e,s=a.isDirectory?"\u{1F4C1}":"\u{1F4C4}";return{...this.createBasicCompletion(e),type:"file",section:"File",boost:a.isDirectory?Ye.MEDIUM:Ye.LOW,detail:a.path,displayLabel:`${s} ${r}`,apply:async(n,i,o,d)=>{var x;let l=(x=n.state.facet(Gs))==null?void 0:x.addAttachment;if(!l){ce.warn("No addAttachment callback provided");return}let u=await this.apiRequests.sendFileDetails({path:a.path}).catch(f=>(Pr({title:"Failed to get file details",description:f.message}),null));if(!u)return;let p=u.mimeType||"text/plain",_;if(p.startsWith("text/")||p.includes("json")||p.includes("xml"))_=new Blob([u.contents||""],{type:p});else if(u.contents)try{let f=xi(u.contents,p);_=await Zi(f)}catch{_=new Blob([u.contents],{type:p})}else _=new Blob([""],{type:p});let v=new File([_],r,{type:p});l(v),n.dispatch({changes:{from:o,to:d,insert:""}}),mi(n)},info:()=>{let n=document.createElement("div");n.classList.add("flex","flex-col","gap-1","p-2");let i=document.createElement("div");i.classList.add("font-bold"),i.textContent=r,n.append(i);let o=document.createElement("div");return o.classList.add("text-xs","text-muted-foreground"),o.textContent=a.path,n.append(o),n}}}formatContext(e){let{data:a,name:r}=e;return Tt({type:this.contextType,data:{name:r,path:a.path,isDirectory:a.isDirectory},details:a.isDirectory?"Directory containing files and subdirectories":"File"})}},uu=class extends Ct{constructor(e){super();W(this,"title","Tables");W(this,"mentionPrefix","@");W(this,"contextType","data");this.tablesMap=e}getItems(){return[...this.tablesMap.entries()].map(([e,a])=>({uri:this.asURI(e),name:e,type:this.contextType,description:a.source==="memory"?"in-memory":a.source,data:a}))}formatContext(e){let{data:a}=e,{columns:r,source:s,num_rows:n,num_columns:i,name:o}=a,d=[n==null?void 0:`${n} rows`,i==null?void 0:`${i} columns`].filter(Boolean).join(", "),l="";return d&&(l+=`
Shape: ${d}`),r&&r.length>0&&(l+=`
Columns:
${r.map(u=>`  - ${u.name}: ${u.type}`).join(`
`)}`),Tt({type:this.contextType,data:{name:o,source:s??"unknown"},details:l})}formatCompletion(e){let a=e.data.name,r=e.data;return{label:`@${a}`,displayLabel:a,detail:r.source==="memory"?"in-memory":r.source,boost:r.source_type==="local"?Ye.LOCAL_TABLE:Ye.REMOTE_TABLE,type:ba(r),apply:`@${a}`,section:ba(r)==="dataframe"?"Dataframe":"Table",info:()=>this.createTableInfoElement(a,r)}}createTableInfoElement(e,a){let r=document.createElement("div");r.classList.add("mo-cm-tooltip","docs-documentation","min-w-[200px]","flex","flex-col","gap-1","p-2");let s=document.createElement("div");s.classList.add("flex","flex-col","gap-1");let n=document.createElement("div");if(n.classList.add("font-bold","text-base"),n.textContent=e,s.append(n),a.source){let o=document.createElement("div");o.classList.add("text-xs","text-muted-foreground"),o.textContent=`Source: ${a.source}`,s.append(o)}r.append(s);let i=[a.num_rows==null?void 0:`${a.num_rows} rows`,a.num_columns==null?void 0:`${a.num_columns} columns`].filter(Boolean).join(", ");if(i){let o=document.createElement("div");o.classList.add("text-xs","bg-muted","px-2","py-1","rounded"),o.textContent=i,r.append(o)}if(a.columns&&a.columns.length>0){let o=document.createElement("div");o.classList.add("overflow-auto","max-h-60");let d=document.createElement("table");d.classList.add("w-full","text-xs","border-collapse");let l=d.insertRow();l.classList.add("bg-muted");let u=l.insertCell();u.classList.add("p-2","font-medium","text-left"),u.textContent="Column";let p=l.insertCell();p.classList.add("p-2","font-medium","text-left"),p.textContent="Type";let _=a.columns.some(x=>this.getItemMetadata(a,x)!==void 0),v;_&&(v=l.insertCell(),v.classList.add("p-2","font-medium","text-left"),v.textContent="Metadata"),a.columns.forEach((x,f)=>{let c=d.insertRow();c.classList.add(f%2==0?"bg-background":"bg-muted/30");let m=c.insertCell();m.classList.add("p-2","font-mono"),m.textContent=x.name;let b=c.insertCell();if(b.classList.add("p-2","text-muted-foreground"),b.textContent=x.type,_){let T=c.insertCell();T.classList.add("p-2");let A=this.getItemMetadata(a,x);A&&T.append(A)}}),o.append(d),r.append(o)}return r}getItemMetadata(e,a){var n,i;let r=(n=e.primary_keys)==null?void 0:n.includes(a.name),s=(i=e.indexes)==null?void 0:i.includes(a.name);if(r||s){let o=document.createElement("span");o.textContent=r?"PK":"IDX";let d=r?"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200":"bg-amber-100 text-amber-800 dark:bg-amber-900 dark:text-amber-200";return o.classList.add("text-xs","px-1.5","py-0.5","rounded-full","font-medium",...d.split(" ")),o}}},cu=class extends Ct{constructor(e,a){super();W(this,"title","Variables");W(this,"mentionPrefix","@");W(this,"contextType","variable");this.variables=e,this.tablesMap=a}getItems(){let e=new Set(this.tablesMap.keys());return Object.entries(this.variables).flatMap(([a,r])=>e.has(a)?[]:[{uri:this.asURI(a),name:a,type:this.contextType,description:r.dataType??"",dataType:r.dataType,data:{variable:r}}])}formatCompletion(e){let{data:a}=e,{variable:r}=a;return{label:`@${r.name}`,displayLabel:r.name,detail:r.dataType??"",boost:Ye.VARIABLE,type:this.contextType,section:"Variable",info:()=>Wn(r)}}formatContext(e){let{data:a}=e,{variable:r}=a;return Tt({type:this.contextType,data:{name:r.name,dataType:r.dataType},details:r.value==null?void 0:JSON.stringify(r.value)})}};function ht(t){let e=t.get(An),a=t.get(Zn),r=t.get(Rn);return new tu().register(new uu(a)).register(new cu(r,a)).register(new ou(t)).register(new ru(t)).register(new nu(e.connectionsMap,a))}function pu(){let t=ci();return new du(t)}const mu="@";function hu({input:t}){let e="";return t.includes("@")&&(e=gu(t),ce.debug("Included context",e)),{includeOtherCode:Tr(""),context:{plainText:e,schema:[],variables:[]}}}async function fu({input:t}){let e="",a=[];if(t.includes("@")){let r=ht(Or),s=r.parseAllContextIds(t);e=r.formatContextForAI(s);try{a=await r.getAttachmentsForContext(s),ce.debug("Included attachments",a.length)}catch(n){ce.error("Error getting attachments:",n)}}return{body:{includeOtherCode:Tr(""),context:{plainText:e,schema:[],variables:[]}},attachments:a}}function gu(t){let e=ht(Or),a=e.parseAllContextIds(t);return e.formatContextForAI(a)}function yu(t,e=[]){return a=>{let r=t.map(s=>a.matchBefore(s)).find(Boolean);return!r||r&&r.from===r.to&&!a.explicit?null:{from:r==null?void 0:r.from,options:[...e]}}}function vu(t){var e;if((e=t.current)!=null&&e.view){let a=t.current.view.state.selection.main.from;t.current.view.dispatch({changes:{from:a,to:a,insert:"@"},selection:{anchor:a+1,head:a+1}}),t.current.view.focus(),pi(t.current.view)}}function _u(t){if(t.trim().length===0)return[];if(!t.includes("```"))return[{language:"python",code:t}];let e=[],a=0,r=t.indexOf("```",a);for(;r!==-1;){let s=t.indexOf(`
`,r);if(s===-1){let l=t.slice(r+3),u=l.indexOf(" "),p=u===-1?l:l.slice(0,u),_=p==="markdown"?"markdown":p==="sql"?"sql":"python",v=u===-1?"":l.slice(u+1);v.trim()&&e.push({language:_,code:v.trim()});break}let n=t.slice(r+3,s).trim()||"";n=n==="markdown"?"markdown":n==="sql"?"sql":"python";let i=s+1,o=t.indexOf("```",i);if(o===-1){let l=t.slice(i).replace(/\n+$/,"");l.trim()&&e.push({language:n,code:l});break}let d=t.slice(i,o).replace(/\n+$/,"");d.trim()&&e.push({language:n,code:d}),a=o+3,r=t.indexOf("```",a)}return e.length===0&&e.push({language:"python",code:t}),e}function bu(t){return t.length>50?`${t.slice(0,50)}...`:t}async function xu(t){return await Promise.all(t.map(async e=>({type:"file",mediaType:e.type,filename:e.name,url:await hr(e,"dataUrl")})))}function wu(t){if(t.length===0)return!1;let e=t.at(-1);if(!e||e.role!=="assistant"||!e.parts)return!1;let a=e.parts;return a.length===0?!1:a[a.length-1].type==="reasoning"}function Hs(t){return t.map(e=>e.type==="text"?e.text:"").join(`
`)}async function Qs(t){let e=Hs(t.flatMap(s=>s.parts)),a=await fu({input:e});function r(s,n){let i=[...s.parts];return n&&i.push(...a.attachments),{role:s.role,content:Hs(s.parts),parts:i}}return{...a.body,messages:t.map((s,n)=>r(s,n===t.length-1))}}async function Xs({invokeAiTool:t,addToolResult:e,toolCall:a}){try{if(mr.has(a.toolName)){let r=await mr.invoke(a.toolName,a.input);e({tool:a.toolName,toolCallId:a.toolCallId,output:r})}else{let r=await t({toolName:a.toolName,arguments:a.input});e({tool:a.toolName,toolCallId:a.toolCallId,output:r.result||r.error})}}catch(r){ce.error("Tool call failed:",r),e({tool:a.toolName,toolCallId:a.toolCallId,output:`Error: ${r instanceof Error?r.message:String(r)}`})}}function ku(t){var i;if(t.length===0)return!1;let e=t[t.length-1],a=e.parts;if(a.length===0||e.role!=="assistant")return!1;let r=a.filter(o=>o.type.startsWith("tool-")).some(o=>o.state==="output-available"),s=a[a.length-1],n=s.type==="text"&&((i=s.text)==null?void 0:i.trim().length)>0;return r&&!n}function Cu(t){return ni.define({combine:e=>e[0]??t})}var en=Cu({}),fr=Vt.define(),fa=Vt.define(),Tu=50,gr=Bt.define({create(){return{prompts:[],navigationIndex:-1,originalText:""}},update(t,e){var r,s;let a={...t};e.docChanged&&t.navigationIndex!==-1&&(e.effects.some(n=>n.is(fa)||n.is(fr))||(a.navigationIndex=-1,a.originalText=""));for(let n of e.effects)if(n.is(fr)){let i=n.value.trim();if(i){let o=t.prompts.filter(d=>d!==i);a.prompts=[i,...o].slice(0,Tu),(s=(r=e.state.facet(en)).save)==null||s.call(r,a.prompts)}a.navigationIndex=-1,a.originalText=""}else n.is(fa)&&(a.navigationIndex=n.value.index,a.originalText=n.value.originalText);return a}}),Iu=t=>{let e=t.state.field(gr),a=t.state.doc;if(e.prompts.length===0)return!1;let r,s=e.originalText;if(e.navigationIndex===-1){if(a.length>0)return!1;r=0,s=a.toString()}else if(r=Math.min(e.navigationIndex+1,e.prompts.length-1),r===e.navigationIndex)return!1;let n=e.prompts[r];return t.dispatch({changes:{from:0,to:t.state.doc.length,insert:n},effects:fa.of({index:r,originalText:s})}),!0},Eu=t=>{let e=t.state.field(gr);if(e.navigationIndex===-1)return!1;let a,r;return e.navigationIndex===0?(a=e.originalText,r=-1):(r=e.navigationIndex-1,a=e.prompts[r]??""),t.dispatch({changes:{from:0,to:t.state.doc.length,insert:a},effects:fa.of({index:r,originalText:e.originalText})}),!0};const tn=t=>{let e=t.state.doc.toString();return e.trim()?(t.dispatch({effects:fr.of(e)}),!0):!1};function Su(t={}){let{storage:e,defaultKeymap:a=!0}=t,r=[gr.init(()=>{var s;return{prompts:((s=e==null?void 0:e.load)==null?void 0:s.call(e))??[],navigationIndex:-1,originalText:""}}),en.of(e??{})];return a&&r.push(Ta.of([{key:"ArrowUp",run:Iu},{key:"ArrowDown",run:Eu}])),r}var Au=tt(ka()),an=()=>new Set,{valueAtom:ga,useActions:Ou,createActions:Bc,reducer:Wc}=di(an,{addStagedCell:(t,e)=>{let{cellId:a}=e;return new Set([...t,a])},removeStagedCell:(t,e)=>new Set([...t].filter(a=>a!==e)),clearStagedCells:()=>an()});function rn(t){let e=(0,Au.c)(26),{addStagedCell:a,removeStagedCell:r,clearStagedCells:s}=Ou(),{createNewCell:n}=On(),i=Ai(),o=(0,N.useRef)(null),d;e[0]!==a||e[1]!==n?(d=T=>{let A=Mn.create();return a({cellId:A}),n({cellId:"__end__",code:T,before:!1,newCellId:A}),A},e[0]=a,e[1]=n,e[2]=d):d=e[2];let l=d,u;e[3]===t?u=e[4]:(u=T=>{var U,P;let{cellId:A,code:E}=T;if(!t.get(ga).has(A)){ce.error("Staged cell not found",{cellId:A});return}let j=(P=(U=t.get(zn(A)))==null?void 0:U.current)==null?void 0:P.editorViewOrNull;if(!j){ce.error("Editor for this cell not found",{cellId:A});return}Vn(j,E)},e[3]=t,e[4]=u);let p=u,_;e[5]!==i||e[6]!==r?(_=T=>{r(T),i({cellId:T})},e[5]=i,e[6]=r,e[7]=_):_=e[7];let v=_,x;e[8]!==s||e[9]!==i||e[10]!==t?(x=()=>{let T=t.get(ga);for(let A of T)i({cellId:A});s()},e[8]=s,e[9]=i,e[10]=t,e[11]=x):x=e[11];let f=x,c;e[12]!==a||e[13]!==n||e[14]!==l||e[15]!==p?(c=T=>{e:switch(T.type){case"text-start":o.current=new Ru(l,p,a,n);break e;case"text-delta":if(!o.current){ce.error("Cell creation stream not found");return}o.current.stream(T);break e;case"text-end":case"finish":if(!o.current){ce.error("Cell creation stream not found");return}o.current.stop();break e;default:ce.error("Unknown chunk type",{chunk:T})}},e[12]=a,e[13]=n,e[14]=l,e[15]=p,e[16]=c):c=e[16];let m=c,b;return e[17]!==a||e[18]!==s||e[19]!==l||e[20]!==f||e[21]!==v||e[22]!==m||e[23]!==r||e[24]!==p?(b={createStagedCell:l,updateStagedCell:p,addStagedCell:a,removeStagedCell:r,clearStagedCells:s,deleteStagedCell:v,deleteAllStagedCells:f,onStream:m},e[17]=a,e[18]=s,e[19]=l,e[20]=f,e[21]=v,e[22]=m,e[23]=r,e[24]=p,e[25]=b):b=e[25],b}var Ru=class{constructor(t,e,a,r){W(this,"createdCells",[]);W(this,"buffer","");W(this,"hasMarimoImport",!1);this.onCreateCell=t,this.onUpdateCell=e,this.addStagedCell=a,this.createNewCell=r}stream(t){let e=t.delta;this.buffer+=e;let a=_u(this.buffer);for(let[r,s]of a.entries())if(r<this.createdCells.length){this.addMarimoImport(s.language);let n=this.createdCells[r];this.createdCells[r]={...n,cell:s},this.onUpdateCell({cellId:n.cellId,code:s.code,language:s.language})}else{let n=this.onCreateCell(s.code);this.createdCells.push({cellId:n,cell:s})}}addMarimoImport(t){var a;if(this.hasMarimoImport||t==="python")return;let e=Di({autoInstantiate:!1,createNewCell:this.createNewCell,fromCellId:(a=this.createdCells[0])==null?void 0:a.cellId,before:!0});e&&this.addStagedCell({cellId:e}),this.hasMarimoImport=!0}stop(){this.buffer=""}};const yr=Vt.define(),Ge=Bt.define({create(){return new Map},update(t,e){let a=!1,r=t;for(let s of e.effects)if(s.is(yr)){a||(a=(r=new Map(t),!0));for(let[n,i]of s.value)r.set(n,i)}return r}}),Nu=Bt.define({create(){return{onResourceClick:void 0,onResourceMouseOver:void 0,onResourceMouseOut:void 0,onPromptSubmit:void 0}},update(t){return t}}),Mu=Vt.define();Bt.define({create(){return new Map},update(t,e){let a=!1,r=t;for(let s of e.effects)if(s.is(Mu)){a||(a=(r=new Map(t),!0));for(let[n,i]of s.value)r.set(n,i)}return r}});const Pu=(t,e)=>async a=>{let r=a.matchBefore(/@(\w+)?/);if(!r||r.from===r.to&&!a.explicit)return null;let s=await t();if(s.length===0)return null;let n=yr.of(new Map(s.map(o=>[o.uri,o])));a.view&&a.view.dispatch({effects:n});let i=s.map(o=>({label:`@${o.name}`,displayLabel:o.name,detail:o.uri,info:o.description||void 0,type:o.mimeType?"constant":"variable",boost:o.description?100:0,...e==null?void 0:e(o),apply:(d,l,u,p)=>{d.dispatch({changes:{from:u,to:p,insert:`@${o.uri} `}})}}));return{from:r.from,options:i}},ju=/@[\w-]+:\/\/(?!\/)[^\s]+/;function lt(t){return t.matchAll(new RegExp(ju.source,"g"))}var Zu=class extends Mr{constructor(e,a){super();W(this,"resource");W(this,"view");this.resource=e,this.view=a}eq(e){return e.resource.uri===this.resource.uri}toDOM(){let e=document.createElement("span");e.className="cm-resource-widget",e.textContent=`@${this.resource.name}`;let a=this.view.state.field(Nu,!1),r=a==null?void 0:a.onResourceClick,s=a==null?void 0:a.onResourceMouseOver,n=a==null?void 0:a.onResourceMouseOut;return r&&(e.style.cursor="pointer",e.addEventListener("click",i=>{i.preventDefault(),i.stopPropagation(),r(this.resource)})),s&&e.addEventListener("mouseover",i=>{i.preventDefault(),i.stopPropagation(),s(this.resource)}),n&&e.addEventListener("mouseout",i=>{i.preventDefault(),i.stopPropagation(),n(this.resource)}),e}},$u=class extends Mr{constructor(e,a){super();W(this,"uri");W(this,"view");this.uri=e,this.view=a}eq(e){return e.uri===this.uri}toDOM(){let e=document.createElement("span");return e.className="cm-not-found-resource-widget",e.textContent=`@${this.uri.split("://")[1]??this.uri}`,e}};function sn(t){let e=t.state.field(Ge),a=[];for(let{from:r,to:s}of t.visibleRanges){let n=t.state.doc.sliceString(r,s);for(let i of lt(n)){let o=r+i.index,d=i[0].slice(1),l=e.get(d);l?a.push(Ca.replace({widget:new Zu(l,t)}).range(o,o+i[0].length)):a.push(Ca.replace({widget:new $u(d,t)}).range(o,o+i[0].length))}}return Ca.set(a)}const Lu=li.fromClass(class{constructor(t){W(this,"decorations");this.decorations=sn(t)}update(t){(t.docChanged||t.viewportChanged||t.transactions.some(e=>e.effects.some(a=>a.is(yr))))&&(this.decorations=sn(t.view))}},{decorations:t=>t.decorations});function Du(t){let e=document.createElement("div");e.className="cm-tooltip-cursor";let a=document.createElement("div");if(a.className="cm-tooltip-cursor-title",a.textContent=`${t.name} (${t.uri})`,e.appendChild(a),t.description){let r=document.createElement("div");r.className="cm-tooltip-cursor-description",r.textContent=t.description,e.appendChild(r)}if(t.mimeType){let r=document.createElement("div");r.className="cm-tooltip-cursor-mimetype",r.textContent=t.mimeType,e.appendChild(r)}return{dom:e}}function Fu(t,e,a,r=0){for(let s of lt(t)){let n=r+s.index,i=n+s[0].length;if(e>=n&&e<=i){let o=s[0].slice(1),d=a.get(o);if(d)return{resource:d,start:n,end:i}}}return null}function zu(t){return oi((e,a)=>{let{from:r,text:s}=e.state.doc.lineAt(a),n=e.state.field(Ge),i=Fu(s,a,n,r);return i?{pos:i.start,end:i.end,above:!0,create(){return(t.createTooltip??Du)(i.resource)}}:null})}function Uu(t,e){let a=t.field(Ge),r=t.doc,s=r.lineAt(e),n=r.sliceString(s.from,s.to),i=Array.from(lt(n));if(i.length===0)return null;for(let o of i){let d=s.from+o.index,l=d+o[0].length,u=o[0].slice(1);if(e===l&&a.has(u))return{from:d,to:l,uri:u}}return null}function Vu(t,e){let a=t.field(Ge),r=t.doc,s=r.lineAt(e).to,n=r.sliceString(e,s),i=Array.from(lt(n));if(i.length===0)return null;let o=i[0];if(!o||o.index!==0)return null;let d=e,l=e+o[0].length,u=o[0].slice(1);return a.has(u)?{from:d,to:l,uri:u}:null}function nn(t,e){let a=t.field(Ge),r=t.doc,s=r.lineAt(e),n=r.sliceString(s.from,s.to),i=Array.from(lt(n));for(let o of i){let d=s.from+o.index,l=d+o[0].length,u=o[0].slice(1);if(e>d&&e<l&&a.has(u))return{from:d,to:l,uri:u}}return null}function Bu(t,e){let a=t.field(Ge),r=t.doc,s=r.lineAt(e),n=r.sliceString(s.from,e),i=Array.from(lt(n)),o=null;for(let d of i){let l=s.from+d.index,u=l+d[0].length,p=d[0].slice(1);a.has(p)&&u<=e&&(e>u?o=u:e===u&&(o=l))}return o}function Wu(t,e){let a=t.field(Ge),r=t.doc,s=r.lineAt(e),n=r.sliceString(s.from,s.to),i=Array.from(lt(n));for(let o of i){let d=s.from+o.index,l=d+o[0].length,u=o[0].slice(1);if(a.has(u)&&d>=e){if(e<d)return d;if(e===d)return l}}return null}const qu=ri.transactionFilter.of(t=>{var r;let e=t.annotation(si.userEvent);if(!e)return t;let a=t.startState.selection.main;if(!a.empty)return t;if(e==="input.type"||e.startsWith("input")){if(t.changes.empty)return t;let s=t.startState.field(Ge),n=t.startState.doc,i=!1,o=0,d=[];if(t.changes.iterChanges((l,u,p,_,v)=>{let x=v.toString(),f=l;if(/^\s+$/.test(x)){d.push({from:l,to:u,insert:x});return}let c=n.lineAt(f),m=n.sliceString(c.from,c.to),b=Array.from(lt(m)),T=!1,A=!1;for(let j of b){let U=c.from+j.index,P=U+j[0].length,X=j[0].slice(1);if(s.has(X)){if(f===U){let $=f>0?n.sliceString(f-1,f):"";$!==""&&$!==" "&&$!==`
`&&$!=="	"&&(T=!0)}if(f===P){let $=f<n.length?n.sliceString(f,f+1):"";($===""||$!==" "&&$!==`
`&&$!=="	")&&(A=!0)}}}let E=x;T&&(E=` ${E}`,o+=1),A&&(E=` ${E}`,o+=1),E!==x&&(i=!0),d.push({from:l,to:u,insert:E})}),i){let l=t.selection?{anchor:t.selection.main.anchor+o,head:t.selection.main.head+o}:void 0;return[{changes:d,selection:l,scrollIntoView:t.scrollIntoView}]}}if(e==="delete.backward"||e==="delete.forward"){let s=null;return e==="delete.backward"?s=Uu(t.startState,a.head):e==="delete.forward"&&(s=Vu(t.startState,a.head)),s?[{changes:{from:s.from,to:s.to,insert:""},selection:{anchor:s.from},scrollIntoView:!0}]:t}if((r=t.selection)!=null&&r.main.empty&&a.empty&&!e.startsWith("input")&&e!=="input.type"){let s=a.head,n=t.selection.main.head,i=null;if(n<s){let o=nn(t.startState,s);i=o&&s>o.from?o.from:Bu(t.startState,s)}else if(n>s){let o=nn(t.startState,s);i=o&&s<o.to?o.to:Wu(t.startState,s)}if(i!==null&&i!==n)return[{selection:{anchor:i},scrollIntoView:!0}]}return t}),Ku=Nr.baseTheme({".cm-resource-widget":{background:"light-dark(rgba(86,156,214,0.08),rgba(86,156,214,0.18))",borderRadius:"4px",padding:"2px 4px",color:"light-dark(#2367a2,#7ecbff)",fontWeight:"500"},".cm-resource-widget:hover":{background:"light-dark(rgba(86,156,214,0.18),rgba(86,156,214,0.28))"},".cm-not-found-resource-widget":{background:"light-dark(rgba(151,151,151,0.08),rgba(151,151,151,0.18))",borderRadius:"4px",padding:"2px 4px",color:"light-dark(#b00020,#ff8080)",fontWeight:"500"}});var on="_none_",Ju=[{uri:"",name:"No resources",type:on,data:{}}],Yu={info:"Variables, dataframes, and tables will appear here.",apply:()=>{}};function Gu(t){let{language:e,store:a,onAddFiles:r}=t;return[e.data.of({autocomplete:Pu(async()=>{let s=ht(a).getAllItems();return s.length===0?Ju:s},s=>{var n;return s.type===on?Yu:((n=ht(a).getProvider(s.type))==null?void 0:n.formatCompletion(s))||{}})}),Gs.of({addAttachment:s=>r==null?void 0:r([s])}),...r?[e.data.of({autocomplete:pu().createCompletionSource()})]:[],Lu,qu,Ge.init(()=>{let s=ht(a).getAllItems();return new Map(s.map(n=>[n.uri,n]))}),Ku,zu({createTooltip:s=>{let n=ht(a).getProvider(s.type);if(!n)return ce.warn("No provider found for resource",s),Dt(s.description||s.name);let i=n.formatCompletion(s),o=s.description||s.name;if(!(i!=null&&i.info))return Dt(o);if(typeof i.info=="string")return Dt(i.info);let d=i.info(i);return d?"dom"in d?{dom:d.dom}:"then"in d?(ce.warn("info is a promise. This is not supported",d),Dt(o)):{dom:d}:Dt(o)}})]}function Dt(t){let e=document.createElement("div");return e.innerHTML=t,{dom:e}}var ln=tt(ka()),R=tt(ei());const dn=t=>{let{handleAcceptCompletion:e,handleDeclineCompletion:a,isLoading:r,hasCompletion:s}=t;return n=>{let i=ti()?n.metaKey:n.ctrlKey;i&&n.key==="Enter"&&!r&&s&&e(),(n.key==="Delete"||n.key==="Backspace")&&i&&n.shiftKey&&(a(),n.preventDefault(),n.stopPropagation())}},un=t=>{let e=(0,ln.c)(22),{isLoading:a,onAccept:r,onDecline:s,size:n,acceptShortcut:i,declineShortcut:o,multipleCompletions:d}=t,l=n===void 0?"sm":n,u=i===void 0?"Mod-\u21B5":i,p=o===void 0?"Shift-Mod-Delete":o,_=d===void 0?!1:d,v=_&&" all",x;e[0]===u?x=e[1]:(x=(0,R.jsx)($r,{className:"ml-1 inline",shortcut:u}),e[0]=u,e[1]=x);let f;e[2]!==v||e[3]!==x?(f=(0,R.jsxs)("span",{className:"text-(--grass-11) opacity-100",children:["Accept",v," ",x]}),e[2]=v,e[3]=x,e[4]=f):f=e[4];let c;e[5]!==a||e[6]!==r||e[7]!==l||e[8]!==f?(c=(0,R.jsx)(at,{"data-testid":"accept-completion-button",variant:"text",size:l,className:"mb-0",disabled:a,onClick:r,children:f}),e[5]=a,e[6]=r,e[7]=l,e[8]=f,e[9]=c):c=e[9];let m=_&&" all",b;e[10]===p?b=e[11]:(b=(0,R.jsx)($r,{className:"ml-1 inline",shortcut:p}),e[10]=p,e[11]=b);let T;e[12]!==b||e[13]!==m?(T=(0,R.jsxs)("span",{className:"text-(--red-10)",children:["Reject",m," ",b]}),e[12]=b,e[13]=m,e[14]=T):T=e[14];let A;e[15]!==s||e[16]!==l||e[17]!==T?(A=(0,R.jsx)(at,{"data-testid":"decline-completion-button",variant:"text",size:l,className:"mb-0 pl-1 pr-0",onClick:s,children:T}),e[15]=s,e[16]=l,e[17]=T,e[18]=A):A=e[18];let E;return e[19]!==A||e[20]!==c?(E=(0,R.jsxs)(R.Fragment,{children:[c,A]}),e[19]=A,e[20]=c,e[21]=E):E=e[21],E},Hu=t=>{let e=(0,ln.c)(8),{isLoading:a,onAccept:r,onDecline:s}=t,n;e[0]!==a||e[1]!==r?(n=(0,R.jsx)(at,{variant:"text",size:"xs",disabled:a,onClick:r,className:`h-6 text-(--grass-11) border-(--grass-7) bg-(--grass-3)/60
        hover:bg-(--grass-3) dark:bg-(--grass-4)/80 dark:hover:bg-(--grass-3) rounded px-3 font-semibold
        active:bg-(--grass-5) dark:active:bg-(--grass-4)
        border-(--green-6) border hover:shadow-xs`,children:"Accept"}),e[0]=a,e[1]=r,e[2]=n):n=e[2];let i;e[3]===s?i=e[4]:(i=(0,R.jsx)(at,{variant:"text",size:"xs",onClick:s,className:`h-6 text-(--red-10) border-(--red-7) bg-(--red-3)/60 hover:bg-(--red-3)
        dark:bg-(--red-4)/80 dark:hover:bg-(--red-3) rounded px-3 font-semibold
        active:bg-(--red-5) dark:active:bg-(--red-4)
        border-(--red-6) border hover:shadow-xs`,children:"Reject"}),e[3]=s,e[4]=i);let o;return e[5]!==n||e[6]!==i?(o=(0,R.jsxs)(R.Fragment,{children:[n,i]}),e[5]=n,e[6]=i,e[7]=o):o=e[7],o};var Qu=class extends Ja{constructor(t,e){super(t),this.onChunkReceived=e}processResponseStream(t){let e=this.onChunkReceived;return super.processResponseStream(t).pipeThrough(new TransformStream({async transform(a,r){e(a),r.enqueue(a)}}))}},cn=tt(ka()),Xu=Fn("marimo:ai-language","python"),pn="marimo:ai-prompt-history",mn=new Jn(Be(h()),()=>[]);const ec=t=>{let e=(0,cn.c)(83),{onClose:a}=t,r=Cr(),[s,n]=(0,N.useState)(""),{deleteAllStagedCells:i,clearStagedCells:o,onStream:d}=rn(r),[l,u]=In(Xu),p=ai(),{invokeAiTool:_}=ui(),v=En(ga),x=(0,N.useRef)(null),f;if(e[0]!==l||e[1]!==d||e[2]!==p){let xe;e[4]===l?xe=e[5]:(xe=async zt=>{let wn=await Qs(zt.messages);return{body:{...zt,...wn,code:"",prompt:"",language:l}}},e[4]=l,e[5]=xe);let Ie;e[6]===d?Ie=e[7]:(Ie=zt=>{d(zt)},e[6]=d,e[7]=Ie),f=new Qu({api:p.getAiURL("completion").toString(),headers:p.headers(),prepareSendMessagesRequest:xe},Ie),e[0]=l,e[1]=d,e[2]=p,e[3]=f}else f=e[3];let{sendMessage:c,stop:m,status:b,addToolResult:T}=Ws({experimental_throttle:100,transport:f,onToolCall:async xe=>{let{toolCall:Ie}=xe;await Xs({invokeAiTool:_,addToolResult:A,toolCall:{toolName:Ie.toolName,toolCallId:Ie.toolCallId,input:Ie.input}})},onError:tc}),A=T,E=b==="streaming"||b==="submitted",j=v.size>0,U=v.size>1,P;e[8]!==i||e[9]!==s||e[10]!==E||e[11]!==c?(P=()=>{var xe;E||((xe=x.current)!=null&&xe.view&&tn(x.current.view),i(),c({text:s}))},e[8]=i,e[9]=s,e[10]=E,e[11]=c,e[12]=P):P=e[12];let X=P,$;e[13]===Symbol.for("react.memo_cache_sentinel")?($=(0,R.jsxs)(R.Fragment,{children:[(0,R.jsx)(Fi,{className:"size-4 mr-2"}),"Python"]}),e[13]=$):$=e[13];let oe=$,le;e[14]===Symbol.for("react.memo_cache_sentinel")?(le=(0,R.jsxs)(R.Fragment,{children:[(0,R.jsx)(Pn,{className:"size-4 mr-2"}),"SQL"]}),e[14]=le):le=e[14];let ae=le,Y=l==="python"?oe:ae,he;e[15]===Symbol.for("react.memo_cache_sentinel")?(he=(0,R.jsx)(wi,{className:"ml-1 h-3.5 w-3.5 text-muted-foreground/70"}),e[15]=he):he=e[15];let J;e[16]===Y?J=e[17]:(J=(0,R.jsx)(Ci,{asChild:!0,children:(0,R.jsxs)(at,{variant:"text",className:"ml-2",size:"xs","data-testid":"language-button",children:[Y,he]})}),e[16]=Y,e[17]=J);let q,G;e[18]===Symbol.for("react.memo_cache_sentinel")?(q=(0,R.jsx)("div",{className:"px-2 py-1 font-semibold",children:"Select language"}),G=(0,R.jsx)(ki,{}),e[18]=q,e[19]=G):(q=e[18],G=e[19]);let Ae;e[20]===u?Ae=e[21]:(Ae=(0,R.jsx)(Zr,{onClick:()=>u("python"),children:oe}),e[20]=u,e[21]=Ae);let ve;e[22]===u?ve=e[23]:(ve=(0,R.jsx)(Zr,{onClick:()=>u("sql"),children:ae}),e[22]=u,e[23]=ve);let _e;e[24]!==Ae||e[25]!==ve?(_e=(0,R.jsxs)(Ti,{align:"center",children:[q,G,Ae,ve]}),e[24]=Ae,e[25]=ve,e[26]=_e):_e=e[26];let Ce;e[27]!==_e||e[28]!==J?(Ce=(0,R.jsxs)(Ii,{modal:!1,children:[J,_e]}),e[27]=_e,e[28]=J,e[29]=Ce):Ce=e[29];let He=Ce,Qe;e[30]!==o||e[31]!==a?(Qe=()=>{o(),a()},e[30]=o,e[31]=a,e[32]=Qe):Qe=e[32];let Oe=Qe,dt;e[33]===i?dt=e[34]:(dt=()=>{i()},e[33]=i,e[34]=dt);let Fe=dt,ft;e[35]===Symbol.for("react.memo_cache_sentinel")?(ft=(0,R.jsx)(Si,{className:"size-4 text-(--blue-11) mr-2"}),e[35]=ft):ft=e[35];let Xe;e[36]!==i||e[37]!==a?(Xe=()=>{i(),a()},e[36]=i,e[37]=a,e[38]=Xe):Xe=e[38];let Ze;e[39]===Symbol.for("react.memo_cache_sentinel")?(Ze=xe=>{n(xe)},e[39]=Ze):Ze=e[39];let ze;e[40]!==Oe||e[41]!==Fe||e[42]!==j||e[43]!==E?(ze=dn({handleAcceptCompletion:Oe,handleDeclineCompletion:Fe,isLoading:E,hasCompletion:j}),e[40]=Oe,e[41]=Fe,e[42]=j,e[43]=E,e[44]=ze):ze=e[44];let V;e[45]!==s||e[46]!==X||e[47]!==Xe||e[48]!==ze?(V=(0,R.jsx)(hn,{inputRef:x,onClose:Xe,value:s,onChange:Ze,onSubmit:X,onKeyDown:ze}),e[45]=s,e[46]=X,e[47]=Xe,e[48]=ze,e[49]=V):V=e[49];let L;e[50]!==E||e[51]!==m?(L=E&&(0,R.jsxs)(at,{"data-testid":"stop-completion-button",variant:"text",size:"sm",className:"mb-0",onClick:m,children:[(0,R.jsx)(Ei,{className:"animate-spin mr-1",size:14}),"Stop"]}),e[50]=E,e[51]=m,e[52]=L):L=e[52];let ee;e[53]===Symbol.for("react.memo_cache_sentinel")?(ee=(0,R.jsx)(Ui,{className:"size-4"}),e[53]=ee):ee=e[53];let B;e[54]===X?B=e[55]:(B=(0,R.jsx)(at,{variant:"text",size:"sm",onClick:X,title:"Submit",children:ee}),e[54]=X,e[55]=B);let Te;e[56]===Symbol.for("react.memo_cache_sentinel")?(Te=(0,R.jsx)(_i,{className:"size-4"}),e[56]=Te):Te=e[56];let ge;e[57]===a?ge=e[58]:(ge=(0,R.jsx)(at,{variant:"text",size:"sm",className:"mb-0 px-1",onClick:a,children:Te}),e[57]=a,e[58]=ge);let se;e[59]!==V||e[60]!==L||e[61]!==B||e[62]!==ge?(se=(0,R.jsxs)("div",{className:"flex items-center px-3",children:[ft,V,L,B,ge]}),e[59]=V,e[60]=L,e[61]=B,e[62]=ge,e[63]=se):se=e[63];let ne=se,be;e[64]===Symbol.for("react.memo_cache_sentinel")?(be=Rr("flex flex-col w-full gap-2 py-2"),e[64]=be):be=e[64];let Ue;e[65]===j?Ue=e[66]:(Ue=!j&&(0,R.jsxs)("span",{className:"text-xs text-muted-foreground px-3 flex flex-col gap-1",children:[(0,R.jsxs)("span",{children:["You can mention"," ",(0,R.jsx)("span",{className:"text-(--cyan-11)",children:"@dataframe"})," or"," ",(0,R.jsx)("span",{className:"text-(--cyan-11)",children:"@sql_table"})," to pull additional context such as column names."]}),(0,R.jsx)("span",{children:"Code from other cells is automatically included."})]}),e[65]=j,e[66]=Ue);let Ve;e[67]!==Oe||e[68]!==Fe||e[69]!==j||e[70]!==E||e[71]!==U?(Ve=j&&(0,R.jsx)(un,{isLoading:E,onAccept:Oe,onDecline:Fe,size:"sm",multipleCompletions:U}),e[67]=Oe,e[68]=Fe,e[69]=j,e[70]=E,e[71]=U,e[72]=Ve):Ve=e[72];let ut;e[73]===Symbol.for("react.memo_cache_sentinel")?(ut=(0,R.jsx)(vi,{triggerClassName:"h-7 text-xs max-w-64",iconSize:"small",forRole:"edit"}),e[73]=ut):ut=e[73];let ie;e[74]===He?ie=e[75]:(ie=(0,R.jsxs)("div",{className:"ml-auto flex items-center gap-1",children:[He,ut]}),e[74]=He,e[75]=ie);let pe;e[76]!==Ue||e[77]!==Ve||e[78]!==ie?(pe=(0,R.jsxs)("div",{className:"flex flex-row justify-between -mt-1 ml-1 mr-3",children:[Ue,Ve,ie]}),e[76]=Ue,e[77]=Ve,e[78]=ie,e[79]=pe):pe=e[79];let et;return e[80]!==ne||e[81]!==pe?(et=(0,R.jsxs)("div",{className:be,children:[ne,pe]}),e[80]=ne,e[81]=pe,e[82]=et):et=e[82],et},hn=t=>{let e=(0,cn.c)(35),{value:a,placeholder:r,inputRef:s,className:n,onChange:i,onSubmit:o,onKeyDown:d,onClose:l,onAddFiles:u,additionalCompletions:p,maxHeight:_}=t,v=o,x=l,f=Cr(),{theme:c}=gi(),m;e[0]===p?m=e[1]:(m=q=>p?yu([p.triggerCompletionRegex],p.completions)(q):null,e[0]=p,e[1]=m);let b=Ni(m),T,A,E,j;if(e[2]!==b||e[3]!==u||e[4]!==f){let q=fi();e[9]===Symbol.for("react.memo_cache_sentinel")?(T=hi({}),e[9]=T):T=e[9],A=q,E=Gu({language:q.language,store:f,onAddFiles:u}),j=q.language.data.of({autocomplete:b}),e[2]=b,e[3]=u,e[4]=f,e[5]=T,e[6]=A,e[7]=E,e[8]=j}else T=e[5],A=e[6],E=e[7],j=e[8];let U;e[10]===Symbol.for("react.memo_cache_sentinel")?(U=Su({storage:{load:ac,save:rc}}),e[10]=U):U=e[10];let P;e[11]===Symbol.for("react.memo_cache_sentinel")?(P=$i(),e[11]=P):P=e[11];let X;e[12]===v?X=e[13]:(X=ii.highest(Ta.of([{preventDefault:!0,stopPropagation:!0,any:(q,G)=>{let Ae=G.metaKey||G.ctrlKey||G.shiftKey;if(G.key==="Enter"&&!Ae)return v(G,q.state.doc.toString()),G.preventDefault(),G.stopPropagation(),!0;if(G.key==="Enter"&&G.shiftKey){let ve=q.state.selection.main.from;return q.dispatch({changes:{from:ve,to:ve,insert:`
`},selection:{anchor:ve+1,head:ve+1}}),G.preventDefault(),G.stopPropagation(),!0}return!1}}])),e[12]=v,e[13]=X);let $;e[14]===x?$=e[15]:($=Ta.of([{key:"Escape",preventDefault:!0,stopPropagation:!0,run:()=>(x(),!0)}]),e[14]=x,e[15]=$);let oe;e[16]!==T||e[17]!==A||e[18]!==E||e[19]!==j||e[20]!==X||e[21]!==$?(oe=[T,A,E,j,U,Nr.lineWrapping,P,X,$],e[16]=T,e[17]=A,e[18]=E,e[19]=j,e[20]=X,e[21]=$,e[22]=oe):oe=e[22];let le=oe,ae;e[23]===n?ae=e[24]:(ae=Rr("flex-1 font-sans overflow-auto my-1",n),e[23]=n,e[24]=ae);let Y=c==="dark"?"dark":"light",he=r||"Generate with AI, @ to include context",J;return e[25]!==le||e[26]!==s||e[27]!==_||e[28]!==i||e[29]!==d||e[30]!==ae||e[31]!==Y||e[32]!==he||e[33]!==a?(J=(0,R.jsx)(Li,{ref:s,className:ae,width:"100%",maxHeight:_,value:a,basicSetup:!1,extensions:le,onChange:i,onKeyDown:d,theme:Y,placeholder:he}),e[25]=le,e[26]=s,e[27]=_,e[28]=i,e[29]=d,e[30]=ae,e[31]=Y,e[32]=he,e[33]=a,e[34]=J):J=e[34],J};function tc(t){Pr({title:"Generate with AI failed",description:Mi(t)})}function ac(){return mn.get(pn)}function rc(t){return mn.set(pn,t)}export{Hd as C,Ws as S,zi as T,hu as _,dn as a,Xd as b,tn as c,bu as d,Xs as f,vu as g,mu as h,Hu as i,Qs as l,wu as m,hn as n,ga as o,ku as p,un as r,rn as s,ec as t,xu as u,ht as v,Ja as w,mr as x,hr as y};
