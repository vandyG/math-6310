import{S as zn,m as In}from"./_Uint8Array-CPNtPV0k.js";import{t as Dn}from"./toString-pPvo2488.js";import{_ as q,c as Fn,h as Vn,m as An,n as Jn,y as Hn}from"./isArrayLikeObject-CQy5-FN4.js";import{r as Kn,t as Qn}from"./_getTag-C4fv2peH.js";import{a as j,c as nn,i as x,n as L,r as m,s,u as Un}from"./_baseUniq-DuMeVp_r.js";import{n as N}from"./_basePickBy-CViVNfOD.js";import{t as C}from"./pick-CHglt4eJ.js";import{t as z}from"./merge-DrdmtLTL.js";import{t as Wn}from"./_hasUnicode-CPHpt5EV.js";import{n as rn,r as en}from"./_baseEach-CWBhny_f.js";import{t as Xn}from"./_baseProperty-CIKnF2iY.js";import{t as tn}from"./now-CKgsywea.js";import{a as on,c as T,i as Yn,l as Zn,n as an,o as p,r as $n,s as I,t as P}from"./min-DZ9NrTCT.js";import{t as R}from"./sortBy-DV7a6-en.js";import{t as E}from"./range-Dsq9WHSI.js";import{t as b}from"./graphlib-C6T8v0kT.js";var nr=1,rr=4;function er(n){return Un(n,nr|rr)}var tr=er;function or(n,r){return n==null?n:Jn(n,nn(r),Fn)}var ir=or;function ar(n,r){return n&&rn(n,nn(r))}var ur=ar;function dr(n,r){return n>r}var cr=dr;function sr(n,r){var e={};return r=en(r,3),rn(n,function(t,o,a){Vn(e,o,r(t,o,a))}),e}var S=sr;function fr(n){return n&&n.length?an(n,Hn,cr):void 0}var y=fr;function hr(n,r){return n&&n.length?an(n,en(r,2),$n):void 0}var D=hr,gr=Xn("length"),un="\\ud800-\\udfff",vr="\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff",lr="\\ufe0e\\ufe0f",pr="["+un+"]",F="["+vr+"]",V="\\ud83c[\\udffb-\\udfff]",wr="(?:"+F+"|"+V+")",dn="[^"+un+"]",cn="(?:\\ud83c[\\udde6-\\uddff]){2}",sn="[\\ud800-\\udbff][\\udc00-\\udfff]",mr="\\u200d",fn=wr+"?",hn="["+lr+"]?",br="(?:"+mr+"(?:"+[dn,cn,sn].join("|")+")"+hn+fn+")*",yr=hn+fn+br,kr="(?:"+[dn+F+"?",F,cn,sn,pr].join("|")+")",gn=RegExp(V+"(?="+V+")|"+kr+yr,"g");function xr(n){for(var r=gn.lastIndex=0;gn.test(n);)++r;return r}var Er=xr;function Or(n){return Wn(n)?Er(n):gr(n)}var _r=Or,jr="[object Map]",Nr="[object Set]";function Pr(n){if(n==null)return 0;if(In(n))return Yn(n)?_r(n):n.length;var r=Qn(n);return r==jr||r==Nr?n.size:Kn(n).length}var Rr=Pr,Mr=0;function Lr(n){var r=++Mr;return Dn(n)+r}var A=Lr;function Cr(n,r,e){for(var t=-1,o=n.length,a=r.length,i={};++t<o;){var u=t<a?r[t]:void 0;e(i,n[t],u)}return i}var Tr=Cr;function Sr(n,r){return Tr(n||[],r||[],An)}var Gr=Sr,Br=class{constructor(){var n={};n._next=n._prev=n,this._sentinel=n}dequeue(){var n=this._sentinel,r=n._prev;if(r!==n)return vn(r),r}enqueue(n){var r=this._sentinel;n._prev&&n._next&&vn(n),n._next=r._next,r._next._prev=n,r._next=n,n._prev=r}toString(){for(var n=[],r=this._sentinel,e=r._prev;e!==r;)n.push(JSON.stringify(e,qr)),e=e._prev;return"["+n.join(", ")+"]"}};function vn(n){n._prev._next=n._next,n._next._prev=n._prev,delete n._next,delete n._prev}function qr(n,r){if(n!=="_next"&&n!=="_prev")return r}var zr=q(1);function Ir(n,r){if(n.nodeCount()<=1)return[];var e=Fr(n,r||zr),t=Dr(e.graph,e.buckets,e.zeroIdx);return N(p(t,function(o){return n.outEdges(o.v,o.w)}))}function Dr(n,r,e){for(var t=[],o=r[r.length-1],a=r[0],i;n.nodeCount();){for(;i=a.dequeue();)J(n,r,e,i);for(;i=o.dequeue();)J(n,r,e,i);if(n.nodeCount()){for(var u=r.length-2;u>0;--u)if(i=r[u].dequeue(),i){t=t.concat(J(n,r,e,i,!0));break}}}return t}function J(n,r,e,t,o){var a=o?[]:void 0;return s(n.inEdges(t.v),function(i){var u=n.edge(i),d=n.node(i.v);o&&a.push({v:i.v,w:i.w}),d.out-=u,H(r,e,d)}),s(n.outEdges(t.v),function(i){var u=n.edge(i),d=i.w,c=n.node(d);c.in-=u,H(r,e,c)}),n.removeNode(t.v),a}function Fr(n,r){var e=new b,t=0,o=0;s(n.nodes(),function(u){e.setNode(u,{v:u,in:0,out:0})}),s(n.edges(),function(u){var d=e.edge(u.v,u.w)||0,c=r(u),f=d+c;e.setEdge(u.v,u.w,f),o=Math.max(o,e.node(u.v).out+=c),t=Math.max(t,e.node(u.w).in+=c)});var a=E(o+t+3).map(function(){return new Br}),i=t+1;return s(e.nodes(),function(u){H(a,i,e.node(u))}),{graph:e,buckets:a,zeroIdx:i}}function H(n,r,e){e.out?e.in?n[e.out-e.in+r].enqueue(e):n[n.length-1].enqueue(e):n[0].enqueue(e)}function Vr(n){var r=n.graph().acyclicer==="greedy"?Ir(n,e(n)):Ar(n);s(r,function(t){var o=n.edge(t);n.removeEdge(t),o.forwardName=t.name,o.reversed=!0,n.setEdge(t.w,t.v,o,A("rev"))});function e(t){return function(o){return t.edge(o).weight}}}function Ar(n){var r=[],e={},t={};function o(a){Object.prototype.hasOwnProperty.call(t,a)||(t[a]=!0,e[a]=!0,s(n.outEdges(a),function(i){Object.prototype.hasOwnProperty.call(e,i.w)?r.push(i):o(i.w)}),delete e[a])}return s(n.nodes(),o),r}function Jr(n){s(n.edges(),function(r){var e=n.edge(r);if(e.reversed){n.removeEdge(r);var t=e.forwardName;delete e.reversed,delete e.forwardName,n.setEdge(r.w,r.v,e,t)}})}function O(n,r,e,t){var o;do o=A(t);while(n.hasNode(o));return e.dummy=r,n.setNode(o,e),o}function Hr(n){var r=new b().setGraph(n.graph());return s(n.nodes(),function(e){r.setNode(e,n.node(e))}),s(n.edges(),function(e){var t=r.edge(e.v,e.w)||{weight:0,minlen:1},o=n.edge(e);r.setEdge(e.v,e.w,{weight:t.weight+o.weight,minlen:Math.max(t.minlen,o.minlen)})}),r}function ln(n){var r=new b({multigraph:n.isMultigraph()}).setGraph(n.graph());return s(n.nodes(),function(e){n.children(e).length||r.setNode(e,n.node(e))}),s(n.edges(),function(e){r.setEdge(e,n.edge(e))}),r}function pn(n,r){var e=n.x,t=n.y,o=r.x-e,a=r.y-t,i=n.width/2,u=n.height/2;if(!o&&!a)throw Error("Not possible to find intersection inside of the rectangle");var d,c;return Math.abs(a)*i>Math.abs(o)*u?(a<0&&(u=-u),d=u*o/a,c=u):(o<0&&(i=-i),d=i,c=i*a/o),{x:e+d,y:t+c}}function G(n){var r=p(E(mn(n)+1),function(){return[]});return s(n.nodes(),function(e){var t=n.node(e),o=t.rank;m(o)||(r[o][t.order]=e)}),r}function Kr(n){var r=P(p(n.nodes(),function(e){return n.node(e).rank}));s(n.nodes(),function(e){var t=n.node(e);on(t,"rank")&&(t.rank-=r)})}function Qr(n){var r=P(p(n.nodes(),function(a){return n.node(a).rank})),e=[];s(n.nodes(),function(a){var i=n.node(a).rank-r;e[i]||(e[i]=[]),e[i].push(a)});var t=0,o=n.graph().nodeRankFactor;s(e,function(a,i){m(a)&&i%o!==0?--t:t&&s(a,function(u){n.node(u).rank+=t})})}function wn(n,r,e,t){var o={width:0,height:0};return arguments.length>=4&&(o.rank=e,o.order=t),O(n,"border",o,r)}function mn(n){return y(p(n.nodes(),function(r){var e=n.node(r).rank;if(!m(e))return e}))}function Ur(n,r){var e={lhs:[],rhs:[]};return s(n,function(t){r(t)?e.lhs.push(t):e.rhs.push(t)}),e}function Wr(n,r){var e=tn();try{return r()}finally{console.log(n+" time: "+(tn()-e)+"ms")}}function Xr(n,r){return r()}function Yr(n){function r(e){var t=n.children(e),o=n.node(e);if(t.length&&s(t,r),Object.prototype.hasOwnProperty.call(o,"minRank")){o.borderLeft=[],o.borderRight=[];for(var a=o.minRank,i=o.maxRank+1;a<i;++a)bn(n,"borderLeft","_bl",e,o,a),bn(n,"borderRight","_br",e,o,a)}}s(n.children(),r)}function bn(n,r,e,t,o,a){var i={width:0,height:0,rank:a,borderType:r},u=o[r][a-1],d=O(n,"border",i,e);o[r][a]=d,n.setParent(d,t),u&&n.setEdge(u,d,{weight:1})}function Zr(n){var r=n.graph().rankdir.toLowerCase();(r==="lr"||r==="rl")&&yn(n)}function $r(n){var r=n.graph().rankdir.toLowerCase();(r==="bt"||r==="rl")&&ne(n),(r==="lr"||r==="rl")&&(re(n),yn(n))}function yn(n){s(n.nodes(),function(r){kn(n.node(r))}),s(n.edges(),function(r){kn(n.edge(r))})}function kn(n){var r=n.width;n.width=n.height,n.height=r}function ne(n){s(n.nodes(),function(r){K(n.node(r))}),s(n.edges(),function(r){var e=n.edge(r);s(e.points,K),Object.prototype.hasOwnProperty.call(e,"y")&&K(e)})}function K(n){n.y=-n.y}function re(n){s(n.nodes(),function(r){Q(n.node(r))}),s(n.edges(),function(r){var e=n.edge(r);s(e.points,Q),Object.prototype.hasOwnProperty.call(e,"x")&&Q(e)})}function Q(n){var r=n.x;n.x=n.y,n.y=r}function ee(n){n.graph().dummyChains=[],s(n.edges(),function(r){te(n,r)})}function te(n,r){var e=r.v,t=n.node(e).rank,o=r.w,a=n.node(o).rank,i=r.name,u=n.edge(r),d=u.labelRank;if(a!==t+1){n.removeEdge(r);var c=void 0,f,h;for(h=0,++t;t<a;++h,++t)u.points=[],c={width:0,height:0,edgeLabel:u,edgeObj:r,rank:t},f=O(n,"edge",c,"_d"),t===d&&(c.width=u.width,c.height=u.height,c.dummy="edge-label",c.labelpos=u.labelpos),n.setEdge(e,f,{weight:u.weight},i),h===0&&n.graph().dummyChains.push(f),e=f;n.setEdge(e,o,{weight:u.weight},i)}}function oe(n){s(n.graph().dummyChains,function(r){var e=n.node(r),t=e.edgeLabel,o;for(n.setEdge(e.edgeObj,t);e.dummy;)o=n.successors(r)[0],n.removeNode(r),t.points.push({x:e.x,y:e.y}),e.dummy==="edge-label"&&(t.x=e.x,t.y=e.y,t.width=e.width,t.height=e.height),r=o,e=n.node(r)})}function U(n){var r={};function e(t){var o=n.node(t);if(Object.prototype.hasOwnProperty.call(r,t))return o.rank;r[t]=!0;var a=P(p(n.outEdges(t),function(i){return e(i.w)-n.edge(i).minlen}));return(a===1/0||a==null)&&(a=0),o.rank=a}s(n.sources(),e)}function M(n,r){return n.node(r.w).rank-n.node(r.v).rank-n.edge(r).minlen}function xn(n){var r=new b({directed:!1}),e=n.nodes()[0],t=n.nodeCount();r.setNode(e,{});for(var o,a;ie(r,n)<t;)o=ae(r,n),a=r.hasNode(o.v)?M(n,o):-M(n,o),ue(r,n,a);return r}function ie(n,r){function e(t){s(r.nodeEdges(t),function(o){var a=o.v,i=t===a?o.w:a;!n.hasNode(i)&&!M(r,o)&&(n.setNode(i,{}),n.setEdge(t,i,{}),e(i))})}return s(n.nodes(),e),n.nodeCount()}function ae(n,r){return D(r.edges(),function(e){if(n.hasNode(e.v)!==n.hasNode(e.w))return M(r,e)})}function ue(n,r,e){s(n.nodes(),function(t){r.node(t).rank+=e})}q(1),q(1),de.CycleException=B;function de(n){var r={},e={},t=[];function o(a){if(Object.prototype.hasOwnProperty.call(e,a))throw new B;Object.prototype.hasOwnProperty.call(r,a)||(e[a]=!0,r[a]=!0,s(n.predecessors(a),o),delete e[a],t.push(a))}if(s(n.sinks(),o),Rr(r)!==n.nodeCount())throw new B;return t}function B(){}B.prototype=Error();function En(n,r,e){zn(r)||(r=[r]);var t=(n.isDirected()?n.successors:n.neighbors).bind(n),o=[],a={};return s(r,function(i){if(!n.hasNode(i))throw Error("Graph does not have node: "+i);On(n,i,e==="post",a,t,o)}),o}function On(n,r,e,t,o,a){Object.prototype.hasOwnProperty.call(t,r)||(t[r]=!0,e||a.push(r),s(o(r),function(i){On(n,i,e,t,o,a)}),e&&a.push(r))}function ce(n,r){return En(n,r,"post")}function se(n,r){return En(n,r,"pre")}k.initLowLimValues=X,k.initCutValues=W,k.calcCutValue=_n,k.leaveEdge=Nn,k.enterEdge=Pn,k.exchangeEdges=Rn;function k(n){n=Hr(n),U(n);var r=xn(n);X(r),W(r,n);for(var e,t;e=Nn(r);)t=Pn(r,n,e),Rn(r,n,e,t)}function W(n,r){var e=ce(n,n.nodes());e=e.slice(0,e.length-1),s(e,function(t){fe(n,r,t)})}function fe(n,r,e){var t=n.node(e).parent;n.edge(e,t).cutvalue=_n(n,r,e)}function _n(n,r,e){var t=n.node(e).parent,o=!0,a=r.edge(e,t),i=0;return a||(a=(o=!1,r.edge(t,e))),i=a.weight,s(r.nodeEdges(e),function(u){var d=u.v===e,c=d?u.w:u.v;if(c!==t){var f=d===o,h=r.edge(u).weight;if(i+=f?h:-h,ge(n,e,c)){var g=n.edge(e,c).cutvalue;i+=f?-g:g}}}),i}function X(n,r){arguments.length<2&&(r=n.nodes()[0]),jn(n,{},1,r)}function jn(n,r,e,t,o){var a=e,i=n.node(t);return r[t]=!0,s(n.neighbors(t),function(u){Object.prototype.hasOwnProperty.call(r,u)||(e=jn(n,r,e,u,t))}),i.low=a,i.lim=e++,o?i.parent=o:delete i.parent,e}function Nn(n){return I(n.edges(),function(r){return n.edge(r).cutvalue<0})}function Pn(n,r,e){var t=e.v,o=e.w;r.hasEdge(t,o)||(t=e.w,o=e.v);var a=n.node(t),i=n.node(o),u=a,d=!1;a.lim>i.lim&&(u=i,d=!0);var c=j(r.edges(),function(f){return d===Mn(n,n.node(f.v),u)&&d!==Mn(n,n.node(f.w),u)});return D(c,function(f){return M(r,f)})}function Rn(n,r,e,t){var o=e.v,a=e.w;n.removeEdge(o,a),n.setEdge(t.v,t.w,{}),X(n),W(n,r),he(n,r)}function he(n,r){var e=I(n.nodes(),function(o){return!r.node(o).parent}),t=se(n,e);t=t.slice(1),s(t,function(o){var a=n.node(o).parent,i=r.edge(o,a),u=!1;i||(i=r.edge(a,o),u=!0),r.node(o).rank=r.node(a).rank+(u?i.minlen:-i.minlen)})}function ge(n,r,e){return n.hasEdge(r,e)}function Mn(n,r,e){return e.low<=r.lim&&r.lim<=e.lim}function ve(n){switch(n.graph().ranker){case"network-simplex":Ln(n);break;case"tight-tree":pe(n);break;case"longest-path":le(n);break;default:Ln(n)}}var le=U;function pe(n){U(n),xn(n)}function Ln(n){k(n)}function we(n){var r=O(n,"root",{},"_root"),e=me(n),t=y(x(e))-1,o=2*t+1;n.graph().nestingRoot=r,s(n.edges(),function(i){n.edge(i).minlen*=o});var a=be(n)+1;s(n.children(),function(i){Cn(n,r,o,a,t,e,i)}),n.graph().nodeRankFactor=o}function Cn(n,r,e,t,o,a,i){var u=n.children(i);if(!u.length){i!==r&&n.setEdge(r,i,{weight:0,minlen:e});return}var d=wn(n,"_bt"),c=wn(n,"_bb"),f=n.node(i);n.setParent(d,i),f.borderTop=d,n.setParent(c,i),f.borderBottom=c,s(u,function(h){Cn(n,r,e,t,o,a,h);var g=n.node(h),l=g.borderTop?g.borderTop:h,v=g.borderBottom?g.borderBottom:h,w=g.borderTop?t:2*t,_=l===v?o-a[i]+1:1;n.setEdge(d,l,{weight:w,minlen:_,nestingEdge:!0}),n.setEdge(v,c,{weight:w,minlen:_,nestingEdge:!0})}),n.parent(i)||n.setEdge(r,d,{weight:0,minlen:o+a[i]})}function me(n){var r={};function e(t,o){var a=n.children(t);a&&a.length&&s(a,function(i){e(i,o+1)}),r[t]=o}return s(n.children(),function(t){e(t,1)}),r}function be(n){return L(n.edges(),function(r,e){return r+n.edge(e).weight},0)}function ye(n){var r=n.graph();n.removeNode(r.nestingRoot),delete r.nestingRoot,s(n.edges(),function(e){n.edge(e).nestingEdge&&n.removeEdge(e)})}function ke(n,r,e){var t={},o;s(e,function(a){for(var i=n.parent(a),u,d;i;){if(u=n.parent(i),u?(d=t[u],t[u]=i):(d=o,o=i),d&&d!==i){r.setEdge(d,i);return}i=u}})}function xe(n,r,e){var t=Ee(n),o=new b({compound:!0}).setGraph({root:t}).setDefaultNodeLabel(function(a){return n.node(a)});return s(n.nodes(),function(a){var i=n.node(a),u=n.parent(a);(i.rank===r||i.minRank<=r&&r<=i.maxRank)&&(o.setNode(a),o.setParent(a,u||t),s(n[e](a),function(d){var c=d.v===a?d.w:d.v,f=o.edge(c,a),h=m(f)?0:f.weight;o.setEdge(c,a,{weight:n.edge(d).weight+h})}),Object.prototype.hasOwnProperty.call(i,"minRank")&&o.setNode(a,{borderLeft:i.borderLeft[r],borderRight:i.borderRight[r]}))}),o}function Ee(n){for(var r;n.hasNode(r=A("_root")););return r}function Oe(n,r){for(var e=0,t=1;t<r.length;++t)e+=_e(n,r[t-1],r[t]);return e}function _e(n,r,e){for(var t=Gr(e,p(e,function(c,f){return f})),o=N(p(r,function(c){return R(p(n.outEdges(c),function(f){return{pos:t[f.w],weight:n.edge(f).weight}}),"pos")})),a=1;a<e.length;)a<<=1;var i=2*a-1;--a;var u=p(Array(i),function(){return 0}),d=0;return s(o.forEach(function(c){var f=c.pos+a;u[f]+=c.weight;for(var h=0;f>0;)f%2&&(h+=u[f+1]),f=f-1>>1,u[f]+=c.weight;d+=c.weight*h})),d}function je(n){var r={},e=j(n.nodes(),function(u){return!n.children(u).length}),t=y(p(e,function(u){return n.node(u).rank})),o=p(E(t+1),function(){return[]});function a(u){if(!on(r,u)){r[u]=!0;var d=n.node(u);o[d.rank].push(u),s(n.successors(u),a)}}var i=R(e,function(u){return n.node(u).rank});return s(i,a),o}function Ne(n,r){return p(r,function(e){var t=n.inEdges(e);if(t.length){var o=L(t,function(a,i){var u=n.edge(i),d=n.node(i.v);return{sum:a.sum+u.weight*d.order,weight:a.weight+u.weight}},{sum:0,weight:0});return{v:e,barycenter:o.sum/o.weight,weight:o.weight}}else return{v:e}})}function Pe(n,r){var e={};s(n,function(o,a){var i=e[o.v]={indegree:0,in:[],out:[],vs:[o.v],i:a};m(o.barycenter)||(i.barycenter=o.barycenter,i.weight=o.weight)}),s(r.edges(),function(o){var a=e[o.v],i=e[o.w];!m(a)&&!m(i)&&(i.indegree++,a.out.push(e[o.w]))});var t=j(e,function(o){return!o.indegree});return Re(t)}function Re(n){var r=[];function e(a){return function(i){i.merged||(m(i.barycenter)||m(a.barycenter)||i.barycenter>=a.barycenter)&&Me(a,i)}}function t(a){return function(i){i.in.push(a),--i.indegree===0&&n.push(i)}}for(;n.length;){var o=n.pop();r.push(o),s(o.in.reverse(),e(o)),s(o.out,t(o))}return p(j(r,function(a){return!a.merged}),function(a){return C(a,["vs","i","barycenter","weight"])})}function Me(n,r){var e=0,t=0;n.weight&&(e+=n.barycenter*n.weight,t+=n.weight),r.weight&&(e+=r.barycenter*r.weight,t+=r.weight),n.vs=r.vs.concat(n.vs),n.barycenter=e/t,n.weight=t,n.i=Math.min(r.i,n.i),r.merged=!0}function Le(n,r){var e=Ur(n,function(f){return Object.prototype.hasOwnProperty.call(f,"barycenter")}),t=e.lhs,o=R(e.rhs,function(f){return-f.i}),a=[],i=0,u=0,d=0;t.sort(Ce(!!r)),d=Tn(a,o,d),s(t,function(f){d+=f.vs.length,a.push(f.vs),i+=f.barycenter*f.weight,u+=f.weight,d=Tn(a,o,d)});var c={vs:N(a)};return u&&(c.barycenter=i/u,c.weight=u),c}function Tn(n,r,e){for(var t;r.length&&(t=T(r)).i<=e;)r.pop(),n.push(t.vs),e++;return e}function Ce(n){return function(r,e){return r.barycenter<e.barycenter?-1:r.barycenter>e.barycenter?1:n?e.i-r.i:r.i-e.i}}function Sn(n,r,e,t){var o=n.children(r),a=n.node(r),i=a?a.borderLeft:void 0,u=a?a.borderRight:void 0,d={};i&&(o=j(o,function(v){return v!==i&&v!==u}));var c=Ne(n,o);s(c,function(v){if(n.children(v.v).length){var w=Sn(n,v.v,e,t);d[v.v]=w,Object.prototype.hasOwnProperty.call(w,"barycenter")&&Se(v,w)}});var f=Pe(c,e);Te(f,d);var h=Le(f,t);if(i&&(h.vs=N([i,h.vs,u]),n.predecessors(i).length)){var g=n.node(n.predecessors(i)[0]),l=n.node(n.predecessors(u)[0]);Object.prototype.hasOwnProperty.call(h,"barycenter")||(h.barycenter=0,h.weight=0),h.barycenter=(h.barycenter*h.weight+g.order+l.order)/(h.weight+2),h.weight+=2}return h}function Te(n,r){s(n,function(e){e.vs=N(e.vs.map(function(t){return r[t]?r[t].vs:t}))})}function Se(n,r){m(n.barycenter)?(n.barycenter=r.barycenter,n.weight=r.weight):(n.barycenter=(n.barycenter*n.weight+r.barycenter*r.weight)/(n.weight+r.weight),n.weight+=r.weight)}function Ge(n){var r=mn(n),e=Gn(n,E(1,r+1),"inEdges"),t=Gn(n,E(r-1,-1,-1),"outEdges"),o=je(n);Bn(n,o);for(var a=1/0,i,u=0,d=0;d<4;++u,++d){Be(u%2?e:t,u%4>=2),o=G(n);var c=Oe(n,o);c<a&&(d=0,i=tr(o),a=c)}Bn(n,i)}function Gn(n,r,e){return p(r,function(t){return xe(n,t,e)})}function Be(n,r){var e=new b;s(n,function(t){var o=t.graph().root,a=Sn(t,o,e,r);s(a.vs,function(i,u){t.node(i).order=u}),ke(t,e,a.vs)})}function Bn(n,r){s(r,function(e){s(e,function(t,o){n.node(t).order=o})})}function qe(n){var r=Ie(n);s(n.graph().dummyChains,function(e){for(var t=n.node(e),o=t.edgeObj,a=ze(n,r,o.v,o.w),i=a.path,u=a.lca,d=0,c=i[d],f=!0;e!==o.w;){if(t=n.node(e),f){for(;(c=i[d])!==u&&n.node(c).maxRank<t.rank;)d++;c===u&&(f=!1)}if(!f){for(;d<i.length-1&&n.node(c=i[d+1]).minRank<=t.rank;)d++;c=i[d]}n.setParent(e,c),e=n.successors(e)[0]}})}function ze(n,r,e,t){var o=[],a=[],i=Math.min(r[e].low,r[t].low),u=Math.max(r[e].lim,r[t].lim),d=e,c;do d=n.parent(d),o.push(d);while(d&&(r[d].low>i||u>r[d].lim));for(c=d,d=t;(d=n.parent(d))!==c;)a.push(d);return{path:o.concat(a.reverse()),lca:c}}function Ie(n){var r={},e=0;function t(o){var a=e;s(n.children(o),t),r[o]={low:a,lim:e++}}return s(n.children(),t),r}function De(n,r){var e={};function t(o,a){var i=0,u=0,d=o.length,c=T(a);return s(a,function(f,h){var g=Ve(n,f),l=g?n.node(g).order:d;(g||f===c)&&(s(a.slice(u,h+1),function(v){s(n.predecessors(v),function(w){var _=n.node(w),$=_.order;($<i||l<$)&&!(_.dummy&&n.node(v).dummy)&&qn(e,w,v)})}),u=h+1,i=l)}),a}return L(r,t),e}function Fe(n,r){var e={};function t(a,i,u,d,c){var f;s(E(i,u),function(h){f=a[h],n.node(f).dummy&&s(n.predecessors(f),function(g){var l=n.node(g);l.dummy&&(l.order<d||l.order>c)&&qn(e,g,f)})})}function o(a,i){var u=-1,d,c=0;return s(i,function(f,h){if(n.node(f).dummy==="border"){var g=n.predecessors(f);g.length&&(d=n.node(g[0]).order,t(i,c,h,u,d),c=h,u=d)}t(i,c,i.length,d,a.length)}),i}return L(r,o),e}function Ve(n,r){if(n.node(r).dummy)return I(n.predecessors(r),function(e){return n.node(e).dummy})}function qn(n,r,e){if(r>e){var t=r;r=e,e=t}var o=n[r];o||(n[r]=o={}),o[e]=!0}function Ae(n,r,e){if(r>e){var t=r;r=e,e=t}return!!n[r]&&Object.prototype.hasOwnProperty.call(n[r],e)}function Je(n,r,e,t){var o={},a={},i={};return s(r,function(u){s(u,function(d,c){o[d]=d,a[d]=d,i[d]=c})}),s(r,function(u){var d=-1;s(u,function(c){var f=t(c);if(f.length){f=R(f,function(w){return i[w]});for(var h=(f.length-1)/2,g=Math.floor(h),l=Math.ceil(h);g<=l;++g){var v=f[g];a[c]===c&&d<i[v]&&!Ae(e,c,v)&&(a[v]=c,a[c]=o[c]=o[v],d=i[v])}}})}),{root:o,align:a}}function He(n,r,e,t,o){var a={},i=Ke(n,r,e,o),u=o?"borderLeft":"borderRight";function d(h,g){for(var l=i.nodes(),v=l.pop(),w={};v;)w[v]?h(v):(w[v]=!0,l.push(v),l=l.concat(g(v))),v=l.pop()}function c(h){a[h]=i.inEdges(h).reduce(function(g,l){return Math.max(g,a[l.v]+i.edge(l))},0)}function f(h){var g=i.outEdges(h).reduce(function(v,w){return Math.min(v,a[w.w]-i.edge(w))},1/0),l=n.node(h);g!==1/0&&l.borderType!==u&&(a[h]=Math.max(a[h],g))}return d(c,i.predecessors.bind(i)),d(f,i.successors.bind(i)),s(t,function(h){a[h]=a[e[h]]}),a}function Ke(n,r,e,t){var o=new b,a=n.graph(),i=Ye(a.nodesep,a.edgesep,t);return s(r,function(u){var d;s(u,function(c){var f=e[c];if(o.setNode(f),d){var h=e[d],g=o.edge(h,f);o.setEdge(h,f,Math.max(i(n,c,d),g||0))}d=c})}),o}function Qe(n,r){return D(x(r),function(e){var t=-1/0,o=1/0;return ir(e,function(a,i){var u=Ze(n,i)/2;t=Math.max(a+u,t),o=Math.min(a-u,o)}),t-o})}function Ue(n,r){var e=x(r),t=P(e),o=y(e);s(["u","d"],function(a){s(["l","r"],function(i){var u=a+i,d=n[u],c;if(d!==r){var f=x(d);c=i==="l"?t-P(f):o-y(f),c&&(n[u]=S(d,function(h){return h+c}))}})})}function We(n,r){return S(n.ul,function(e,t){if(r)return n[r.toLowerCase()][t];var o=R(p(n,t));return(o[1]+o[2])/2})}function Xe(n){var r=G(n),e=z(De(n,r),Fe(n,r)),t={},o;s(["u","d"],function(i){o=i==="u"?r:x(r).reverse(),s(["l","r"],function(u){u==="r"&&(o=p(o,function(h){return x(h).reverse()}));var d=(i==="u"?n.predecessors:n.successors).bind(n),c=Je(n,o,e,d),f=He(n,o,c.root,c.align,u==="r");u==="r"&&(f=S(f,function(h){return-h})),t[i+u]=f})});var a=Qe(n,t);return Ue(t,a),We(t,n.graph().align)}function Ye(n,r,e){return function(t,o,a){var i=t.node(o),u=t.node(a),d=0,c;if(d+=i.width/2,Object.prototype.hasOwnProperty.call(i,"labelpos"))switch(i.labelpos.toLowerCase()){case"l":c=-i.width/2;break;case"r":c=i.width/2;break}if(c&&(d+=e?c:-c),c=0,d+=(i.dummy?r:n)/2,d+=(u.dummy?r:n)/2,d+=u.width/2,Object.prototype.hasOwnProperty.call(u,"labelpos"))switch(u.labelpos.toLowerCase()){case"l":c=u.width/2;break;case"r":c=-u.width/2;break}return c&&(d+=e?c:-c),c=0,d}}function Ze(n,r){return n.node(r).width}function $e(n){n=ln(n),nt(n),ur(Xe(n),function(r,e){n.node(e).x=r})}function nt(n){var r=G(n),e=n.graph().ranksep,t=0;s(r,function(o){var a=y(p(o,function(i){return n.node(i).height}));s(o,function(i){n.node(i).y=t+a/2}),t+=a+e})}function rt(n,r){var e=r&&r.debugTiming?Wr:Xr;e("layout",()=>{var t=e("  buildLayoutGraph",()=>ht(n));e("  runLayout",()=>et(t,e)),e("  updateInputGraph",()=>tt(n,t))})}function et(n,r){r("    makeSpaceForEdgeLabels",()=>gt(n)),r("    removeSelfEdges",()=>xt(n)),r("    acyclic",()=>Vr(n)),r("    nestingGraph.run",()=>we(n)),r("    rank",()=>ve(ln(n))),r("    injectEdgeLabelProxies",()=>vt(n)),r("    removeEmptyRanks",()=>Qr(n)),r("    nestingGraph.cleanup",()=>ye(n)),r("    normalizeRanks",()=>Kr(n)),r("    assignRankMinMax",()=>lt(n)),r("    removeEdgeLabelProxies",()=>pt(n)),r("    normalize.run",()=>ee(n)),r("    parentDummyChains",()=>qe(n)),r("    addBorderSegments",()=>Yr(n)),r("    order",()=>Ge(n)),r("    insertSelfEdges",()=>Et(n)),r("    adjustCoordinateSystem",()=>Zr(n)),r("    position",()=>$e(n)),r("    positionSelfEdges",()=>Ot(n)),r("    removeBorderNodes",()=>kt(n)),r("    normalize.undo",()=>oe(n)),r("    fixupEdgeLabelCoords",()=>bt(n)),r("    undoCoordinateSystem",()=>$r(n)),r("    translateGraph",()=>wt(n)),r("    assignNodeIntersects",()=>mt(n)),r("    reversePoints",()=>yt(n)),r("    acyclic.undo",()=>Jr(n))}function tt(n,r){s(n.nodes(),function(e){var t=n.node(e),o=r.node(e);t&&(t.x=o.x,t.y=o.y,r.children(e).length&&(t.width=o.width,t.height=o.height))}),s(n.edges(),function(e){var t=n.edge(e),o=r.edge(e);t.points=o.points,Object.prototype.hasOwnProperty.call(o,"x")&&(t.x=o.x,t.y=o.y)}),n.graph().width=r.graph().width,n.graph().height=r.graph().height}var ot=["nodesep","edgesep","ranksep","marginx","marginy"],it={ranksep:50,edgesep:20,nodesep:50,rankdir:"tb"},at=["acyclicer","ranker","rankdir","align"],ut=["width","height"],dt={width:0,height:0},ct=["minlen","weight","width","height","labeloffset"],st={minlen:1,weight:1,width:0,height:0,labeloffset:10,labelpos:"r"},ft=["labelpos"];function ht(n){var r=new b({multigraph:!0,compound:!0}),e=Z(n.graph());return r.setGraph(z({},it,Y(e,ot),C(e,at))),s(n.nodes(),function(t){var o=Z(n.node(t));r.setNode(t,Zn(Y(o,ut),dt)),r.setParent(t,n.parent(t))}),s(n.edges(),function(t){var o=Z(n.edge(t));r.setEdge(t,z({},st,Y(o,ct),C(o,ft)))}),r}function gt(n){var r=n.graph();r.ranksep/=2,s(n.edges(),function(e){var t=n.edge(e);t.minlen*=2,t.labelpos.toLowerCase()!=="c"&&(r.rankdir==="TB"||r.rankdir==="BT"?t.width+=t.labeloffset:t.height+=t.labeloffset)})}function vt(n){s(n.edges(),function(r){var e=n.edge(r);if(e.width&&e.height){var t=n.node(r.v),o={rank:(n.node(r.w).rank-t.rank)/2+t.rank,e:r};O(n,"edge-proxy",o,"_ep")}})}function lt(n){var r=0;s(n.nodes(),function(e){var t=n.node(e);t.borderTop&&(t.minRank=n.node(t.borderTop).rank,t.maxRank=n.node(t.borderBottom).rank,r=y(r,t.maxRank))}),n.graph().maxRank=r}function pt(n){s(n.nodes(),function(r){var e=n.node(r);e.dummy==="edge-proxy"&&(n.edge(e.e).labelRank=e.rank,n.removeNode(r))})}function wt(n){var r=1/0,e=0,t=1/0,o=0,a=n.graph(),i=a.marginx||0,u=a.marginy||0;function d(c){var f=c.x,h=c.y,g=c.width,l=c.height;r=Math.min(r,f-g/2),e=Math.max(e,f+g/2),t=Math.min(t,h-l/2),o=Math.max(o,h+l/2)}s(n.nodes(),function(c){d(n.node(c))}),s(n.edges(),function(c){var f=n.edge(c);Object.prototype.hasOwnProperty.call(f,"x")&&d(f)}),r-=i,t-=u,s(n.nodes(),function(c){var f=n.node(c);f.x-=r,f.y-=t}),s(n.edges(),function(c){var f=n.edge(c);s(f.points,function(h){h.x-=r,h.y-=t}),Object.prototype.hasOwnProperty.call(f,"x")&&(f.x-=r),Object.prototype.hasOwnProperty.call(f,"y")&&(f.y-=t)}),a.width=e-r+i,a.height=o-t+u}function mt(n){s(n.edges(),function(r){var e=n.edge(r),t=n.node(r.v),o=n.node(r.w),a,i;e.points?(a=e.points[0],i=e.points[e.points.length-1]):(e.points=[],a=o,i=t),e.points.unshift(pn(t,a)),e.points.push(pn(o,i))})}function bt(n){s(n.edges(),function(r){var e=n.edge(r);if(Object.prototype.hasOwnProperty.call(e,"x"))switch((e.labelpos==="l"||e.labelpos==="r")&&(e.width-=e.labeloffset),e.labelpos){case"l":e.x-=e.width/2+e.labeloffset;break;case"r":e.x+=e.width/2+e.labeloffset;break}})}function yt(n){s(n.edges(),function(r){var e=n.edge(r);e.reversed&&e.points.reverse()})}function kt(n){s(n.nodes(),function(r){if(n.children(r).length){var e=n.node(r),t=n.node(e.borderTop),o=n.node(e.borderBottom),a=n.node(T(e.borderLeft)),i=n.node(T(e.borderRight));e.width=Math.abs(i.x-a.x),e.height=Math.abs(o.y-t.y),e.x=a.x+e.width/2,e.y=t.y+e.height/2}}),s(n.nodes(),function(r){n.node(r).dummy==="border"&&n.removeNode(r)})}function xt(n){s(n.edges(),function(r){if(r.v===r.w){var e=n.node(r.v);e.selfEdges||(e.selfEdges=[]),e.selfEdges.push({e:r,label:n.edge(r)}),n.removeEdge(r)}})}function Et(n){var r=G(n);s(r,function(e){var t=0;s(e,function(o,a){var i=n.node(o);i.order=a+t,s(i.selfEdges,function(u){O(n,"selfedge",{width:u.label.width,height:u.label.height,rank:i.rank,order:a+ ++t,e:u.e,label:u.label},"_se")}),delete i.selfEdges})})}function Ot(n){s(n.nodes(),function(r){var e=n.node(r);if(e.dummy==="selfedge"){var t=n.node(e.e.v),o=t.x+t.width/2,a=t.y,i=e.x-o,u=t.height/2;n.setEdge(e.e,e.label),n.removeNode(r),e.label.points=[{x:o+2*i/3,y:a-u},{x:o+5*i/6,y:a-u},{x:o+i,y:a},{x:o+5*i/6,y:a+u},{x:o+2*i/3,y:a+u}],e.label.x=e.x,e.label.y=e.y}})}function Y(n,r){return S(C(n,r),Number)}function Z(n){var r={};return s(n,function(e,t){r[t.toLowerCase()]=e}),r}export{rt as t};
