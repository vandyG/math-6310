import{o}from"./react-7g8sREeT.js";import{Dr as c,jr as l}from"./cells-B4cnsYe_.js";import{t as m}from"./Logger-BkkOJyg0.js";function h(e){return{getItem(t,r){try{let a=localStorage.getItem(t);if(!a)return r;let i=JSON.parse(a);return e.fromSerializable(i)}catch(a){return m.warn(`Error getting ${t} from storage`,a),r}},setItem:(t,r)=>{localStorage.setItem(t,JSON.stringify(e.toSerializable(r)))},removeItem:t=>{localStorage.removeItem(t)}}}var g="marimo:ai:chatState:v5";const u=o(null),I=l("marimo:ai:includeOtherCells",!0);function f(e){let t=new Map;for(let[r,a]of e.entries()){if(a.messages.length===0)continue;let i=c(a.messages,n=>n.id);t.set(r,{...a,messages:i})}return t}const s=l(g,{chats:new Map,activeChatId:null},h({toSerializable:e=>({chats:[...f(e.chats).entries()],activeChatId:e.activeChatId}),fromSerializable:e=>({chats:new Map(e.chats),activeChatId:e.activeChatId})})),v=o(e=>{let t=e(s);return t.activeChatId?t.chats.get(t.activeChatId):null},(e,t,r)=>{t(s,a=>({...a,activeChatId:r}))});export{I as i,u as n,s as r,v as t};
