import{r as I}from"./invariant-91cSKJcr.js";import{t as q}from"./Logger-BkkOJyg0.js";import{r as A}from"./config-DiCy6eC0.js";import{i as W}from"./useHotkey-CJ5v8JMM.js";import{t as C}from"./strings-1yw0WVap.js";const L=()=>I.get(W),N=()=>{let t=document.querySelector("marimo-code");if(!t)return;let r=t.innerHTML;return decodeURIComponent(r).trim()};var k={"Content-Type":"application/json"},M=/\{[^{}]+\}/g,G=class extends Request{constructor(t,r){for(let e in super(t,r),r)e in this||(this[e]=r[e])}};function J(t){let{baseUrl:r="",fetch:e=globalThis.fetch,querySerializer:n,bodySerializer:o,headers:s,...a}={...t};r.endsWith("/")&&(r=r.substring(0,r.length-1)),s=P(k,s);let l=[];async function c(u,i){let{fetch:y=e,headers:D,params:j={},parseAs:R="json",querySerializer:b,bodySerializer:E=o??_,...H}=i||{},g=typeof n=="function"?n:v(n);b&&(g=typeof b=="function"?b:v({...typeof n=="object"?n:{},...b}));let h={redirect:"follow",...a,...H,headers:P(s,D,j.header)};h.body&&(h.body=E(h.body)),h.body instanceof FormData&&h.headers.delete("Content-Type");let m=new G(B(u,{baseUrl:r,params:j,querySerializer:g}),h),S={baseUrl:r,fetch:y,parseAs:R,querySerializer:g,bodySerializer:E};for(let p of l)if(p&&typeof p=="object"&&typeof p.onRequest=="function"){m.schemaPath=u,m.params=j;let d=await p.onRequest(m,S);if(d){if(!(d instanceof Request))throw Error("Middleware must return new Request() when modifying the request");m=d}}let f=await y(m);for(let p=l.length-1;p>=0;p--){let d=l[p];if(d&&typeof d=="object"&&typeof d.onResponse=="function"){let T=await d.onResponse(f,S);if(T){if(!(T instanceof Response))throw Error("Middleware must return new Response() when modifying the response");f=T}}}if(f.status===204||f.headers.get("Content-Length")==="0")return f.ok?{data:{},response:f}:{error:{},response:f};if(f.ok)return R==="stream"?{data:f.body,response:f}:{data:await f[R](),response:f};let $=await f.text();try{$=JSON.parse($)}catch{}return{error:$,response:f}}return{async GET(u,i){return c(u,{...i,method:"GET"})},async PUT(u,i){return c(u,{...i,method:"PUT"})},async POST(u,i){return c(u,{...i,method:"POST"})},async DELETE(u,i){return c(u,{...i,method:"DELETE"})},async OPTIONS(u,i){return c(u,{...i,method:"OPTIONS"})},async HEAD(u,i){return c(u,{...i,method:"HEAD"})},async PATCH(u,i){return c(u,{...i,method:"PATCH"})},async TRACE(u,i){return c(u,{...i,method:"TRACE"})},use(...u){for(let i of u)if(i){if(typeof i!="object"||!("onRequest"in i||"onResponse"in i))throw Error("Middleware must be an object with one of `onRequest()` or `onResponse()`");l.push(i)}},eject(...u){for(let i of u){let y=l.indexOf(i);y!==-1&&l.splice(y,1)}}}}function w(t,r,e){if(r==null)return"";if(typeof r=="object")throw Error("Deeply-nested arrays/objects aren\u2019t supported. Provide your own `querySerializer()` to handle these.");return`${t}=${(e==null?void 0:e.allowReserved)===!0?r:encodeURIComponent(r)}`}function O(t,r,e){if(!r||typeof r!="object")return"";let n=[],o={simple:",",label:".",matrix:";"}[e.style]||"&";if(e.style!=="deepObject"&&e.explode===!1){for(let l in r)n.push(l,e.allowReserved===!0?r[l]:encodeURIComponent(r[l]));let a=n.join(",");switch(e.style){case"form":return`${t}=${a}`;case"label":return`.${a}`;case"matrix":return`;${t}=${a}`;default:return a}}for(let a in r){let l=e.style==="deepObject"?`${t}[${a}]`:a;n.push(w(l,r[a],e))}let s=n.join(o);return e.style==="label"||e.style==="matrix"?`${o}${s}`:s}function U(t,r,e){if(!Array.isArray(r))return"";if(e.explode===!1){let s={form:",",spaceDelimited:"%20",pipeDelimited:"|"}[e.style]||",",a=(e.allowReserved===!0?r:r.map(l=>encodeURIComponent(l))).join(s);switch(e.style){case"simple":return a;case"label":return`.${a}`;case"matrix":return`;${t}=${a}`;default:return`${t}=${a}`}}let n={simple:",",label:".",matrix:";"}[e.style]||"&",o=[];for(let s of r)e.style==="simple"||e.style==="label"?o.push(e.allowReserved===!0?s:encodeURIComponent(s)):o.push(w(t,s,e));return e.style==="label"||e.style==="matrix"?`${n}${o.join(n)}`:o.join(n)}function v(t){return function(r){let e=[];if(r&&typeof r=="object")for(let n in r){let o=r[n];if(o!=null){if(Array.isArray(o)){e.push(U(n,o,{style:"form",explode:!0,...t==null?void 0:t.array,allowReserved:(t==null?void 0:t.allowReserved)||!1}));continue}if(typeof o=="object"){e.push(O(n,o,{style:"deepObject",explode:!0,...t==null?void 0:t.object,allowReserved:(t==null?void 0:t.allowReserved)||!1}));continue}e.push(w(n,o,t))}}return e.join("&")}}function F(t,r){let e=t;for(let n of t.match(M)??[]){let o=n.substring(1,n.length-1),s=!1,a="simple";if(o.endsWith("*")&&(s=!0,o=o.substring(0,o.length-1)),o.startsWith(".")?(a="label",o=o.substring(1)):o.startsWith(";")&&(a="matrix",o=o.substring(1)),!r||r[o]===void 0||r[o]===null)continue;let l=r[o];if(Array.isArray(l)){e=e.replace(n,U(o,l,{style:a,explode:s}));continue}if(typeof l=="object"){e=e.replace(n,O(o,l,{style:a,explode:s}));continue}if(a==="matrix"){e=e.replace(n,`;${w(o,l)}`);continue}e=e.replace(n,a==="label"?`.${l}`:l)}return e}function _(t){return JSON.stringify(t)}function B(t,r){var o;let e=`${r.baseUrl}${t}`;(o=r.params)!=null&&o.path&&(e=F(e,r.params.path));let n=r.querySerializer(r.params.query??{});return n.startsWith("?")&&(n=n.substring(1)),n&&(e+=`?${n}`),e}function P(...t){let r=new Headers;for(let e of t){if(!e||typeof e!="object")continue;let n=e instanceof Headers?e.entries():Object.entries(e);for(let[o,s]of n)if(s===null)r.delete(o);else if(Array.isArray(s))for(let a of s)r.append(o,a);else s!==void 0&&r.set(o,s)}return r}function K(t){return J(t)}function z(){let t=A().httpURL;return t.search="",t.hash="",t.toString()}const x={post(t,r,e={}){let n=`${C.withTrailingSlash(e.baseUrl??z())}api${t}`;return fetch(n,{method:"POST",headers:{"Content-Type":"application/json",...x.headers(),...e.headers},body:JSON.stringify(r),signal:e.signal}).then(async o=>{var a;let s=(a=o.headers.get("Content-Type"))==null?void 0:a.startsWith("application/json");if(!o.ok){let l=s?await o.json():await o.text();throw Error(o.statusText,{cause:l})}return s?o.json():o.text()}).catch(o=>{throw q.error(`Error requesting ${n}`,o),o})},get(t,r={}){let e=`${C.withTrailingSlash(r.baseUrl??z())}api${t}`;return fetch(e,{method:"GET",headers:{...x.headers(),...r.headers}}).then(n=>{var o;if(!n.ok)throw Error(n.statusText);return(o=n.headers.get("Content-Type"))!=null&&o.startsWith("application/json")?n.json():null}).catch(n=>{throw q.error(`Error requesting ${e}`,n),n})},headers(){return A().headers()},handleResponse:t=>t.error?Promise.reject(t.error):Promise.resolve(t.data),handleResponseReturnNull:t=>t.error?Promise.reject(t.error):Promise.resolve(null)};function Q(t){let r=K({baseUrl:t.httpURL.toString()});return r.use({onRequest:e=>{let n=t.headers();for(let[o,s]of Object.entries(n))e.headers.set(o,s);return e}}),r}export{L as i,Q as n,N as r,x as t};
